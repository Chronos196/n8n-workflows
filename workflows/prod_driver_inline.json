{
  "active": false,
  "connections": {
    "отправьте данные": {
      "main": [
        [
          {
            "node": "статус=отправка срочно",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres1": {
      "main": [
        [
          {
            "node": "меняем статус - ввод текста запроса",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "комментарий механику": {
      "main": [
        [
          {
            "node": "Postgres1",
            "type": "main",
            "index": 0
          },
          {
            "node": "убираем кнопки в меню ТО",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "меню после ТО": {
      "main": [
        [
          {
            "node": "убираем кнопки в меню ТО",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получаем odoo id3": {
      "main": [
        [
          {
            "node": "находим машину по odoo id3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим машину по odoo id3": {
      "main": [
        [
          {
            "node": "меняем статус машины на Нет водителя",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "меняем статус машины на Нет водителя": {
      "main": [
        [
          {
            "node": "статус ввода данных после смены",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Статус получения фото при неисправности": {
      "main": [
        [
          {
            "node": "Отправка фото",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "данные при работе в карьере": {
      "main": [
        [
          {
            "node": "получаем odoo id3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Завершение смены": {
      "main": [
        [
          {
            "node": "получаем odoo id5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получаем odoo id5": {
      "main": [
        [
          {
            "node": "находим машину по odoo id5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим машину по odoo id5": {
      "main": [
        [
          {
            "node": "меняем статус машины на Нет водителя1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Выводим информацию о перевозке1": {
      "main": [
        [
          {
            "node": "принятие заказа",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отмена отправки фото": {
      "main": [
        [
          {
            "node": "Статус получения фото при неисправности1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "заявки \"к выполнению\"": {
      "main": [
        [
          {
            "node": "проверка наличия заявок1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "создаём динамически инлайн кнопки": {
      "main": [
        [
          {
            "node": "отправляем сообщение ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправляем сообщение ": {
      "main": [
        [
          {
            "node": "удаляем прошлое сообщение с заявками",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "создаём динамически инлайн кнопки1": {
      "main": [
        [
          {
            "node": "отправляем сообщение 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправляем сообщение 1": {
      "main": [
        [
          {
            "node": "удаляем прошлое сообщение с заявками1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "заявки \"в работе\"": {
      "main": [
        [
          {
            "node": "проверка наличия заявок",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "проверка наличия заявок": {
      "main": [
        [
          {
            "node": "создаём динамически инлайн кнопки1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "заявки не найдены",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "проверка наличия заявок1": {
      "main": [
        [
          {
            "node": "создаём динамически инлайн кнопки",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "заявки не найдены",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "номер выбранной заявки": {
      "main": [
        [
          {
            "node": "обновим статус на \"в работе\"",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск механиков1": {
      "main": [
        [
          {
            "node": "поиск тг айди механиков1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск тг айди механиков1": {
      "main": [
        [
          {
            "node": "проверка наличия механиков1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "проверка наличия механиков1": {
      "main": [
        [
          {
            "node": "данные водителя",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "данные водителя": {
      "main": [
        [
          {
            "node": "данные авто",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "нужно вписать часы": {
      "main": [
        [
          {
            "node": "обновим статус и номер текущей заявки",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "номер выбранной заявки1": {
      "main": [
        [
          {
            "node": "получим актуальный статус заявки",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "завершён процесс заявки": {
      "main": [
        [
          {
            "node": "убираем номер заявки из пг",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "убираем номер заявки из пг": {
      "main": [
        [
          {
            "node": "поиск механиков1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "завершён процесс заявки1": {
      "main": [
        [
          {
            "node": "меняем на статус отправки фотографии",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получим актуальный статус заявки": {
      "main": [
        [
          {
            "node": "заявка в работе?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "заявка в работе?": {
      "main": [
        [
          {
            "node": "нужно вписать часы",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "заявка уже изменена",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "принятие заказа": {
      "main": [
        [
          {
            "node": "Получение информации о водителе1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Получение информации о водителе1": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Telegram1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram1": {
      "main": [
        [
          {
            "node": "Обновление статуса отправки фото логисту1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Нажатие водителем на кнопку замена масла": {
      "main": [
        [
          {
            "node": "Получаем odoo_id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Получаем odoo_id": {
      "main": [
        [
          {
            "node": "Получаем информацию о машине",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Получаем информацию о машине": {
      "main": [
        [
          {
            "node": "Обновление пробега при котором нужна будет замена масла1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Сообщение при нажатии на кнопку отправить фото": {
      "main": [
        [
          {
            "node": "Обновление статуса отправки фото логисту",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "кнопки меню ТО": {
      "main": [
        [
          {
            "node": "меню после ТО",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "комментарий механику",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Кнопки после отправки фото",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "данные авто": {
      "main": [
        [
          {
            "node": "текст заявки",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "текст заявки": {
      "main": [
        [
          {
            "node": "Отправка проблемы механикам1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "нужно ли приложить фото?1": {
      "main": [
        [
          {
            "node": "возвращаем статус3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "фото завершения заявки": {
      "main": [
        [
          {
            "node": "завершён процесс заявки1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "завершён процесс заявки",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "нужно ли приложить фото?1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "кнопки отправки фото груза и замены масла",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка весовых справок или ттн при завершении смены": {
      "main": [
        [
          {
            "node": "отправить весовую или ттн",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "номер авто": {
      "main": [
        [
          {
            "node": "заявки \"к выполнению\"",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "номер авто1": {
      "main": [
        [
          {
            "node": "заявки \"в работе\"",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "кнопки отправки фото груза и замены масла": {
      "main": [
        [
          {
            "node": "Нажатие водителем на кнопку замена масла",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Сообщение при нажатии на кнопку отправить фото",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "ищем автомобиль с таким же сотрудником1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Статистика1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "снова вводим номер авто": {
      "main": [
        [
          {
            "node": "снова ввод номера авто",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ищем автомобиль с таким же сотрудником1": {
      "main": [
        [
          {
            "node": "если сотрудник уже занял авто1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "если сотрудник уже занял авто1": {
      "main": [
        [
          {
            "node": "он не может занять новый, пока занят старый1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "снова вводим номер авто",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ищем автомобиль с таким же сотрудником2": {
      "main": [
        [
          {
            "node": "водитель взял авто?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "водитель взял авто?": {
      "main": [
        [
          {
            "node": "Выводим информацию о перевозке1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "нужно взять авто",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Нет доступных перевозок": {
      "main": [
        [],
        [
          {
            "node": "Telegram3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram3": {
      "main": [
        [
          {
            "node": "Нет доступных перевозок1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "начало рейса2": {
      "main": [
        [
          {
            "node": "завершение рейса1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим машину по odoo id8": {
      "main": [
        [
          {
            "node": "начало рейса2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получаем odoo id7": {
      "main": [
        [
          {
            "node": "находим машину по odoo id8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получаем odoo id8": {
      "main": [
        [
          {
            "node": "находим машину по odoo id9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим машину по odoo id9": {
      "main": [
        [
          {
            "node": "получение перевозок1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получаем odoo id": {
      "main": [
        [
          {
            "node": "находим машину по odoo id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим машину по odoo id": {
      "main": [
        [
          {
            "node": "начало рейса",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получаем odoo id2": {
      "main": [
        [
          {
            "node": "находим машину по odoo id2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим машину по odoo id2": {
      "main": [
        [
          {
            "node": "завершение рейса",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Отправка весовой": {
      "main": [
        [
          {
            "node": "меняем статус на отправку весовой",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получаем odoo id10": {
      "main": [
        [
          {
            "node": "находим машину по odoo id12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим машину по odoo id12": {
      "main": [
        [
          {
            "node": "Получение сегодняшней даты3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Получение сегодняшней даты3": {
      "main": [
        [
          {
            "node": "получаем дату и время 00:2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получаем дату и время 00:2": {
      "main": [
        [
          {
            "node": "дата и время 23:2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "дата и время 23:2": {
      "main": [
        [
          {
            "node": "находим рейсы по машине7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим рейсы по машине7": {
      "main": [
        [
          {
            "node": "Summarize",
            "type": "main",
            "index": 0
          },
          {
            "node": "Summarize4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize": {
      "main": [
        [
          {
            "node": "Merge5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize4": {
      "main": [
        [
          {
            "node": "Merge5",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge5": {
      "main": [
        [
          {
            "node": "Вывод статистики",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим перевозки по рейсам7": {
      "main": [
        [
          {
            "node": "Summarize1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize1": {
      "main": [
        [
          {
            "node": "получаем название маршрута из перевозки7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск текущего авто": {
      "main": [
        [
          {
            "node": "выполняющиеся рейсы",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "выполняющиеся рейсы": {
      "main": [
        [
          {
            "node": "есть рейсы выполняющиеся",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "есть рейсы выполняющиеся": {
      "main": [
        [
          {
            "node": "Подтверждение завершения",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "нет рейсов",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "нет рейсов": {
      "main": [
        [
          {
            "node": "удалим инлайн кнопку",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Статистика1": {
      "main": [
        [
          {
            "node": "получаем odoo id10",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Удаление статистики",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "данные о топливе",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "кнопки завершения смены": {
      "main": [
        [
          {
            "node": "Подтверждение завершения смены",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "работа в карьере или нет",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "данные при работе в карьере",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Завершение смены",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "была заправка",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Подтверждение завершения смены после вывода перевозки",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "вывод перевозок",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск авто1": {
      "main": [
        [
          {
            "node": "поиск логистов4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск логистов4": {
      "main": [
        [
          {
            "node": "поиск тг айди логистов4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск тг айди логистов4": {
      "main": [
        [
          {
            "node": "Отправка литров логисту",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "преобразуем в 1 переменную4": {
      "main": [
        [
          {
            "node": "Инфа доставлена",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "если не отправилось2": {
      "main": [
        [
          {
            "node": "меняем статус на обычный2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Отправка литров логисту": {
      "main": [
        [
          {
            "node": "преобразуем в 1 переменную4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "если не отправилось2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Инфа доставлена": {
      "main": [
        [
          {
            "node": "меняем статус на обычный2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "данные о литрах": {
      "main": [
        [
          {
            "node": "статус ввода литров",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "фото чека": {
      "main": [
        [
          {
            "node": "статус=чек фото",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "есть ли чек": {
      "main": [
        [
          {
            "node": "статус дефолтный",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "выбор меры": {
      "main": [
        [
          {
            "node": "статус=дефолтный",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "данные о топливе": {
      "main": [
        [
          {
            "node": "данные о литрах",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "поиск авто1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "фото чека",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "есть ли чек",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "объём материала",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "статус=ввод количества материала": {
      "main": [
        [
          {
            "node": "ввод количества материала",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Кнопки после отправки фото": {
      "main": [
        [
          {
            "node": "Отправка фото",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "меняем статус на дефолтный2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Статус получения фото при неисправности",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "отмена отправки фото",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Отправка весовой",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "кнопки завершения смены",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "мера": {
      "main": [
        [
          {
            "node": "статус=ввод количества материала",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "мера1": {
      "main": [
        [
          {
            "node": "статус=ввод количества материала",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "начатый рейс": {
      "main": [
        [
          {
            "node": "получаем odoo id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "меняем статус на дефолтный2": {
      "main": [
        [
          {
            "node": "Требуется ли отправка весовой",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "объём материала": {
      "main": [
        [
          {
            "node": "выбор меры",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "мера",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "мера1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ТТН и весовые в конце смены",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "загрузите ттн или весовые": {
      "main": [
        [
          {
            "node": "меняем статус на дефолтный4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "номер авто2": {
      "main": [
        [
          {
            "node": "получение перевозок",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "находим рейсы без ттн",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "обработка кнопок ТО": {
      "main": [
        [
          {
            "node": "номер авто",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "номер авто1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "номер выбранной заявки",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "номер выбранной заявки1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "фото завершения заявки",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "номер выбранной перевозки": {
      "main": [
        [
          {
            "node": "запишем номер выбранной перевозки",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "запишем номер выбранной перевозки": {
      "main": [
        [
          {
            "node": "загрузите ттн или весовые",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "запишем номер выбранной перевозки1": {
      "main": [
        [
          {
            "node": "номер авто2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "удаляем прошлое сообщение с выбором": {
      "main": [
        [
          {
            "node": "запишем номер выбранной перевозки1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим рейсы без ттн": {
      "main": [
        [
          {
            "node": "Remove Duplicates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "номер авто3": {
      "main": [
        [
          {
            "node": "получаем id выбранной перевозки",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получаем id выбранной перевозки": {
      "main": [
        [
          {
            "node": "находим рейсы  в перевозке",
            "type": "main",
            "index": 0
          },
          {
            "node": "находим рейсы без ттн в перевозке",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим рейсы  в перевозке": {
      "main": [
        [
          {
            "node": "сколько всего рейсов в перевозке по машине",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "сколько всего рейсов в перевозке по машине": {
      "main": [
        [
          {
            "node": "объединяем кол-во в одно",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "сколько рейсов без ттн": {
      "main": [
        [
          {
            "node": "объединяем кол-во в одно",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "находим рейсы без ттн в перевозке": {
      "main": [
        [
          {
            "node": "сколько рейсов без ттн",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "сравниваем общее кол-во рейсов и рейсов без ттн": {
      "main": [
        [
          {
            "node": "загрузите ттн",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ттн загружена",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "объединяем кол-во в одно": {
      "main": [
        [
          {
            "node": "сравниваем общее кол-во рейсов и рейсов без ттн",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "загрузите ттн": {
      "main": [
        [
          {
            "node": "меняем статус на отправку ТТН",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "номер авто4": {
      "main": [
        [
          {
            "node": "получаем id выбранной перевозки1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получаем id выбранной перевозки1": {
      "main": [
        [
          {
            "node": "находим рейсы без весовой в перевозке",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим рейсы без весовой в перевозке": {
      "main": [
        [
          {
            "node": "есть рейсы или нет",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "есть рейсы или нет": {
      "main": [
        [
          {
            "node": "сколько рейсов без весовой",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "весовые загружены",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "сколько рейсов без весовой": {
      "main": [
        [
          {
            "node": "загрузите весовые",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out1": {
      "main": [
        [
          {
            "node": "Sort",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "завершение рейса1": {
      "main": [
        [
          {
            "node": "получаем odoo id8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получение перевозок2": {
      "main": [
        [
          {
            "node": "разделение перевозок",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "вам назначена срочная перевозка": {
      "main": [
        [
          {
            "node": "Выводим информацию о срочной перевозке",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "разделение перевозок": {
      "main": [
        [
          {
            "node": "Filter1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter1": {
      "main": [
        [
          {
            "node": "есть ли срочная перевозка",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "завершение рейса": {
      "main": [
        [
          {
            "node": "находим какая сейчас перевозка",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим какая сейчас перевозка": {
      "main": [
        [
          {
            "node": "выполняется сейчас срочная?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "выполняется сейчас срочная?": {
      "main": [
        [
          {
            "node": "находим рейсы по машине4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "получение перевозок2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Remove Duplicates": {
      "main": [
        [
          {
            "node": "находим перевозки, которые выведем в кнопках",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "сегодня не было перевозок",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим перевозки, которые выведем в кнопках": {
      "main": [
        [
          {
            "node": "создаём динамически инлайн кнопки2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получение перевозок1": {
      "main": [
        [
          {
            "node": "Split Out1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Нет доступных перевозок",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "есть ли еще рейсы по этой перевозке?": {
      "main": [
        [
          {
            "node": "Рейс завершен и есть еще рейсы",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Завершен рейс и перевозка",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получение перевозок3": {
      "main": [
        [
          {
            "node": "разделение перевозок1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "разделение перевозок1": {
      "main": [
        [
          {
            "node": "находим прошлую перевозку",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "завершена ли срочная перевозка": {
      "main": [
        [
          {
            "node": "получение перевозок3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "находим рейсы по машине4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "срочная перевозка завершена": {
      "main": [
        [
          {
            "node": "Выводим информацию о срочной перевозке1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим прошлую перевозку": {
      "main": [
        [
          {
            "node": "находим рейсы по машине10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "есть ли еще рейсы по этой перевозке?1": {
      "main": [
        [
          {
            "node": "завершена ли срочная перевозка",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "вам назначена срочная перевозка",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим рейсы по машине10": {
      "main": [
        [
          {
            "node": "есть ли еще рейсы по этой перевозке?2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "есть ли еще рейсы по этой перевозке?2": {
      "main": [
        [
          {
            "node": "срочная перевозка завершена",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Завершен рейс и перевозка",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим рейсы по машине9": {
      "main": [
        [
          {
            "node": "Summarize5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "есть ли срочная перевозка": {
      "main": [
        [
          {
            "node": "находим рейсы по машине9",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "находим рейсы по машине4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize5": {
      "main": [
        [
          {
            "node": "есть ли еще рейсы по этой перевозке?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим рейсы по машине4": {
      "main": [
        [
          {
            "node": "есть ли еще рейсы по этой перевозке?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "кнопки принятия и завершения заказа": {
      "main": [
        [
          {
            "node": "начатый рейс",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "получаем odoo id2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "поиск текущего авто",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ищем автомобиль с таким же сотрудником2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Рейс завершен и есть еще рейсы",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "кнопки меню ТО",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow Trigger": {
      "main": [
        [
          {
            "node": "кнопки принятия и завершения заказа",
            "type": "main",
            "index": 0
          },
          {
            "node": "Stop and Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получаем не обновленные данные1": {
      "main": [
        [
          {
            "node": "Добавление веса и количества рейсов",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим рейсы по машине": {
      "main": [
        [
          {
            "node": "получаем не обновленные данные1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "начало рейса": {
      "main": [
        [
          {
            "node": "находим рейсы по машине",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "статус ввода данных после смены": {
      "main": [
        [
          {
            "node": "Удаление дневной статистики",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "удаляем прошлое сообщение с завершением смены": {
      "main": [
        [
          {
            "node": "номер авто2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "вывод перевозок": {
      "main": [
        [
          {
            "node": "получаем odoo id8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "получаем odoo id7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "обработка кнопок ТО",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получение перевозок": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "сегодня не было перевозок",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "создаём динамически инлайн кнопки2": {
      "main": [
        [
          {
            "node": "отправляем сообщение 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "загрузите весовые": {
      "main": [
        [
          {
            "node": "меняем статус на отправку нескольких весовых",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "загрузите ттн или весовые1": {
      "main": [
        [
          {
            "node": "меняем статус на дефолтный6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "номер выбранной перевозки1": {
      "main": [
        [
          {
            "node": "запишем номер выбранной перевозки2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "запишем номер выбранной перевозки2": {
      "main": [
        [
          {
            "node": "загрузите ттн или весовые1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "загрузите ттн или весовые2": {
      "main": [
        [
          {
            "node": "номер выбранной перевозки1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sort": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ТТН и весовые в конце смены": {
      "main": [
        [
          {
            "node": "удаляем прошлое сообщение с завершением смены",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "удаляем прошлое сообщение с выбором",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "номер выбранной перевозки",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "номер авто3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "номер авто4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "загрузите ттн или весовые2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "срочно",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize6": {
      "main": [
        [
          {
            "node": "1 ли рейс?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим рейсы по машине и перевозке": {
      "main": [
        [
          {
            "node": "Summarize6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Filter2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "находим рейсы по машине и перевозке",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Replace Me": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter2": {
      "main": [
        [
          {
            "node": "есть ли перевозка",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "есть ли перевозка": {
      "main": [
        [
          {
            "node": "Limit",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Нет доступных перевозок",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1 ли рейс?": {
      "main": [
        [
          {
            "node": "если 1, то назначен ли он?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Replace Me",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "если 1, то назначен ли он?": {
      "main": [
        [
          {
            "node": "находим информацию о перевозке",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Replace Me",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим информацию о перевозке": {
      "main": [
        [
          {
            "node": "Replace Me",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Сообщение для описания проблемы": {
      "main": [
        [
          {
            "node": "статус=дефолт",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправьте данные1": {
      "main": [
        [
          {
            "node": "статус=отправка срочно маршрут",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "рейсы": {
      "main": [
        [
          {
            "node": "актуальный рейс",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "номер авто5": {
      "main": [
        [
          {
            "node": "рейсы",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "актуальный рейс": {
      "main": [
        [
          {
            "node": "есть рейс?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "есть рейс?": {
      "main": [
        [
          {
            "node": "отправьте данные1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "срочно": {
      "main": [
        [
          {
            "node": "отправьте данные",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "назад",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Сообщение для описания проблемы",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "номер авто5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "номер авто6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "номер авто6": {
      "main": [
        [
          {
            "node": "рейсы1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "рейсы1": {
      "main": [
        [
          {
            "node": "актуальный рейс1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "актуальный рейс1": {
      "main": [
        [
          {
            "node": "есть рейс?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "есть рейс?1": {
      "main": [
        [
          {
            "node": "отправьте данные2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправьте данные2": {
      "main": [
        [
          {
            "node": "статус=отправка срочно документ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "обновим статус на \"в работе\"": {
      "main": [
        [
          {
            "node": "заявка взята в работу",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "если есть ошибки",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "вывод доступных перевозок5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "вывод доступных перевозок5": {
      "main": [
        [
          {
            "node": "Выводим информацию о перевозке6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Выводим информацию о перевозке6": {
      "main": [
        [
          {
            "node": "Добавление перевозки в бд3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-07-29T06:39:46.779Z",
  "id": "uEMKTaaTwgnsC3PR",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "prod_driver_inline",
  "nodes": [
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Отправьте сообщение, фото, видео, запись диктофона или кружок",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "back_to_choise_warn"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "9503bd68-54b7-464b-9d54-d93f36bfc002",
      "name": "отправьте данные",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -1180,
        9360
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
            "status": "inputing_warn_message"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "car_id_while_inputing",
              "displayName": "car_id_while_inputing",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fuel_liters",
              "displayName": "fuel_liters",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "weight_measure",
              "displayName": "weight_measure",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "logist_alert_text",
              "displayName": "logist_alert_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "logist_recipient_name",
              "displayName": "logist_recipient_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "transportation_for_certificate",
              "displayName": "transportation_for_certificate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "count_weight_photo",
              "displayName": "count_weight_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "count_weight_photo_sent",
              "displayName": "count_weight_photo_sent",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "8aa63178-3faa-4397-9dac-557a691c7ff0",
      "name": "статус=отправка срочно",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -960,
        9360
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "only_mech": true,
            "odoo_id": "={{ $json.odoo_id }}",
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
            "status": "inputing_request"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "5edb4231-cb01-4ad2-821b-f51978aeb36f",
      "name": "меняем статус - ввод текста запроса",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        240,
        2180
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "where": {
          "values": [
            {
              "column": "tg_id",
              "value": "={{ $json.result.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "6c9f235e-02fe-4e68-9754-563f22af94b2",
      "name": "Postgres1",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -160,
        2180
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "text": "Отправьте свой комментарий механику",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "ae099eeb-025b-4daf-9a07-ec1c8d875b99",
      "name": "комментарий механику",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -500,
        2180
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Блок проверки нажатой водителем кнопки",
        "height": 5589.183573096278,
        "width": 2241.8033428606927
      },
      "id": "4827e157-e444-49cd-8485-1499b1fe2a7d",
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1000,
        1560
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Вы уверены, что готовы завершить рейс?",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Завершить",
                    "additionalFields": {
                      "callback_data": "material_volume"
                    }
                  },
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "pick"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "9c311784-f202-4be7-8acd-5353977791fd",
      "name": "Подтверждение завершения",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        820,
        1340
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "text": "Привет дорогой водитель!",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Посмотреть назначенную перевозку",
                    "additionalFields": {
                      "callback_data": "перевозки"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "e7f47cc6-6b21-40f5-8763-aefa5facad4d",
      "name": "меню после ТО",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -500,
        2000
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Отлично, отправляйте фото",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "photo_cancel"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "00cfb84f-0bac-4983-9c5c-a76dd5ff8438",
      "name": "Отправка фото",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        60,
        2320
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Вы уверены, что готовы завершить смену?",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Завершить смену",
                    "additionalFields": {
                      "callback_data": "upload_sertificate"
                    }
                  },
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "check_final"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "97b5ec15-b5a5-4d26-ae2e-9da8c2fe870b",
      "name": "Подтверждение завершения смены",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        20,
        2800
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Завершение смены\nсвои изменения буду делать белым цветом",
        "height": 538.650511832316,
        "width": 1230.4022564984548,
        "color": 6
      },
      "id": "ad2d1fa7-233a-440d-8993-1e2c46a14e2c",
      "name": "Sticky Note16",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -420,
        2780
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "where": {
          "values": [
            {
              "column": "tg_id",
              "value": "={{ $json.result.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "cc0ada60-05d8-4306-a1e0-32e17e60f854",
      "name": "получаем odoo id3",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        120,
        3000
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "employee_id",
              "value": "={{ $json.odoo_id }}"
            }
          ]
        }
      },
      "id": "0fe69ef1-bb55-471a-8e4f-0f952e53b67d",
      "name": "находим машину по odoo id3",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        320,
        3000
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "update",
        "customResourceId": "={{ $json.id }}",
        "fieldsToCreateOrUpdate": {
          "fields": [
            {
              "fieldName": "status",
              "fieldValue": "Нет водителя"
            },
            {
              "fieldName": "employee_id"
            }
          ]
        }
      },
      "id": "244f24df-24fb-4966-9a7e-943fa516bbee",
      "name": "меняем статус машины на Нет водителя",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        500,
        3000
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.tg_id }}",
            "status": "inputing_data_after_work"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "2ecbbe1e-b93f-4cac-b291-263a9bf09bf7",
      "name": "статус ввода данных после смены",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        660,
        3000
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "mech_photo": true,
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "345305c6-7d1b-4514-899d-52afee91f89c",
      "name": "Статус получения фото при неисправности",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -300,
        2400
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Вы работали в карьере?",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Да",
                    "additionalFields": {
                      "callback_data": "career"
                    }
                  },
                  {
                    "text": "Нет",
                    "additionalFields": {
                      "callback_data": "final_complete_work"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "dafed824-406e-41ed-b055-3ce713f57c8c",
      "name": "работа в карьере или нет",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -280,
        2920
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "text": "Для завершения введите <b>количество карьер-часов</b>",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "7ada8fec-5889-43b2-8b8a-98b8674b9be6",
      "name": "данные при работе в карьере",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -60,
        3000
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "text": "Cмена завершена!",
        "additionalFields": {}
      },
      "id": "56cd3d1c-4ad1-4652-948a-3955eab48365",
      "name": "Завершение смены",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -360,
        3140
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "where": {
          "values": [
            {
              "column": "tg_id",
              "value": "={{ $json.result.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "38107981-6c08-432f-9e0e-7ab93a75272b",
      "name": "получаем odoo id5",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -120,
        3180
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $json.odoo_id }}"
            }
          ]
        }
      },
      "id": "307bbcee-df9c-4134-b4cd-d66b4054b0e1",
      "name": "находим машину по odoo id5",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        40,
        3180
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "update",
        "customResourceId": "={{ $json.id }}",
        "fieldsToCreateOrUpdate": {
          "fields": [
            {
              "fieldName": "status",
              "fieldValue": "Нет водителя"
            },
            {
              "fieldName": "driver_id",
              "fieldValue": "={{ \"\" }}"
            }
          ]
        }
      },
      "id": "e3a04036-c814-497e-b6d5-b6ab845831a0",
      "name": "меняем статус машины на Нет водителя1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        220,
        3180
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "text": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.text }}",
        "additionalFields": {}
      },
      "id": "1524f16c-72b7-4aa5-9156-4dcf722f56bb",
      "name": "убираем кнопки в меню ТО",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -300,
        2060
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "text": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.text }}",
        "additionalFields": {}
      },
      "id": "83e57bbf-01d7-4bae-9be0-21a3eea95e54",
      "name": "Выводим информацию о перевозке1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        0,
        1840
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "mech_photo": false,
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "50ccd069-a25c-4668-ac80-c74d3a754947",
      "name": "Статус получения фото при неисправности1",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        400,
        2620
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Комментарий доставлен механикам",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Приступить к работе",
                    "additionalFields": {
                      "callback_data": "menu_ok"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "Добавить фото",
                    "additionalFields": {
                      "callback_data": "mech_photo"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "c75ead9f-400b-4465-a0dd-1cfb293861cb",
      "name": "отмена отправки фото",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        100,
        2620
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Ветка если человек работал в карьере",
        "height": 192.98769776932238,
        "width": 878.3119518363878
      },
      "id": "520eb1ed-6977-4eda-9af8-7add6b321fb0",
      "name": "Sticky Note29",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -100,
        2960
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "technical.maintenance",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "car_id",
              "value": "={{ $json.id }}"
            },
            {
              "fieldName": "status",
              "value": "={{ \"К выполнению\" }}"
            }
          ]
        }
      },
      "id": "c87848f8-95b2-4a17-8efa-963c431ea235",
      "name": "заявки \"к выполнению\"",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        340,
        3760
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nconst buttons = items.map((item, index) => ({\n    text: `${item.json.description_of_maintenance}`,\n    callback_data: `TR_${item.json.id}` // TR - take request\n}));\n\nconst inlineKeyboard = {\n    inline_keyboard: buttons.map(button => [button])\n};\n\nconst chatId = $('Execute Workflow Trigger').all()[0].json.callback_query.from.id;\nconst token = '7062531188:AAFkpyOiRuXLHFQO8mWKHuftPGglQSruqwo';\nconst url = `https://api.telegram.org/bot${token}/sendMessage`;\n\nconst message = {\n    chat_id: chatId,\n    text: \"Нажмите на заявку, которую хотите начать\",\n    reply_markup: inlineKeyboard\n};\n\n// Возвращаем данные для запроса\nreturn [\n    {\n        json: {\n            url,\n            message\n        }\n    }\n];\n"
      },
      "id": "3c5614ae-a5c0-4890-a3b8-3a600aa095c2",
      "name": "создаём динамически инлайн кнопки",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        780,
        3760
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.message }}",
        "options": {}
      },
      "id": "27d8785f-b5f2-444d-a29f-455bc5c6430a",
      "name": "отправляем сообщение ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1000,
        3760
      ]
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('Execute Workflow Trigger').all()[0].json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').all()[0].json.callback_query.message.message_id }}"
      },
      "id": "4deeda93-9778-4744-95fe-09bc148b8a9c",
      "name": "удаляем прошлое сообщение с заявками",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1220,
        3760
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Вывод кнопок для принятия заявки",
        "height": 257.97529446338507,
        "width": 1077.334745180572,
        "color": 6
      },
      "id": "4a045b84-e187-4cee-8ac4-da38d3c2c8bc",
      "name": "Sticky Note30",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        80,
        3680
      ]
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nconst buttons = items.map((item, index) => ({\n    text: `${item.json.description_of_maintenance}`,\n    callback_data: `ER_${item.json.id}` // FR - end request\n}));\n\nconst inlineKeyboard = {\n    inline_keyboard: buttons.map(button => [button])\n};\n\nconst chatId = $('Execute Workflow Trigger').all()[0].json.callback_query.from.id;\nconst token = '7062531188:AAFkpyOiRuXLHFQO8mWKHuftPGglQSruqwo';\nconst url = `https://api.telegram.org/bot${token}/sendMessage`;\n\nconst message = {\n    chat_id: chatId,\n    text: \"Нажмите на заявку, которую хотите завершить\",\n    reply_markup: inlineKeyboard\n};\n\n// Возвращаем данные для запроса\nreturn [\n    {\n        json: {\n            url,\n            message\n        }\n    }\n];\n"
      },
      "id": "37e1ba21-607e-4fb0-8e8c-be379cf962bf",
      "name": "создаём динамически инлайн кнопки1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        780,
        4120
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.message }}",
        "options": {}
      },
      "id": "8669c20c-c823-435f-b024-d6a24109887d",
      "name": "отправляем сообщение 1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1000,
        4120
      ]
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('Execute Workflow Trigger').all()[0].json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').all()[0].json.callback_query.message.message_id }}"
      },
      "id": "736977db-bc71-4d8c-b2d4-8a7a1463b7de",
      "name": "удаляем прошлое сообщение с заявками1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1220,
        4120
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Вывод кнопок для завершения заявки",
        "height": 257.97529446338507,
        "width": 1084.9093561699729,
        "color": 6
      },
      "id": "3efa09e0-aec1-46a7-bbdf-546dc5931b1a",
      "name": "Sticky Note31",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        80,
        4040
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "technical.maintenance",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "car_id",
              "value": "={{ $json.id }}"
            },
            {
              "fieldName": "status",
              "value": "={{ \"В работе\" }}"
            }
          ]
        }
      },
      "id": "7999f846-8777-4437-81f6-51db2504af59",
      "name": "заявки \"в работе\"",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        340,
        4120
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "0137e4ef-a4ad-47f2-8e72-76851a2041ff",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "e5cfa539-4179-41a8-909d-c389415d95cb",
      "name": "проверка наличия заявок",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        560,
        4120
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "6d3ef479-f9d1-4c48-9141-f8120a69fece",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "5fc12ac0-14e8-4fe3-8ba2-179934254c6f",
      "name": "проверка наличия заявок1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        560,
        3760
      ]
    },
    {
      "parameters": {
        "resource": "callback",
        "queryId": "={{ $('Execute Workflow Trigger').item.json.callback_query.id }}",
        "additionalFields": {
          "show_alert": true,
          "text": "Заявки не найдены"
        }
      },
      "id": "13cbd816-43a4-4557-be2a-1e515af90282",
      "name": "заявки не найдены",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        840,
        3940
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "92ad7c1c-cd84-4fc3-bf35-ca59aedad2a0",
              "name": "TO_number",
              "value": "={{ $('Execute Workflow Trigger').item.json.callback_query.data.substring(3) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "417d33f9-7047-4b08-ac79-312d76b693ab",
      "name": "номер выбранной заявки",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        440,
        4400
      ]
    },
    {
      "parameters": {
        "content": "## Водитель берёт задачу в работу",
        "height": 323.3861574435644,
        "width": 649.594490717535,
        "color": 6
      },
      "id": "f8381675-b495-4010-a6c4-fac288a0c759",
      "name": "Sticky Note32",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        400,
        4340
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {
          "fieldsList": []
        },
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_title",
              "value": "Механик"
            }
          ]
        }
      },
      "id": "8b07efee-790e-4dd8-aea4-3afaeb1c89f8",
      "name": "поиск механиков1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        1405,
        5239
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "3a05de8b-3cc8-49eb-a959-ff982b736189",
      "name": "поиск тг айди механиков1",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        1600,
        5240
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "40eca1c8-25ce-4538-9aec-0b10b421179f",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "c5bf803f-5ce3-4305-89c8-59962802b0a8",
      "name": "проверка наличия механиков1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1825,
        5239
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('поиск тг айди механиков1').item.json.tg_id }}",
        "text": "={{ $('данные авто').item.json[\"number_car\"] }} - {{ $('Execute Workflow Trigger').item.json[\"end_request_hours\"] }} ч. - {{ $('данные водителя').item.json[\"display_name\"] }} - {{ $json.description_of_maintenance }}\n\n<b>Требуется проверить корректность выставленных часов</b>\n<a href=\"https://everest.lamart.site/web#id={{ $('Execute Workflow Trigger').item.json[\"end_request_id\"] }}&cids=1&menu_id=343&action=485&model=technical.maintenance&view_type=form\">Ссылка на заявку в Odoo</a>",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Принять заявку✅",
                    "additionalFields": {
                      "callback_data": "={{\"accept_TO_\" + $('Execute Workflow Trigger').item.json.end_request_id }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "Отклонить заявку ❌",
                    "additionalFields": {
                      "callback_data": "={{\"reject_TO_\" + $('Execute Workflow Trigger').item.json.end_request_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "id": "e7bfe55a-8c10-4312-ad0c-a7eff564728c",
      "name": "Отправка проблемы механикам1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        2680,
        5220
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "text": "=Ошибка Odoo: {{ $json.error }}",
        "additionalFields": {}
      },
      "id": "64d30a3d-4319-4a4a-8766-db26fb4e942a",
      "name": "если есть ошибки",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        900,
        4506
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Заявка взята в работу. Не забудьте завершить заявку после ремонта",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Завершить заявку сейчас",
                    "additionalFields": {
                      "callback_data": "={{ \"ER_\"+$json.id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "bb5a26c4-8257-4af7-950f-e1dd4057d5a6",
      "name": "заявка взята в работу",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        900,
        4346
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "d936de5e-b34e-4950-9f56-15470cb0b0f1",
      "name": "данные водителя",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        2045,
        5215
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "content": "## Механик получает уведомление, когда водитель завершает заявку",
        "height": 250.48240620104332,
        "width": 1538.2139291185106,
        "color": 6
      },
      "id": "a05c182b-e459-429b-a799-8740d558276e",
      "name": "Sticky Note33",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1340,
        5160
      ]
    },
    {
      "parameters": {
        "content": "## Водитель завершает заявку",
        "height": 315.592882734556,
        "width": 1246.6718203422697,
        "color": 6
      },
      "id": "9a00839c-8b71-4aed-a659-db529792fa34",
      "name": "Sticky Note34",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        80,
        4680
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "text": "Введите число затраченных часов на работу:",
        "additionalFields": {}
      },
      "id": "96f94620-885d-4218-bbf1-7d6a549570a7",
      "name": "нужно вписать часы",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        860,
        4705
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "92ad7c1c-cd84-4fc3-bf35-ca59aedad2a0",
              "name": "TO_number",
              "value": "={{ $('Execute Workflow Trigger').item.json.callback_query.data.substring(3) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "080c217a-243f-4b27-a725-1aa24aacb016",
      "name": "номер выбранной заявки1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        200,
        4785
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
            "status": "inputing_request_hours",
            "end_request_id": "={{ $('номер выбранной заявки1').item.json.TO_number }}"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "052afc68-37f6-4853-8bb8-87e6fe702e1a",
      "name": "обновим статус и номер текущей заявки",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        1160,
        4705
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "text": "=Когда механик проверит заявку, вам придёт уведомление",
        "additionalFields": {}
      },
      "id": "3dace874-206a-49d1-a15d-8215e777a0bc",
      "name": "завершён процесс заявки",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        520,
        5220
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
            "end_request_id": "={{ null }}",
            "end_request_hours": "={{ null }}"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "8ed31ac0-3562-4773-8bf9-5413652a9e2d",
      "name": "убираем номер заявки из пг",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        780,
        5220
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "=Прикрепите фото исправления:",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "back_request_photo"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "3ea8edb7-0ebc-4991-8232-907d027df8a4",
      "name": "завершён процесс заявки1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        520,
        5060
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $json.result.chat.id }}",
            "status": "adding_end_request_photo"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "c3849631-9660-4ff2-940c-79cafd9609ed",
      "name": "меняем на статус отправки фотографии",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        740,
        5060
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Обработка кнопок для отправки фото завершения заявки",
        "height": 369.7365490265316,
        "width": 579.6907768759479,
        "color": 6
      },
      "id": "db9ba517-0a63-4736-b55e-03a7483c0251",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        380,
        5000
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "technical.maintenance",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "id",
              "value": "={{ $json.TO_number }}"
            }
          ]
        }
      },
      "id": "22dd9921-d46e-4db7-8984-5c2958ce0a48",
      "name": "получим актуальный статус заявки",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        400,
        4785
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "fc7e922b-a871-4029-abf2-95687ecdcc6a",
              "leftValue": "={{ $json.status }}",
              "rightValue": "В работе",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "a5fece34-9819-4fee-933b-55eed8d7e719",
      "name": "заявка в работе?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        620,
        4785
      ]
    },
    {
      "parameters": {
        "resource": "callback",
        "queryId": "={{ $('Execute Workflow Trigger').item.json.callback_query.id }}",
        "additionalFields": {
          "show_alert": true,
          "text": "Статус заявки должен быть \"В работе\""
        }
      },
      "id": "d67600fb-caa2-4df1-979f-57b7fde421ca",
      "name": "заявка уже изменена",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1000,
        4845
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "text": "У вас есть доступные рейсы",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Начать рейс",
                    "additionalFields": {
                      "callback_data": "pick"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "Отправить фото материала",
                    "additionalFields": {
                      "callback_data": "materials_photo"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "6c9c4747-6569-4b5f-9ef2-0a3266ba61fc",
      "name": "принятие заказа",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        440,
        1940
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "tg_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "280612e7-a60b-472b-a6fc-ab95606005e5",
      "name": "Получение информации о водителе1",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        780,
        1960
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "ab1dea4e-d947-4ffa-a190-704692bf9687",
              "leftValue": "={{ $json.materials_photo }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "fb17fe40-551e-45c8-9a9c-bd7f73fca947",
      "name": "If2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        980,
        1960
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "materials_photo": false,
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "0d393608-06d1-445b-80f0-d3a0d6eaa1ea",
      "name": "Обновление статуса отправки фото логисту1",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        1520,
        1960
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('принятие заказа').item.json.result.message_id -1}}"
      },
      "id": "8086ad86-d3c1-46a5-965c-1ef8412b8553",
      "name": "Telegram1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1260,
        1960
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "materials_photo": true,
            "tg_id": "={{ $('Сообщение при нажатии на кнопку отправить фото').item.json.result.chat.id }}"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "7e60f4e7-a45a-4950-a0ee-20cbb3339652",
      "name": "Обновление статуса отправки фото логисту",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        500,
        5680
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "text": "Спасибо за замену масла, следующую нужно будет произвести через 5000 км. Я обязательно пришлю вам уведомление",
        "additionalFields": {}
      },
      "id": "46418ff4-0b82-40cc-b019-044a50e20c72",
      "name": "Нажатие водителем на кнопку замена масла",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        220,
        5425
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "tg_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "688c6663-ee49-4953-ab58-c29bef96d521",
      "name": "Получаем odoo_id",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        460,
        5425
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $json.odoo_id }}"
            }
          ]
        }
      },
      "id": "d08300eb-5f80-4add-8f7f-38bf06c885ac",
      "name": "Получаем информацию о машине",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        700,
        5420
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "update",
        "customResourceId": "={{ $json.id }}",
        "fieldsToCreateOrUpdate": {
          "fields": [
            {
              "fieldName": "oil_change_schedule",
              "fieldValue": "={{ $json.odometer + 5000 }}"
            }
          ]
        }
      },
      "id": "f64cc528-02bc-4549-8534-fcd78f55c33a",
      "name": "Обновление пробега при котором нужна будет замена масла1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        960,
        5425
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "content": "## Обновление регламента замены масла после подтверждения водителем замены",
        "height": 242.0127880946941,
        "width": 1022.4114664041946,
        "color": 4
      },
      "id": "e6bb2047-73e8-4455-828c-fc8eea4ab083",
      "name": "Sticky Note37",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        120,
        5360
      ]
    },
    {
      "parameters": {
        "content": "## Отправка водителем фотографии материала",
        "height": 242.24910613248537,
        "width": 576.4460386934658,
        "color": 5
      },
      "id": "9e6ce64e-e17f-4016-9b48-0e59f3a8090a",
      "name": "Sticky Note38",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        140,
        5620
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Отправьте фотографию и ожидайте уведомление от логиста.",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "accept"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "63358123-9867-4319-9198-0637eb227b18",
      "name": "Сообщение при нажатии на кнопку отправить фото",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        240,
        5680
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Обработка кнопки \"назад\" при выборе отправки материала",
        "height": 254.01493864256875,
        "width": 981.6305810235699,
        "color": 4
      },
      "id": "bb903a05-0663-435d-ae4a-394b56741f92",
      "name": "Sticky Note40",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        720,
        1900
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "6fb344b8-2202-44d1-b21d-8f672278767c",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "menu_ok",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "68071ac7-12d9-4440-97e3-ca534a0322b2",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "menu_wrong",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "9e4bc54c-ad8b-436e-93b0-085499a35545",
      "name": "кнопки меню ТО",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -840,
        1960
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $json.id }}"
            }
          ]
        }
      },
      "id": "8885c3ba-a399-49b2-9cf1-d489c3c1cf75",
      "name": "данные авто",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        2240,
        5216
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "technical.maintenance",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "id",
              "value": "={{ $('Execute Workflow Trigger').item.json.end_request_id }}"
            }
          ]
        }
      },
      "id": "c3280502-0a53-4172-9ca2-1436e9dd5c69",
      "name": "текст заявки",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        2440,
        5216
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "=Нужно приложить фото исправления?",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Да",
                    "additionalFields": {
                      "callback_data": "yes_request_photo"
                    }
                  },
                  {
                    "text": "Нет",
                    "additionalFields": {
                      "callback_data": "no_request_photo"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "c2cbbdaf-a99b-4839-916a-ee579bb98153",
      "name": "нужно ли приложить фото?1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -280,
        5280
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $json.result.chat.id }}",
            "status": "authorized",
            "end_request_hours": "={{ $('Execute Workflow Trigger').item.json.message.text }}"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "5318497c-9096-461f-9a17-55bc53824d9a",
      "name": "возвращаем статус3",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -60,
        5280
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "yes_request_photo",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "386be4a5-616e-44af-bee7-3a9e3fee981c",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "no_request_photo",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "e0aeb7f9-0c4b-475f-bef0-1e5a98d8bd2c",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "back_request_photo",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "aa652217-529d-4c91-8e01-7025316d4388",
      "name": "фото завершения заявки",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -600,
        5160
      ]
    },
    {
      "parameters": {
        "content": "## Отмена отправки фото исправления",
        "height": 207.35648349288545,
        "width": 487.077305180272,
        "color": 6
      },
      "id": "0ad55ce5-0797-4d64-9d54-bb2647c3ddbe",
      "name": "Sticky Note45",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -360,
        5240
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "weight_or_ttn",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "db16d99c-0669-44e8-94d2-10aa8a1ae1ec",
      "name": "отправка весовых справок или ттн при завершении смены",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -1340,
        5460
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Для завершения отправьте ",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Да",
                    "additionalFields": {
                      "callback_data": "career"
                    }
                  },
                  {
                    "text": "Нет",
                    "additionalFields": {
                      "callback_data": "weight_or_ttn"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "48723721-a145-4e9a-b1f3-6cf3d228eea8",
      "name": "отправить весовую или ттн",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -1480,
        4780
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "37148036-3582-4753-b9c8-ac9468a66794",
      "name": "номер авто",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        120,
        3760
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "63d640de-9aca-4964-8ffb-e16876c47a2a",
      "name": "номер авто1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        120,
        4120
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "oil",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "5d8c11e3-17b7-408e-9ef9-e1c9ec8f3258",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "materials_photo",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "642787f1-6bb8-4a31-a499-a7b35ceaa3a0",
      "name": "кнопки отправки фото груза и замены масла",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -680,
        5560
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "back_to_input_car",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "ab7b82e9-e5cc-41d7-bec6-c86e8eea5c79",
      "name": "Switch1",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -520,
        6020
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "text": "Введите номер автомобиля заглавными буквами и без пробелов, например: А312МЕ",
        "additionalFields": {}
      },
      "id": "e0d1f8f7-5d28-492f-8a83-6f1b23403049",
      "name": "снова вводим номер авто",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        400,
        6140
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
            "status": "inputing_car_number"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "car_id_while_inputing",
              "displayName": "car_id_while_inputing",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "64c55029-7dfc-46bd-8e36-ca37f4fa13e1",
      "name": "снова ввод номера авто",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        600,
        6140
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "6fe432b0-00b2-4f03-ac77-0bdeb664853e",
      "name": "ищем автомобиль с таким же сотрудником1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -160,
        6000
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "47286136-a0d9-421b-9f0b-93270696d9ff",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "021b713d-e4f2-4c69-9583-d513bcbac2a6",
      "name": "если сотрудник уже занял авто1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        120,
        6000
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "text": "=Вы не можете занять новый автомобиль, сейчас вы привязаны к авто:\n{{ $json[\"model\"] }} {{ $json[\"number_car\"] }}",
        "additionalFields": {}
      },
      "id": "9455e24e-5577-4ae5-96be-cefb903b2888",
      "name": "он не может занять новый, пока занят старый1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        400,
        5980
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Вернуться к вводу номера",
        "height": 419.59874123065686,
        "width": 1005.9448008587696,
        "color": 6
      },
      "id": "d908e541-8c2a-402f-9ac2-bb4fc51b8200",
      "name": "Sticky Note46",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -260,
        5900
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "employee_id",
              "value": "={{ $json.id }}"
            },
            {
              "fieldName": "status",
              "value": "Нет груза"
            }
          ]
        }
      },
      "id": "6fce6ebb-3251-4218-8bb1-b471fb4608a0",
      "name": "ищем автомобиль с таким же сотрудником2",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -620,
        1740
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "47286136-a0d9-421b-9f0b-93270696d9ff",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "5dd28ce8-742f-40f0-98da-ec91bb0de3d3",
      "name": "водитель взял авто?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -360,
        1840
      ],
      "disabled": true
    },
    {
      "parameters": {
        "resource": "callback",
        "queryId": "={{ $('Execute Workflow Trigger').item.json.callback_query.id }}",
        "additionalFields": {
          "show_alert": true,
          "text": "Чтобы начать смену, нужно взять автомобиль"
        }
      },
      "id": "c9b8f9c2-69c6-464c-9b29-59dc8a567510",
      "name": "нужно взять авто",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -140,
        1940
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "На данный момент нет назначенных перевозок!",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Проверить назначенные перевозки",
                    "additionalFields": {
                      "callback_data": "проверить перевозки"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "Статистика",
                    "additionalFields": {
                      "callback_data": "stats"
                    }
                  },
                  {
                    "text": "Завершить смену",
                    "additionalFields": {
                      "callback_data": "complete_work_transportation"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "56dafb38-f1d7-4950-88af-5ef0ac296c0b",
      "name": "Нет доступных перевозок",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1620,
        3600
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}"
      },
      "id": "5faf6413-e4db-48d1-bd88-a19e47f60a01",
      "name": "Telegram3",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1820,
        3600
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "text": "На данный момент нет назначенных перевозок!",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Проверить назначенные перевозки",
                    "additionalFields": {
                      "callback_data": "проверить перевозки"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "Статистика",
                    "additionalFields": {
                      "callback_data": "stats"
                    }
                  },
                  {
                    "text": "Завершить смену",
                    "additionalFields": {
                      "callback_data": "complete_work_transportation"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "c928339b-f09b-4f30-ad82-ce0cba035333",
      "name": "Нет доступных перевозок1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        2020,
        3600
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://everest.lamart.site/accept_order",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number_car\": {{'\"'+ $json.number_car +'\"'}}\n}",
        "options": {}
      },
      "id": "38991c1f-93e6-495d-a99e-09fcddb4d149",
      "name": "начало рейса2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -300,
        3680
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $json.odoo_id }}"
            }
          ]
        }
      },
      "id": "6396f4c9-7bf1-495a-93cd-ec4237dffa90",
      "name": "находим машину по odoo id8",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -480,
        3680
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "where": {
          "values": [
            {
              "column": "tg_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "3a0b4c19-6458-40cb-8640-27b3ec6843ae",
      "name": "получаем odoo id7",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -680,
        3680
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Вывод перевозок водителю",
        "height": 326.7771809966836,
        "width": 3097.1140685838354,
        "color": 3
      },
      "id": "a6d25a3c-1d4c-4b97-8ea7-54d20a9c7128",
      "name": "Sticky Note25",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -580,
        3340
      ]
    },
    {
      "parameters": {
        "content": "## костыль смены перевозки, иначе принятие/завершение рейса не сменится на следующую перевозку",
        "height": 217.7284710963141,
        "width": 846.9736389555314,
        "color": 3
      },
      "id": "a5e0786a-4772-40f7-b8c2-10beb9305c9d",
      "name": "Sticky Note49",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -820,
        3602
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "where": {
          "values": [
            {
              "column": "tg_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "8f9d1be4-757e-4c2a-b52f-76f71ab465c3",
      "name": "получаем odoo id8",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -460,
        3420
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $json.odoo_id }}"
            }
          ]
        }
      },
      "id": "38f96d2b-daa2-4e8c-a67d-c13c3e6251d5",
      "name": "находим машину по odoo id9",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -260,
        3420
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "where": {
          "values": [
            {
              "column": "tg_id",
              "value": "={{ $json.result.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "8e8024e8-9593-45df-8ad2-0e4014ae1bee",
      "name": "получаем odoo id",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -260,
        560
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $json.odoo_id }}"
            }
          ]
        }
      },
      "id": "9a4f0b3b-7070-4412-86df-c105f60b1ac7",
      "name": "находим машину по odoo id",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -40,
        560
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "content": "## Начало рейса и смена статусов через эндпоинт",
        "height": 239.17047464637366,
        "width": 932.7416531557697,
        "color": 5
      },
      "id": "41a1526d-2e16-4e0e-84e7-6a76a1a2cf8b",
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -540,
        480
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "where": {
          "values": [
            {
              "column": "tg_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "17e919b1-7d5d-4b63-a20c-06b244c825af",
      "name": "получаем odoo id2",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -80,
        1100
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $json.odoo_id }}"
            }
          ]
        }
      },
      "id": "f711c1fa-92eb-4166-80a6-9fe7ccaa37cd",
      "name": "находим машину по odoo id2",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        80,
        1100
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "content": "## Завершение рейса и смена статусов через эндпоинт",
        "height": 238.43897179884164,
        "width": 1301.875504760007,
        "color": 5
      },
      "id": "e5acb595-563a-4215-8098-c73b8a5d778e",
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -160,
        1020
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Отлично, отправляйте фото",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "last"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "03fe00ca-6dc2-4aa0-8877-3c441043730f",
      "name": "Отправка весовой",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -400,
        2620
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Отправить фотографию весовой справки? ",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Отправить",
                    "additionalFields": {
                      "callback_data": "document"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "Отправить в конце смены",
                    "additionalFields": {
                      "callback_data": "final"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "1ac8003e-0a6f-4309-b0cc-7fef621dd775",
      "name": "Требуется ли отправка весовой",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        440,
        2420
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "where": {
          "values": [
            {
              "column": "tg_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "8856ba56-35ec-45d8-b722-f3dc8ded185c",
      "name": "получаем odoo id10",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -380,
        6480
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $json.odoo_id }}"
            }
          ]
        }
      },
      "id": "4c3cf398-a67d-4a8f-8f48-d6bcb8a390e8",
      "name": "находим машину по odoo id12",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -200,
        6480
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "1cbd546d-fe86-4f85-991b-fd34e65ecd95",
      "name": "Получение сегодняшней даты3",
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        -60,
        6480
      ]
    },
    {
      "parameters": {
        "operation": "formatDate",
        "date": "={{ $json.currentDate }}",
        "format": "=yyyy-MM-dd, 00:00:00",
        "options": {}
      },
      "id": "85e77b0d-3142-44aa-aa0d-6e684c58fb3c",
      "name": "получаем дату и время 00:2",
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        100,
        6480
      ]
    },
    {
      "parameters": {
        "operation": "formatDate",
        "date": "={{ $('Получение сегодняшней даты3').item.json.currentDate }}",
        "format": "=yyyy-MM-dd, 23:59:59",
        "outputFieldName": "newformattedDate",
        "options": {}
      },
      "id": "f04ac4de-26aa-4cc1-b558-cd8c21d76ad6",
      "name": "дата и время 23:2",
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        240,
        6480
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.round",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "car",
              "value": "={{ $('находим машину по odoo id12').item.json.id }}"
            },
            {
              "fieldName": "status",
              "value": "Завершен"
            },
            {
              "fieldName": "time",
              "operator": "greaterOrEqual",
              "value": "={{ $('получаем дату и время 00:2').item.json.formattedDate }}"
            },
            {
              "fieldName": "time",
              "operator": "lesserOrEqual",
              "value": "={{ $json.newformattedDate }}"
            }
          ]
        }
      },
      "id": "77299dcb-4514-4191-b8c8-e8b5abc8644e",
      "name": "находим рейсы по машине7",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        380,
        6480
      ],
      "alwaysOutputData": true,
      "executeOnce": false,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "field": "id"
            }
          ]
        },
        "options": {}
      },
      "id": "bcc7a29c-4c7f-4b00-9708-7b5ce4adc6d2",
      "name": "Summarize",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        760,
        6360
      ]
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "sum",
              "field": "cargo_netto"
            }
          ]
        },
        "options": {}
      },
      "id": "f564403d-ae2d-483f-818a-b558cdec3256",
      "name": "Summarize4",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        860,
        6580
      ]
    },
    {
      "parameters": {
        "mode": "combine",
        "combinationMode": "multiplex",
        "options": {}
      },
      "id": "988120da-e91a-46d2-b7b5-936a939d4e79",
      "name": "Merge5",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [
        1020,
        6480
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "text": "=Во время смены: \nКоличество выполненых рейсов: {{ $json.count_id }}\nСумма нетто: {{ $json.sum_cargo_netto }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "after_stats"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "id": "1228341b-16ae-4c86-b86a-2938c62e1810",
      "name": "Вывод статистики",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1220,
        6480
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}"
      },
      "id": "06968fb7-ff5b-48df-aa8e-7331e60e58e7",
      "name": "Удаление статистики",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -200,
        6680
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.transportation",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "id",
              "value": "={{ $json.transportation[0] }}"
            }
          ]
        }
      },
      "id": "6090e4f4-4a68-4b4a-a1b5-717dd0c7b13a",
      "name": "находим перевозки по рейсам7",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        600,
        6720
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "countUnique",
              "field": "id"
            }
          ]
        },
        "options": {}
      },
      "id": "065bceb3-7d2c-4ada-94e8-eb1a5da39b91",
      "name": "Summarize1",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        900,
        6800
      ],
      "disabled": true
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.route",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "id",
              "value": "={{ $json.route[0] }}"
            }
          ]
        }
      },
      "id": "060c398e-647e-47ce-a8be-85586acc719c",
      "name": "получаем название маршрута из перевозки7",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        1100,
        6800
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "d1967e05-fd62-4b9b-8ee5-b623f9f6fdc8",
      "name": "поиск текущего авто",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        180,
        1420
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.round",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "car",
              "value": "={{ $json.id }}"
            },
            {
              "fieldName": "status",
              "value": "Выполняется"
            }
          ]
        }
      },
      "id": "9c9a08e9-7cb0-4c5e-9599-9c4624c162f3",
      "name": "выполняющиеся рейсы",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        400,
        1420
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "2eed836a-a22c-4f31-abfd-431debae8854",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "f9f90918-1ed1-475b-8876-ecfb758eb17b",
      "name": "есть рейсы выполняющиеся",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        620,
        1420
      ]
    },
    {
      "parameters": {
        "resource": "callback",
        "queryId": "={{ $('Execute Workflow Trigger').item.json.callback_query.id }}",
        "additionalFields": {
          "show_alert": true,
          "text": "У вас нет выполняющихся рейсов"
        }
      },
      "id": "b1271a99-5e85-41bf-affb-a6d05a42046b",
      "name": "нет рейсов",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        820,
        1520
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Подтверждение завершения рейса",
        "height": 339.93292480078713,
        "width": 1030.963710220358,
        "color": 6
      },
      "id": "8bccad52-de60-42fb-ac83-7c00594374d1",
      "name": "Sticky Note55",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        140,
        1326
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "text": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.text }}",
        "additionalFields": {}
      },
      "id": "c6e334f0-9b6b-4596-ae7a-ca74066fcd77",
      "name": "удалим инлайн кнопку",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1040,
        1520
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "stats",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "56a65c23-f7c2-46db-bfcd-8287fe8833b4",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "after_stats",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "8e6875dc-658e-4f7a-8f3f-8aa1717477f3",
      "name": "Статистика1",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -660,
        6640
      ]
    },
    {
      "parameters": {
        "content": "## ввод данных о топливе",
        "height": 192.98769776932238,
        "width": 878.3119518363878,
        "color": 6
      },
      "id": "89b16d1c-65a0-4299-b40b-586ed5b4904e",
      "name": "Sticky Note56",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -740,
        7020
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "complete_work",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "0911da09-ad85-466d-b6f4-bc8a1bb02a2c",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "check_career",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "0911da09-ad85-466d-b6f4-bc8a1bb02a2c",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "career",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "0911da09-ad85-466d-b6f4-bc8a1bb02a2c",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "final_complete_work",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "8d5ad2d4-5afd-4ea6-98d0-ba7aa53e84af",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "check_fuel",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "e53fa5d5-a88b-4f37-9bf0-46d2099b8322",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "complete_work_transportation",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "5f40a9e1-d15d-4458-a7f4-9a73a2130dee",
      "name": "кнопки завершения смены",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -860,
        2980
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Вы уверены, что готовы завершить смену?",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Завершить смену",
                    "additionalFields": {
                      "callback_data": "upload_sertificate"
                    }
                  },
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "перевозки"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "ffb0b4bf-d301-4353-9a21-8f99bc94a7a9",
      "name": "Подтверждение завершения смены после вывода перевозки",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        280,
        2800
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Была ли заправка у данного автомобиля?",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Да",
                    "additionalFields": {
                      "callback_data": "fuel"
                    }
                  },
                  {
                    "text": "Нет",
                    "additionalFields": {
                      "callback_data": "check_career"
                    }
                  }
                ]
              }
            },
            {}
          ]
        },
        "additionalFields": {}
      },
      "id": "51c2156a-b039-4103-aff0-09a81abcbf70",
      "name": "была заправка",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -500,
        3180
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "3ae5ecda-cdbb-4040-bcee-c9bce8b35c48",
      "name": "поиск авто1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -200,
        7320
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_title",
              "value": "Логист"
            }
          ]
        }
      },
      "id": "e671119d-7e1b-42bc-8cf8-ba0c0dff3737",
      "name": "поиск логистов4",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -24,
        7320
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "c528f522-d580-47eb-911d-1cd7e049c6f9",
      "name": "поиск тг айди логистов4",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        196,
        7320
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "dc6c0f37-d971-40ae-99dc-e7b6a82b1559",
      "name": "преобразуем в 1 переменную4",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        656,
        7320
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.tg_id }}",
            "status": "authorized"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "6daee2a9-9d66-45db-8dfa-613b7500a9d5",
      "name": "меняем статус на обычный2",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        1116,
        7320
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "Не удалось отправить информацию, логист не найден",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Продолжить",
                    "additionalFields": {
                      "callback_data": "check_career"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "f9b9ab75-b6b3-47bf-a4a9-ede2cb3d9777",
      "name": "если не отправилось2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        816,
        7480
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Отправка информации о литрах логисту",
        "height": 340.04935999199654,
        "width": 1584.447064897881,
        "color": 6
      },
      "id": "d256ea99-4ef6-44ba-9713-d790c408f69a",
      "name": "Sticky Note59",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -240,
        7220
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $json.tg_id }}",
        "text": "=Заправка: авто {{ $('поиск авто1').item.json.number_car }}, {{ $('Execute Workflow Trigger').item.json.fuel_liters }}л. Чек не сохранился",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "5da9598c-46aa-4255-80d2-786281c1c3a3",
      "name": "Отправка литров логисту",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        436,
        7320
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.tg_id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Информация о литрах доставлена логисту",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Продолжить",
                    "additionalFields": {
                      "callback_data": "check_career"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "ec797c46-0ab9-48c5-a178-0d09717d6075",
      "name": "Инфа доставлена",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        880,
        7320
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "text": "Сколько литров вы заправили в автомобиль? Введите число, например: 100",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "0d834006-0648-46e4-b3e7-9ade6fb1466b",
      "name": "данные о литрах",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -460,
        7060
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Отправьте фотографию чека с заправки:",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад ",
                    "additionalFields": {
                      "callback_data": "cancel_receipt_photo"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "10e30ffc-1338-47be-a968-7a0b6bc67f99",
      "name": "фото чека",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -200,
        7620
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.tg_id }}",
            "status": "inputing_fuel_count"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "747fc565-b629-4d82-8483-1be83ce7fc9c",
      "name": "статус ввода литров",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -240,
        7060
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "У вас сохранился чек?",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Да",
                    "additionalFields": {
                      "callback_data": "add_fuel_receipt"
                    }
                  },
                  {
                    "text": "Нет",
                    "additionalFields": {
                      "callback_data": "no_receipt"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "01a232c4-ae36-41aa-bbc5-eec505e5782e",
      "name": "есть ли чек",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -260,
        7800
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Фото чека",
        "height": 334.02911078486767,
        "width": 615.1032860836,
        "color": 6
      },
      "id": "5d094a80-5a95-4538-988d-6270bbd5716c",
      "name": "Sticky Note60",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -380,
        7584
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Выберите меру исчисления перевозимого материала:",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "м3",
                    "additionalFields": {
                      "callback_data": "measure_m3"
                    }
                  },
                  {
                    "text": "Тонны",
                    "additionalFields": {
                      "callback_data": "measure_t"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "47c1c7a6-771b-4cf2-9cbe-f5468f214ac2",
      "name": "выбор меры",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        60,
        8040
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "fuel",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "f94be98c-f8f1-4704-98c0-334305d62c81",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "no_receipt",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "2fd426ab-a8c4-4d3d-ac1c-695cb0c9155b",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "add_fuel_receipt",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "4e2010a9-533d-40b6-8dd9-d434e1f1fb81",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "cancel_receipt_photo",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "25e95844-cc72-44b6-bd2b-872f30fcd608",
      "name": "данные о топливе",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -680,
        7060
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.tg_id }}",
            "status": "photo_fuel_receipt"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "5addaf66-f98b-4b74-ac61-b05cb452c315",
      "name": "статус=чек фото",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -20,
        7620
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.tg_id }}",
            "status": "authorized"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "car_id_while_inputing",
              "displayName": "car_id_while_inputing",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fuel_liters",
              "displayName": "fuel_liters",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "6654eace-587e-4943-bca9-78833b588ef6",
      "name": "статус дефолтный",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -20,
        7800
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.tg_id }}",
            "status": "authorized"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "car_id_while_inputing",
              "displayName": "car_id_while_inputing",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fuel_liters",
              "displayName": "fuel_liters",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "40dc9874-65f2-4650-817d-4133401c70dc",
      "name": "статус=дефолтный",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        240,
        8040
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Введите количество перевозимого материала: Пример: 57,2",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "material_volume"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "8116102a-d7a8-4c29-89f3-c77359552c91",
      "name": "ввод количества материала",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        300,
        8300
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.tg_id }}",
            "status": "inputing_material_volume",
            "weight_measure": "={{ $json.measure }}"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "car_id_while_inputing",
              "displayName": "car_id_while_inputing",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fuel_liters",
              "displayName": "fuel_liters",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "weight_measure",
              "displayName": "weight_measure",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "208aebf4-fef7-468e-bd50-eb4269f0b423",
      "name": "статус=ввод количества материала",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        120,
        8300
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "send_photo",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "219e6b5f-9163-4d47-be94-eaa66793d95e",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "last",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "9ae7ddc4-13c4-4009-8856-5b2bfbe14441",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "mech_photo",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "5273404d-720b-4e65-82f4-df39ecd37ae7",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "photo_cancel",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "4c57a215-ac3c-40f6-b79d-95384548ad56",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "document",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "bc1e7087-166a-432d-b363-b59a8a5082be",
      "name": "Кнопки после отправки фото",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -840,
        2340
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c998d5a5-0ba2-42ce-94b8-7eb8c4900754",
              "name": "measure",
              "value": "м3",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "bd46496e-1a8c-4f05-8410-3e300e5cfaf7",
      "name": "мера",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        -100,
        8220
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "cd7f631a-2dd0-4bd9-a162-d6b2e9db5ffe",
              "name": "measure",
              "value": "Тонны",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "803526d2-98bc-44aa-80c6-7ca87174c8eb",
      "name": "мера1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        -100,
        8400
      ]
    },
    {
      "parameters": {
        "content": "## сохранение объёма материала",
        "height": 589.7232460239827,
        "width": 841.1891717773943,
        "color": 6
      },
      "id": "42ba9155-6da3-4d76-b0ff-1464dc90a941",
      "name": "Sticky Note61",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -480,
        7960
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Отлично, вы завершили рейс, хотите начать следующий?",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Начать рейс",
                    "additionalFields": {
                      "callback_data": "pick"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "Завершить смену",
                    "additionalFields": {
                      "callback_data": "complete_work"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "1c85bd41-acf8-4e6c-98f6-1cfb9051e45b",
      "name": "Рейс завершен и есть еще рейсы",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1720,
        1040
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Отлично, рейс активен, по его завершению нажмите на кнопку <b><i>\"Завершить рейс\"</i></b>",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Завершить рейс",
                    "additionalFields": {
                      "callback_data": "Finish"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "5ded974a-27fc-4038-9299-ee62f6a5ce50",
      "name": "начатый рейс",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -480,
        560
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Вы выполнили все рейсы по данной перевозке!",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Посмотреть назначенную перевозку",
                    "additionalFields": {
                      "callback_data": "перевозки"
                    }
                  }
                ]
              }
            },
            {}
          ]
        },
        "additionalFields": {}
      },
      "id": "e91a0dd7-d536-4a7d-ba65-403dab90504f",
      "name": "Завершен рейс и перевозка",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1720,
        1200
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
            "status": "authorized"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "f5141826-2bf3-452c-93ce-5b728946ed85",
      "name": "меняем статус на дефолтный2",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        220,
        2420
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "only_mech": false,
            "tg_id": "={{ $json.result.chat.id }}",
            "status": "weight_photo"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "69920f94-6a44-41d9-beb3-a1832e6eb7c8",
      "name": "меняем статус на отправку весовой",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -200,
        2620
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "material_volume",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "24448d12-7e1b-4732-a4a0-0221bb3273da",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "measure_m3",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "5cf07c1d-3184-4f47-b88a-2fc5bea5dd8a",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "measure_t",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "b58afac1-ab0c-42f5-a11a-404c4fb64175",
      "name": "объём материала",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -720,
        8040
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Выберите документ, который хотите проверить",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "ТТН",
                    "additionalFields": {
                      "callback_data": "check_TTN"
                    }
                  },
                  {
                    "text": "Весовые справки",
                    "additionalFields": {
                      "callback_data": "check_weight"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "back_certificate"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "aea6bba3-fcb8-43b9-802c-1fb1e58dec5d",
      "name": "загрузите ттн или весовые",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        60,
        9040
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.message }}",
        "options": {}
      },
      "id": "ace60ab0-1639-40ca-a672-1f1c6ec0c2d2",
      "name": "отправляем сообщение 2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1020,
        8660
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "2ff5adb4-f2c1-45c0-a931-bd51692774fa",
      "name": "номер авто2",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -400,
        8660
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "transportations",
        "include": "allOtherFields",
        "options": {}
      },
      "id": "c267a5f2-236e-43c5-82ab-a0765a31bc1f",
      "name": "Split Out",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        20,
        8660
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "take_to",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "535cadc8-a70a-4a72-a932-a352cc94843b",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "finish_to",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "4a9a6c70-e2e7-4ac3-ad3b-9b2fc779f25d",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "={{ \"TR_\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "9c15e9b8-76c9-4f34-96af-cf0008354db6",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "={{ \"ER_\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "dad72393-4e2e-4d51-bc50-e717cb7aa7b8",
      "name": "обработка кнопок ТО",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -860,
        3980
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "92ad7c1c-cd84-4fc3-bf35-ca59aedad2a0",
              "name": "TS_number",
              "value": "={{ $('Execute Workflow Trigger').item.json.callback_query.data.substring(3) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "356bb5f3-682b-44ae-9243-8bc0043f6a75",
      "name": "номер выбранной перевозки",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        -380,
        9040
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
            "transportation_for_certificate": "={{ $json.TS_number }}"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "car_id_while_inputing",
              "displayName": "car_id_while_inputing",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fuel_liters",
              "displayName": "fuel_liters",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "weight_measure",
              "displayName": "weight_measure",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "logist_alert_text",
              "displayName": "logist_alert_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "logist_recipient_name",
              "displayName": "logist_recipient_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "transportation_for_certificate",
              "displayName": "transportation_for_certificate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "dda254f7-8645-4579-8d1a-e1294e2ff24f",
      "name": "запишем номер выбранной перевозки",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -160,
        9040
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
            "transportation_for_certificate": "={{ null }}"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "car_id_while_inputing",
              "displayName": "car_id_while_inputing",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fuel_liters",
              "displayName": "fuel_liters",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "weight_measure",
              "displayName": "weight_measure",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "logist_alert_text",
              "displayName": "logist_alert_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "logist_recipient_name",
              "displayName": "logist_recipient_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "transportation_for_certificate",
              "displayName": "transportation_for_certificate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "8e1e2747-3f8f-463c-9e20-9189f1b44896",
      "name": "запишем номер выбранной перевозки1",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -180,
        8820
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('Execute Workflow Trigger').all()[0].json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').all()[0].json.callback_query.message.message_id }}"
      },
      "id": "0e80233a-9caf-4076-b867-95dc7fe282fd",
      "name": "удаляем прошлое сообщение с выбором",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -400,
        8820
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Вывод перевозок динамическими инлайн кнопками для дальнейшей проверки документов\nА также возврат к этому меню",
        "height": 396.78241746442734,
        "width": 1829.5306633264163
      },
      "id": "b2bdb4f4-7960-400b-b8ad-92b60d37a477",
      "name": "Sticky Note8",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -640,
        8600
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.round",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "transportation",
              "value": "={{ $json.transportations.id }}"
            },
            {
              "fieldName": "status",
              "value": "Завершен"
            },
            {
              "fieldName": "ttn"
            },
            {
              "fieldName": "car",
              "value": "={{ $('номер авто2').item.json.id }}"
            }
          ]
        }
      },
      "id": "1b175427-d72d-4ddc-92dd-a8671d044bd0",
      "name": "находим рейсы без ттн",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        220,
        8660
      ],
      "alwaysOutputData": true,
      "executeOnce": false,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "0877e75f-bb1f-4e87-906e-e0100b260793",
      "name": "номер авто3",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -560,
        9440
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "tg_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "17238a90-1fa3-4c3a-858f-f1ed330c66a1",
      "name": "получаем id выбранной перевозки",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -320,
        9440
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.round",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "transportation",
              "value": "={{ $json.transportation_for_certificate }}"
            },
            {
              "fieldName": "status",
              "value": "Завершен"
            },
            {
              "fieldName": "car",
              "value": "={{ $('номер авто3').item.json.id }}"
            }
          ]
        }
      },
      "id": "f123cc28-b3c7-4a33-bb18-8c92a14dd5f6",
      "name": "находим рейсы  в перевозке",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        100,
        9360
      ],
      "alwaysOutputData": true,
      "executeOnce": false,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "field": "id"
            }
          ]
        },
        "options": {}
      },
      "id": "74bd0335-49e1-42c2-a496-7f7583d23812",
      "name": "сколько всего рейсов в перевозке по машине",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        320,
        9360
      ]
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "field": "ttn"
            }
          ]
        },
        "options": {}
      },
      "id": "86aedcfd-41ef-4aac-897c-a1d1dbedfa14",
      "name": "сколько рейсов без ттн",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        320,
        9580
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.round",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "transportation",
              "value": "={{ $('получаем id выбранной перевозки').item.json.transportation_for_certificate }}"
            },
            {
              "fieldName": "status",
              "value": "Завершен"
            },
            {
              "fieldName": "ttn"
            },
            {
              "fieldName": "car",
              "value": "={{ $('номер авто3').item.json.id }}"
            }
          ]
        }
      },
      "id": "57ad141a-9de9-4bb2-8f62-95b1832f9d59",
      "name": "находим рейсы без ттн в перевозке",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        100,
        9580
      ],
      "alwaysOutputData": true,
      "executeOnce": false,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "62b9cd55-3ac5-4d9e-a1dc-c4f5c083d658",
              "leftValue": "={{ $json.count_id }}",
              "rightValue": "={{ $json.count_ttn }}",
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "c4317b36-c1a1-4fc8-8d92-d83c7cfdabad",
      "name": "сравниваем общее кол-во рейсов и рейсов без ттн",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        800,
        9460
      ]
    },
    {
      "parameters": {
        "mode": "combine",
        "combinationMode": "multiplex",
        "options": {}
      },
      "id": "ee78ad9c-b3ed-456b-89a3-cc0ce71364d1",
      "name": "объединяем кол-во в одно",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [
        600,
        9460
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "❗Вы не загружали ТТН по данной перевозке.\nОтправьте фото для загрузки",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "={{ `TS_${$('получаем id выбранной перевозки').item.json.transportation_for_certificate}`}}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "309f177a-c7f4-4b8d-8443-eca98a28c6fb",
      "name": "загрузите ттн",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1120,
        9320
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "ТТН по данной перевозке загружена✅",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "={{ `TS_${$('получаем id выбранной перевозки').item.json.transportation_for_certificate}`}}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "bfb9c6a2-fdb9-4b3b-96b7-8e250569b2de",
      "name": "ттн загружена",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1120,
        9500
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
            "status": "authorized"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "eb36e1e0-1647-45a6-9a22-a365d7314f0d",
      "name": "меняем статус на дефолтный4",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        280,
        9040
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "only_mech": false,
            "tg_id": "={{ $json.result.chat.id }}",
            "status": "TTN_photo"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "ed5f781f-1507-4f0c-bd35-9a93e64bb6f2",
      "name": "меняем статус на отправку ТТН",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        1300,
        9320
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Меню с выбором ттн, весовой или возврата к перевозкам",
        "height": 197.9358524347207,
        "width": 922.1693440210809
      },
      "id": "03dca52e-c983-49c9-8a05-23bbe32ab935",
      "name": "Sticky Note43",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -449,
        9000
      ]
    },
    {
      "parameters": {
        "content": "## Проверка необходимости загрузки ттн",
        "height": 496.7072782298619,
        "width": 2031.4883429481965
      },
      "id": "13348168-4740-4cef-b8d0-a8af9b66a1f5",
      "name": "Sticky Note44",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -600,
        9220
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "484b8238-5ef4-406e-a6a1-bc023e04a90c",
      "name": "номер авто4",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -540,
        9920
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "tg_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "cdc4b177-a515-48a7-9ab9-62540df0e0da",
      "name": "получаем id выбранной перевозки1",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -300,
        9920
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Проверка необходимости загрузки ттн",
        "height": 385.52249089873953,
        "width": 1629.9877220302546
      },
      "id": "7c61b844-77ed-4e8e-b0b0-cb75c12a356b",
      "name": "Sticky Note64",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -580,
        9840
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.round",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "transportation",
              "value": "={{ $('получаем id выбранной перевозки1').item.json.transportation_for_certificate }}"
            },
            {
              "fieldName": "status",
              "value": "Завершен"
            },
            {
              "fieldName": "weight_certificate"
            },
            {
              "fieldName": "car",
              "value": "={{ $('номер авто4').item.json.id }}"
            }
          ]
        }
      },
      "id": "5d32d7d5-983b-4933-88a5-b03dbd6dde88",
      "name": "находим рейсы без весовой в перевозке",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -40,
        9920
      ],
      "alwaysOutputData": true,
      "executeOnce": false,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Все весовые справки по данной перевозке загружена✅",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "={{ `TS_${$('получаем id выбранной перевозки1').item.json.transportation_for_certificate}`}}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "736d77c4-9fca-4dfb-b584-44b599810289",
      "name": "весовые загружены",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        440,
        10080
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "211055ce-8e69-443a-9229-a0997cc776a2",
              "leftValue": "={{ $('находим рейсы без весовой в перевозке').item.json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "37404928-f95f-4a21-b088-82dcd238a27e",
      "name": "есть рейсы или нет",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        180,
        9920
      ]
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "field": "weight_certificate"
            }
          ]
        },
        "options": {}
      },
      "id": "0d962917-1b71-429d-8781-d27b15db75e5",
      "name": "сколько рейсов без весовой",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        440,
        9900
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $json.result.chat.id }}",
            "status": "many_weight_photo",
            "count_weight_photo": "={{ $('сколько рейсов без весовой').item.json.count_weight_certificate }}",
            "count_weight_photo_sent": 0
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "car_id_while_inputing",
              "displayName": "car_id_while_inputing",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fuel_liters",
              "displayName": "fuel_liters",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "weight_measure",
              "displayName": "weight_measure",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "logist_alert_text",
              "displayName": "logist_alert_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "logist_recipient_name",
              "displayName": "logist_recipient_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "transportation_for_certificate",
              "displayName": "transportation_for_certificate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "count_weight_photo",
              "displayName": "count_weight_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "count_weight_photo_sent",
              "displayName": "count_weight_photo_sent",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "0ec5a53a-c3c7-458c-9758-0963e9d501f5",
      "name": "меняем статус на отправку нескольких весовых",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        880,
        9900
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "transportations",
        "include": "allOtherFields",
        "options": {}
      },
      "id": "71d6ea06-8748-4218-857b-5f2a26bdf5e3",
      "name": "Split Out1",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        180,
        3380
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://everest.lamart.site/complete_round",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number_car\": {{'\"'+ $('находим машину по odoo id8').item.json.number_car +'\"'}}\n}",
        "options": {}
      },
      "id": "b4fb820a-6ae3-4f84-8ca0-8c6045cfcb08",
      "name": "завершение рейса1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -120,
        3680
      ]
    },
    {
      "parameters": {
        "url": "https://everest.lamart.site/transportations_by_car",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number_car\": {{'\"'+ $('находим машину по odoo id2').item.json.number_car +'\"'}}\n} ",
        "options": {}
      },
      "id": "9a063f80-dd9e-4256-88a0-cf9d5d86bbac",
      "name": "получение перевозок2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        40,
        840
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Вам назначена срочная перевозка:",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "2f5e1780-2545-4a9c-81b4-3d86b40bcba0",
      "name": "вам назначена срочная перевозка",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1420,
        820
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "text": "=Отправитель - <b>{{ $('Filter1').item.json.transportations[\"sender\"][1] }}</b>\nПолучатель - <b>{{ $('Filter1').item.json.transportations[\"partner\"][1] }}</b>\nМаршрут - <b>{{ $('Filter1').item.json.transportations.route[1] }}</b>\nМатериал - <b>{{ $('Filter1').item.json.transportations.material[1] }}</b>\nКомментарий - <b>{{ $('Filter1').item.json.transportations.comment }}</b> ",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Приступить к перевозке",
                    "additionalFields": {
                      "callback_data": "accept"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "id": "06514f73-f1a7-4f07-bc7f-e608bd0d7d9b",
      "name": "Выводим информацию о срочной перевозке",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1640,
        820
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "transportations",
        "include": "allOtherFields",
        "options": {}
      },
      "id": "9f3054cd-1fe2-41ac-9187-a39cd2011812",
      "name": "разделение перевозок",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        240,
        840
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "b7b19961-4591-41af-8992-c960138ac1ea",
              "leftValue": "={{ $json.transportations.type }}",
              "rightValue": "Срочная",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "bf0c4565-e738-4d26-9a43-1c90d0e78e6c",
      "name": "Filter1",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [
        440,
        840
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://everest.lamart.site/complete_round",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number_car\": {{'\"'+ $json.number_car +'\"'}}\n}",
        "options": {}
      },
      "id": "32856c10-63e0-445c-9a0a-aca7e72d0883",
      "name": "завершение рейса",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        240,
        1100
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.transportation",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "id",
              "value": "={{ $json.current_transportation[0] }}"
            }
          ]
        }
      },
      "id": "4b2a424e-6f64-4abc-9bb0-b0dd28a2ddab",
      "name": "находим какая сейчас перевозка",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        440,
        1100
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "e24d83cc-dc2d-4d01-8af3-ff146b515d82",
              "leftValue": "={{ $json.type }}",
              "rightValue": "Срочная",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "c87d52a8-b033-4521-acbe-c8168704b95c",
              "leftValue": "={{ $('находим машину по odoo id2').item.json.current_transportation[0] }}",
              "rightValue": "={{ $('завершение рейса').item.json.current_transportation[0] }}",
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "bf449126-606f-4a7f-84ea-5db2b60e28ac",
      "name": "выполняется сейчас срочная?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        700,
        1100
      ]
    },
    {
      "parameters": {
        "compare": "selectedFields",
        "fieldsToCompare": "transportation[0]",
        "options": {}
      },
      "id": "b3d7b228-409d-47b1-a874-56751d9fdad9",
      "name": "Remove Duplicates",
      "type": "n8n-nodes-base.removeDuplicates",
      "typeVersion": 1,
      "position": [
        420,
        8660
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.transportation",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "id",
              "value": "={{ $json.transportation[0] }}"
            }
          ]
        }
      },
      "id": "9c505dfc-4ddc-4f72-80bb-3be7ad4833ee",
      "name": "находим перевозки, которые выведем в кнопках",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        620,
        8660
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "url": "https://everest.lamart.site/transportations_by_car",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number_car\": {{'\"'+ $json.number_car +'\"'}}\n} ",
        "options": {}
      },
      "id": "94787920-fb12-4807-b16a-8fd0009b1f0b",
      "name": "получение перевозок1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -40,
        3420
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://everest.lamart.site/accept_order",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number_car\": {{'\"'+ $json.number_car +'\"'}}\n}",
        "options": {}
      },
      "id": "f362b0ae-0b34-4fa6-b72f-a2a825bfceab",
      "name": "начало рейса",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        220,
        560
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "dc2c4b42-32a5-4439-bfc6-f23aa5c47e03",
              "leftValue": "={{ $('находим рейсы по машине4').item.json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "5a37c796-b8c7-4b16-baef-588ea7b4d984",
      "name": "есть ли еще рейсы по этой перевозке?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1460,
        1080
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "text": "=Отправитель - <b>{{ $('находим прошлую перевозку').item.json.transportations[\"sender\"][1] }}</b>\nПолучатель - <b>{{ $('находим прошлую перевозку').item.json.transportations[\"partner\"][1] }}</b>\nМаршрут - <b>{{ $('находим прошлую перевозку').item.json.transportations.route[1] }}</b>\nМатериал - <b>{{ $('находим прошлую перевозку').item.json.transportations.material[1] }}</b>\nКомментарий - <b>{{ $('находим прошлую перевозку').item.json.transportations.comment }}</b> ",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Продолжить перевозку",
                    "additionalFields": {
                      "callback_data": "accept"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "id": "e8467941-95db-4156-bed1-4d3430b0b009",
      "name": "Выводим информацию о срочной перевозке1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        2640,
        600
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "url": "https://everest.lamart.site/transportations_by_car",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number_car\": {{'\"'+ $('находим машину по odoo id2').item.json.number_car +'\"'}}\n} ",
        "options": {}
      },
      "id": "9941aaf6-228d-467a-bea5-c38dfdc93d9c",
      "name": "получение перевозок3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1440,
        600
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "transportations",
        "include": "allOtherFields",
        "options": {}
      },
      "id": "31b30410-7498-421d-83b5-e2fea63dca8a",
      "name": "разделение перевозок1",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        1640,
        600
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "bb8153e1-c56a-4454-a9d3-3d7fe5fd3d07",
              "leftValue": "={{ $('находим машину по odoo id2').item.json.current_transportation[0] }}",
              "rightValue": "={{ $('завершение рейса').item.json.current_transportation[0] }}",
              "operator": {
                "type": "number",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "f45247cc-d126-4d4a-99f2-d679e16f4a02",
      "name": "завершена ли срочная перевозка",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1200,
        600
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Вы завершили срочную перевозку\nДо этого Вы выполняли перевозку:",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "b346166d-4547-47fd-a74b-3e75571fa260",
      "name": "срочная перевозка завершена",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        2440,
        600
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "b7b19961-4591-41af-8992-c960138ac1ea",
              "leftValue": "={{ $json.transportations.status }}",
              "rightValue": "Выполняется",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "5a61de57-7c06-4354-93fb-20f077c6a0db",
              "leftValue": "={{ $json.transportations.type }}",
              "rightValue": "Запланированная",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "c477b8da-20ae-4e4a-8736-ccbee1c884c0",
      "name": "находим прошлую перевозку",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [
        1840,
        600
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "dc2c4b42-32a5-4439-bfc6-f23aa5c47e03",
              "leftValue": "={{ $json.count_id }}",
              "rightValue": 1,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "017547c3-2c12-4afb-aec2-f9108fc1ef00",
      "name": "есть ли еще рейсы по этой перевозке?1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1220,
        840
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.round",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "transportation",
              "value": "={{ $json.transportations.id }}"
            },
            {
              "fieldName": "car",
              "value": "={{ $('находим машину по odoo id2').item.json.id }}"
            },
            {
              "fieldName": "status",
              "value": "Назначен"
            }
          ]
        }
      },
      "id": "61546548-8faf-45ce-8173-9c601355fee0",
      "name": "находим рейсы по машине10",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        2040,
        600
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "dc2c4b42-32a5-4439-bfc6-f23aa5c47e03",
              "leftValue": "={{ $('находим рейсы по машине10').item.json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "e8d8e92c-0195-4c41-b56d-5c72de773055",
      "name": "есть ли еще рейсы по этой перевозке?2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        2220,
        600
      ],
      "executeOnce": true
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.round",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "transportation",
              "value": "={{ $('Filter1').item.json.transportations.id }}"
            },
            {
              "fieldName": "car",
              "value": "={{ $('находим машину по odoo id2').item.json.id }}"
            }
          ]
        }
      },
      "id": "3155e737-8265-40f5-b423-52478dd4e8ed",
      "name": "находим рейсы по машине9",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        840,
        840
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "e24d83cc-dc2d-4d01-8af3-ff146b515d82",
              "leftValue": "={{ $('Filter1').item.json }}",
              "rightValue": "Срочная",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "afdc9cca-ce80-4541-8234-1f82c917e6bf",
      "name": "есть ли срочная перевозка",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        620,
        840
      ]
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "field": "id"
            }
          ]
        },
        "options": {}
      },
      "id": "4844b23b-daa5-41c7-9c54-f1adbf3881a5",
      "name": "Summarize5",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        1040,
        840
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.round",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "transportation",
              "value": "={{ $('находим машину по odoo id2').item.json.current_transportation[0] }}"
            },
            {
              "fieldName": "car",
              "value": "={{ $('завершение рейса').item.json.id }}"
            },
            {
              "fieldName": "status",
              "value": "Назначен"
            }
          ]
        }
      },
      "id": "520f6877-f955-43d0-b8a8-6a71f350f579",
      "name": "находим рейсы по машине4",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        1240,
        1080
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "pick",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "ab29fac3-d8a1-4277-9aac-c46a8ca3e960",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "final",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "1fb76a2e-1b73-4555-8e9c-fb47193d2c4b",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "Finish",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "e7143341-d29c-49ad-8647-8595445df788",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "accept",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "3a3f51d5-25e1-4bec-a3eb-9615ed6e6ce3",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "check_final",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "cc338d0a-64ad-4f94-b71e-e2501ffae493",
      "name": "кнопки принятия и завершения заказа",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -1080,
        1420
      ]
    },
    {
      "parameters": {},
      "id": "09eb656a-15e5-451f-9e99-a6ccfd371f4f",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        -1880,
        1280
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "transportation",
          "mode": "list",
          "cachedResultName": "transportation"
        },
        "where": {
          "values": [
            {
              "column": "id",
              "value": "={{ $('начало рейса').item.json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "fa01e4ad-4491-47cd-8843-73e6b873112e",
      "name": "получаем не обновленные данные1",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        660,
        460
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "transportation",
          "mode": "list",
          "cachedResultName": "transportation"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('начало рейса').item.json.id }}",
            "count": "={{ $json.count +1 }}",
            "driver_id": "={{ $('получаем odoo id').item.json.odoo_id }}",
            "weigth": "={{ $json.weigth +  $('находим рейсы по машине').item.json.cargo_netto }}"
          },
          "matchingColumns": [
            "id",
            "driver_id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": true,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "name",
              "displayName": "name",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "count",
              "displayName": "count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "weigth",
              "displayName": "weigth",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "driver_id",
              "displayName": "driver_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "de446dfb-ff42-4ea4-a670-1e9d7e4c6be9",
      "name": "Добавление веса и количества рейсов",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        840,
        460
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.round",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "transportation",
              "value": "={{ $('находим машину по odoo id').item.json.current_transportation[0] }}"
            },
            {
              "fieldName": "car",
              "value": "={{ $('находим машину по odoo id').item.json.id }}"
            },
            {
              "fieldName": "status",
              "value": "Выполняется"
            }
          ]
        }
      },
      "id": "c45b87d6-acb4-4703-b1e5-97bfedc4642d",
      "name": "находим рейсы по машине",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        460,
        460
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteTable",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "transportation",
          "mode": "list",
          "cachedResultName": "transportation"
        },
        "deleteCommand": "delete",
        "where": {
          "values": [
            {
              "column": "driver_id",
              "value": "={{ $json.odoo_id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "703961a5-92b8-4b14-ad4f-3a2cba30918b",
      "name": "Удаление дневной статистики",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        880,
        3000
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('Execute Workflow Trigger').all()[0].json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').all()[0].json.callback_query.message.message_id }}"
      },
      "id": "045f5158-8118-4ba4-8d71-e800c0334054",
      "name": "удаляем прошлое сообщение с завершением смены",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -620,
        8660
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "перевозки",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "fb9a1b1c-a489-41b3-a81d-8e83aab4ad83",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "проверить перевозки",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "aacdc038-4a8c-4fa3-89e5-bd369f65585a",
      "name": "вывод перевозок",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -840,
        3400
      ]
    },
    {
      "parameters": {
        "content": "## Меню выполнения следующего рейса, либо перевозка заверена",
        "height": 326.33462121963237,
        "width": 711.5058573856858
      },
      "id": "4dd99e66-5b46-4c1f-9b5c-0a8b3e9da8b6",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1160,
        1000
      ]
    },
    {
      "parameters": {
        "content": "## Проверка наличия срочной перевозки",
        "height": 190.88466314753396,
        "width": 1374.4966262860821
      },
      "id": "37e88e61-e982-4766-aea9-7dadca6c13fd",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        805.5871571978169
      ]
    },
    {
      "parameters": {
        "content": "## Вывод срочной перевозки",
        "height": 210.2083569266656,
        "width": 451.40360811227606,
        "color": 5
      },
      "id": "c829c58e-e1bf-46c6-bdc9-bf66cc648568",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1380,
        780
      ]
    },
    {
      "parameters": {
        "content": "## Завершена ли срочная еревозка и возврат к предыдущей",
        "height": 223.82830383823693,
        "width": 1656.5765497002262
      },
      "id": "d7dfbdf4-b699-46b6-ab5f-c0f680bfda6b",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1140,
        561.4692021114788
      ]
    },
    {
      "parameters": {
        "url": "https://everest.lamart.site/transportations_by_car",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number_car\": {{'\"'+ $json.number_car +'\"'}}\n} ",
        "options": {}
      },
      "id": "fa9149d1-44d8-492a-aa39-42347f11f0f3",
      "name": "получение перевозок",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -180,
        8660
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nconst buttons = items.map((item, index) => ({\n    text: `${item.json.route[1]}`,\n    callback_data: `TS_${item.json.id}` // TR - take request\n}));\n\nconst inlineKeyboard = {\n    inline_keyboard: [\n        ...buttons.map(button => [button]), // динамические кнопки, каждая строка содержит одну кнопку\n        [{ text: \"Завершить проверку\", callback_data: \"check_fuel\" }] // постоянная кнопка\n    ]\n};\n\nconsole.log(JSON.stringify(inlineKeyboard, null, 2));\n\nconst chatId = $('Execute Workflow Trigger').all()[0].json.callback_query.from.id;\nconst token = '7062531188:AAFkpyOiRuXLHFQO8mWKHuftPGglQSruqwo';\nconst url = `https://api.telegram.org/bot${token}/sendMessage`;\n\nconst message = {\n    chat_id: chatId,\n    text: \"Проверьте наличие ТТН и Весовых справок в перевозке.\\nВыберите необходимую перевозку🛻\",\n    reply_markup: inlineKeyboard\n};\n\n// Возвращаем данные для запроса\nreturn [\n    {\n        json: {\n            url,\n            message\n        }\n    }\n];\n"
      },
      "id": "0b0ff4f7-b119-4229-aacf-a6a74700df97",
      "name": "создаём динамически инлайн кнопки2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        820,
        8660
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "За эту смену у Вас не было перевозок или у Вас нет выполненных рейсов",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Продолжить",
                    "additionalFields": {
                      "callback_data": "check_fuel"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "e4b3f1c9-b04e-485b-bed8-92157b6bfe1f",
      "name": "сегодня не было перевозок",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        100,
        8840
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "=❗Загружены не все весовые справки по данной перевозке.\nОтправьте <b>{{ $json.count_weight_certificate }}</b> фото для загрузки ",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "={{ `TS_${$('получаем id выбранной перевозки1').item.json.transportation_for_certificate}`}}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "fb4b5fbe-a1ad-4802-940f-7cfc3b84d19f",
      "name": "загрузите весовые",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        660,
        9900
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "text": "Выберите документ, который хотите проверить",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "ТТН",
                    "additionalFields": {
                      "callback_data": "check_TTN"
                    }
                  },
                  {
                    "text": "Весовые справки",
                    "additionalFields": {
                      "callback_data": "check_weight"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "back_certificate"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "2af3e91b-79d6-41bd-903e-cdc68bdee5e7",
      "name": "загрузите ттн или весовые1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        40,
        10360
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "92ad7c1c-cd84-4fc3-bf35-ca59aedad2a0",
              "name": "TS_number",
              "value": "={{ $('Execute Workflow Trigger').item.json.callback_query.data.substring(4) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "a0b039cf-03b9-481f-806a-59956a2365cf",
      "name": "номер выбранной перевозки1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        -400,
        10360
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
            "transportation_for_certificate": "={{ $json.TS_number }}"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "car_id_while_inputing",
              "displayName": "car_id_while_inputing",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fuel_liters",
              "displayName": "fuel_liters",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "weight_measure",
              "displayName": "weight_measure",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "logist_alert_text",
              "displayName": "logist_alert_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "logist_recipient_name",
              "displayName": "logist_recipient_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "transportation_for_certificate",
              "displayName": "transportation_for_certificate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "2f37d36d-11c6-4964-a335-ed36683fc792",
      "name": "запишем номер выбранной перевозки2",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -180,
        10360
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
            "status": "authorized"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "47ec7ebd-6167-4a02-8cc4-0799001becee",
      "name": "меняем статус на дефолтный6",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        260,
        10360
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Меню с выбором ттн, весовой или возврата к перевозкам после загрузки весовых",
        "height": 241.63069006760355,
        "width": 1012.8855128867174
      },
      "id": "4453894a-9581-4ac4-9470-bc192c3f6a2d",
      "name": "Sticky Note66",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -620,
        10300
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.text }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "add31a40-e27f-47ca-a228-54f0dae55d57",
      "name": "загрузите ттн или весовые2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -580,
        10360
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "sortFieldsUi": {
          "sortField": [
            {
              "fieldName": "transportations.id"
            }
          ]
        },
        "options": {}
      },
      "id": "ebd025c1-6f5e-43f9-b5e8-56391d74790f",
      "name": "Sort",
      "type": "n8n-nodes-base.sort",
      "typeVersion": 1,
      "position": [
        400,
        3380
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "upload_sertificate",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "aa099f5f-3f70-427e-b099-02df695e132f",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "back_certificate",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "aa099f5f-3f70-427e-b099-02df695e132f",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "={{ \"TS_\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "3ef15479-f781-4cf6-8452-ac25023ba248",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "check_TTN",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "5daaa096-aa68-4239-be97-b65bd575add0",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "check_weight",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "d301eb78-6a62-4223-ad44-d3f85f59eb7e",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "={{ \"NTS_\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "cb288218-1f4f-45e6-8c67-b08167998d3f",
      "name": "ТТН и весовые в конце смены",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -820,
        8780
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "text": "Вы в главном меню",
        "additionalFields": {}
      },
      "id": "4172dba2-30a8-4e20-8c60-3abb61252a8e",
      "name": "назад",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -1180,
        9500
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "field": "id"
            }
          ]
        },
        "options": {}
      },
      "id": "e30e8db4-dc41-4320-b750-ae3921a75616",
      "name": "Summarize6",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        980,
        3440
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.round",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "transportation",
              "value": "={{ $('Sort').item.json.transportations.id }}"
            },
            {
              "fieldName": "car",
              "value": "={{ $('находим машину по odoo id9').item.json.id }}"
            }
          ]
        }
      },
      "id": "1997062e-1654-4ce4-945d-8a47d3d8826d",
      "name": "находим рейсы по машине и перевозке",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        780,
        3420
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {},
      "id": "d31b45eb-d432-4d7d-b70f-1bdff39baefb",
      "name": "Limit",
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        1540,
        3140
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "d226026f-e64e-42d5-a946-7ffa26c329e8",
      "name": "Loop Over Items",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        620,
        3400
      ]
    },
    {
      "parameters": {},
      "id": "099c7e55-f98b-4ef4-86b1-5d4bf23ce02b",
      "name": "Replace Me",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1660,
        3440
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "61bcb0f0-862c-40b8-8081-282ab7b7e544",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "60cf72c8-8878-4e64-929a-d157ea63a6fd",
      "name": "Filter2",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [
        1000,
        3260
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "e24d83cc-dc2d-4d01-8af3-ff146b515d82",
              "leftValue": "={{ $('Filter2').item.json }}",
              "rightValue": "Срочная",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "19f760fa-50fd-49e9-86d2-c7905b61edf8",
      "name": "есть ли перевозка",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1200,
        3260
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "7b45f759-a46e-4494-a3c2-5ec089814d43",
              "leftValue": "={{ $json.count_id }}",
              "rightValue": 1,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "525715d8-ec6a-4726-9b58-88f4a7feca96",
      "name": "1 ли рейс?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1160,
        3480
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "5cca3a3f-692b-4006-a954-08659e1e94ec",
              "leftValue": "={{ $('находим рейсы по машине и перевозке').item.json.status }}",
              "rightValue": "Назначен",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "bd44c02a-bf4a-4cf9-8c00-c995ec656793",
      "name": "если 1, то назначен ли он?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1400,
        3380
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.transportation",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "id",
              "value": "={{ $('находим рейсы по машине и перевозке').item.json.transportation[0] }}"
            }
          ]
        }
      },
      "id": "a3515922-0217-4083-ab43-c0e57e252cea",
      "name": "находим информацию о перевозке",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        1560,
        3280
      ],
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Дорогой водитель, с чем у вас возникла проблема?",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "С Автомобилем",
                    "additionalFields": {
                      "callback_data": "warn_problem_auto"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "С Маршрутом",
                    "additionalFields": {
                      "callback_data": "warn_problem_route"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "С Документами",
                    "additionalFields": {
                      "callback_data": "warn_problem_document"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "warn_back_to_menu"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "0b97fe58-10b9-4d5e-a88c-bb797a9d1c9a",
      "name": "Сообщение для описания проблемы",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -1180,
        9660
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
            "status": "authorized"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "car_id_while_inputing",
              "displayName": "car_id_while_inputing",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fuel_liters",
              "displayName": "fuel_liters",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "weight_measure",
              "displayName": "weight_measure",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "logist_alert_text",
              "displayName": "logist_alert_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "logist_recipient_name",
              "displayName": "logist_recipient_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "transportation_for_certificate",
              "displayName": "transportation_for_certificate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "count_weight_photo",
              "displayName": "count_weight_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "count_weight_photo_sent",
              "displayName": "count_weight_photo_sent",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "e0c27f35-51b4-42c1-9103-693f25e255ae",
      "name": "статус=дефолт",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -960,
        9660
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## меню Срочно",
        "height": 987.9912140099913,
        "width": 515.4472763738418,
        "color": 6
      },
      "id": "e122c9a8-cd84-4d8b-bc44-4a7cfc5a59b9",
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1260,
        9280
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Проблема с маршрутом\nОтправьте сообщение, фото, видео, запись диктофона или кружок:",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "back_to_choise_warn"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "ed426773-58fa-4196-9ac7-6486e39254c2",
      "name": "отправьте данные1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -1180,
        9860
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
            "status": "inputing_warn_message_route"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "car_id_while_inputing",
              "displayName": "car_id_while_inputing",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fuel_liters",
              "displayName": "fuel_liters",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "weight_measure",
              "displayName": "weight_measure",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "logist_alert_text",
              "displayName": "logist_alert_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "logist_recipient_name",
              "displayName": "logist_recipient_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "transportation_for_certificate",
              "displayName": "transportation_for_certificate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "count_weight_photo",
              "displayName": "count_weight_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "count_weight_photo_sent",
              "displayName": "count_weight_photo_sent",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "bcc8d17d-b498-4a73-91a8-442741db58c9",
      "name": "статус=отправка срочно маршрут",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -960,
        9860
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "errorMessage": "55"
      },
      "id": "635d4e62-70b9-421c-8cff-90b0a2f8f337",
      "name": "Stop and Error",
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -1660,
        1520
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.round",
        "operation": "getAll",
        "options": {
          "fieldsList": [
            "transportation"
          ]
        },
        "filterRequest": {
          "filter": [
            {
              "fieldName": "car",
              "value": "={{ $json.id }}"
            },
            {
              "fieldName": "status",
              "value": "Выполняется"
            }
          ]
        }
      },
      "id": "ae7ba0e4-87c4-4ffc-8c97-bcfcc617808a",
      "name": "рейсы",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -1820,
        9780
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "keep": "lastItems"
      },
      "id": "940995ba-aca4-4343-a06e-fbc32ec067e1",
      "name": "актуальный рейс",
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        -1640,
        9780
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "c5cfa8df-af12-4218-a1a2-b4025b456e62",
      "name": "номер авто5",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -2000,
        9780
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "5b5a301a-c219-41f3-a4c1-9ceb5ecbe763",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "30f41ff9-3358-4bce-bb35-117fd4e4c9d1",
      "name": "есть рейс?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -1440,
        9780
      ]
    },
    {
      "parameters": {
        "resource": "callback",
        "queryId": "={{ $('Execute Workflow Trigger').item.json.callback_query.id }}",
        "additionalFields": {
          "show_alert": true,
          "text": "У вас нет начатого рейса, вы не можете указать проблему"
        }
      },
      "id": "16dafad3-8aee-4bcf-9ff5-725e1e13c9b3",
      "name": "Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -1180,
        10200
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "warn_problem_auto",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "ab2599b7-d238-4b88-bb49-bd3904b8bd0e",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "warn_back_to_menu",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "32f5ff63-66c6-41ab-b8ae-31db4b91a594",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "back_to_choise_warn",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "5458e8a5-336f-4d88-b337-020b31a58c52",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "warn_problem_route",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "ee338c82-2f82-4b33-ac41-5d054a850f9c",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.callback_query.data }}",
                    "rightValue": "warn_problem_document",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "aba96e6d-070e-484b-82b1-5364aa46fdb9",
      "name": "срочно",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -2240,
        9680
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "499548c8-18b9-4833-8f35-ac9db135dce9",
      "name": "номер авто6",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -2000,
        9980
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.round",
        "operation": "getAll",
        "options": {
          "fieldsList": [
            "transportation"
          ]
        },
        "filterRequest": {
          "filter": [
            {
              "fieldName": "car",
              "value": "={{ $json.id }}"
            },
            {
              "fieldName": "status",
              "value": "Выполняется"
            }
          ]
        }
      },
      "id": "7f316c1d-122e-4e96-a37c-9d86dd36f6a4",
      "name": "рейсы1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -1820,
        9980
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "Lq325enRAAa1pn0J",
          "name": "Everest prod"
        }
      }
    },
    {
      "parameters": {
        "keep": "lastItems"
      },
      "id": "f2fb4006-46b9-4a63-9b63-0b3b0fa486b5",
      "name": "актуальный рейс1",
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        -1640,
        9980
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "5b5a301a-c219-41f3-a4c1-9ceb5ecbe763",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "72916157-b60b-4f68-9eb9-49208170b689",
      "name": "есть рейс?1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -1440,
        9980
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Проблема с документами\nОтправьте сообщение, фото, видео, запись диктофона или кружок:",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Назад",
                    "additionalFields": {
                      "callback_data": "back_to_choise_warn"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "58723f77-216e-4754-aff6-4777b4f93d95",
      "name": "отправьте данные2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -1180,
        10020
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
            "status": "inputing_warn_message_document"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "car_id_while_inputing",
              "displayName": "car_id_while_inputing",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fuel_liters",
              "displayName": "fuel_liters",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "weight_measure",
              "displayName": "weight_measure",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "logist_alert_text",
              "displayName": "logist_alert_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "logist_recipient_name",
              "displayName": "logist_recipient_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "transportation_for_certificate",
              "displayName": "transportation_for_certificate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "count_weight_photo",
              "displayName": "count_weight_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "count_weight_photo_sent",
              "displayName": "count_weight_photo_sent",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "d3be178e-d140-4242-b0dd-ae21d6fb83d5",
      "name": "статус=отправка срочно документ",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -960,
        10020
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://everest.lamart.site/take_maintenance_by_driver",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"maintenance_id\": {{ $json.TO_number }}\n}",
        "options": {}
      },
      "id": "61acabdb-a471-45ac-986d-682307b7838a",
      "name": "обновим статус на \"в работе\"",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        660,
        4400
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "let combinedMessage = \"\";\n\nfor (const item of $input.all()) {\n  const transportation = item.json;\n  const sender = transportation.sender[1];\n  const partner = transportation.partner[1];\n  const route = transportation.route[1];\n  const material = transportation.material[1];\n  const comment = transportation.comment;\n  const endCondition = transportation.end_condition;\n  const requiredCubicMetre = transportation.required_cubic_metre;\n\n  let message = `Отправитель - <b>${sender}</b>\\nПолучатель - <b>${partner}</b>\\nМаршрут - <b>${route}</b>\\nМатериал - <b>${material}</b>`;\n\n  if (comment !== false) {\n    message += `\\nКомментарий - <b>${comment}</b>`;\n  }\n\n  if (endCondition === \"По перевезенным кубометрам\") {\n    message += `\\nОстаток кубометров по перевозке - <b>${requiredCubicMetre}</b>`;\n  }\n\n  message += \"\\n\\n\";\n\n  combinedMessage = message.trim();\n}\n\nreturn [{ json: { combinedMessage: combinedMessage } }];"
      },
      "id": "df287e75-c27b-410e-a41d-4e7286f4cf73",
      "name": "Code",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1940,
        3420
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "Вам назначена следующая перевозка:",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "646083d7-66a5-4f60-b6fd-016a728eff93",
      "name": "вывод доступных перевозок5",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        2220,
        3420
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.callback_query.from.id }}",
        "text": "={{ $('Code').item.json.combinedMessage }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Приступить к перевозке",
                    "additionalFields": {
                      "callback_data": "accept"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "id": "032cecf2-e33f-4960-8d77-8d31eed1d257",
      "name": "Выводим информацию о перевозке6",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        2500,
        3420
      ],
      "credentials": {
        "telegramApi": {
          "id": "yJVsCMzutOZvA2Re",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "transportation",
          "mode": "list",
          "cachedResultName": "transportation"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "name": "={{ $('Limit').item.json.route[1] }}",
            "id": "={{ $('Limit').item.json.id }}",
            "driver_id": "={{ $('Execute Workflow Trigger').all()[0].json.odoo_id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": true,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "name",
              "displayName": "name",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "count",
              "displayName": "count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "weigth",
              "displayName": "weigth",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "driver_id",
              "displayName": "driver_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "4e2b89b5-8104-4231-abd3-4ab888b7dccb",
      "name": "Добавление перевозки в бд3",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        2700,
        3420
      ],
      "credentials": {
        "postgres": {
          "id": "JvKzM0ZR1mjzsPky",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "вывод информации о перевозке",
        "height": 277.01644113372225,
        "width": 804.0896318554126
      },
      "id": "d6b443e6-58f6-4baa-a022-2872b163a6a7",
      "name": "Sticky Note11",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2140,
        3360
      ]
    }
  ],
  "pinData": {
    "Execute Workflow Trigger": [
      {
        "json": {
          "update_id": 100621812,
          "callback_query": {
            "id": "3010587259669634398",
            "from": {
              "id": 700956969,
              "is_bot": false,
              "first_name": "Алексей",
              "username": "Chronos196",
              "language_code": "ru"
            },
            "message": {
              "message_id": 13018,
              "from": {
                "id": 7063451965,
                "is_bot": true,
                "first_name": "Everest n8n",
                "username": "myn8nbotbot"
              },
              "chat": {
                "id": 700956969,
                "first_name": "Алексей",
                "username": "Chronos196",
                "type": "private"
              },
              "date": 1721839293,
              "text": "Дорогой водитель, с чем у вас возникла проблема?",
              "reply_markup": {
                "inline_keyboard": [
                  [
                    {
                      "text": "С Автомобилем",
                      "callback_data": "warn_problem_auto"
                    }
                  ],
                  [
                    {
                      "text": "С Маршрутом",
                      "callback_data": "warn_problem_route"
                    }
                  ],
                  [
                    {
                      "text": "С Документами",
                      "callback_data": "warn_problem_document"
                    }
                  ],
                  [
                    {
                      "text": "Назад",
                      "callback_data": "warn_back_to_menu"
                    }
                  ]
                ]
              }
            },
            "chat_instance": "1908726007480408494",
            "data": "warn_problem_route"
          },
          "tg_id": "700956969",
          "odoo_id": 2,
          "status": "authorized",
          "only_mech": false,
          "mech_photo": false,
          "end_request_id": null,
          "materials_photo": false,
          "end_request_hours": null,
          "car_id_while_inputing": 18,
          "fuel_liters": 50,
          "weight_measure": "10 м3 ",
          "logist_alert_text": null,
          "logist_recipient_name": null,
          "transportation_for_certificate": null,
          "count_weight_photo": null,
          "count_weight_photo_sent": null,
          "cookie": "session_id=874e2936c027e5d159f4b0e3dcd69d8b55376e78; Expires=Thu, 24 Jul 2025 16:41:35 GMT; Max-Age=604800; HttpOnly; Path=/"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2024-07-11T08:13:56.296Z",
      "updatedAt": "2024-07-11T08:13:56.296Z",
      "id": "eucjxmhF768T7WNu",
      "name": "production"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2024-07-29T06:39:50.000Z",
  "versionId": "524d0e56-3e6d-473f-8e7e-a0ca5eb48f12"
}