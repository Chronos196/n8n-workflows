{
  "active": false,
  "connections": {
    "–ü–æ–ª—É—á–∞–µ–º —Ä–µ–π—Å—ã": {
      "main": [
        [
          {
            "node": "–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–π—Å–æ–≤ –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç –≤ –∫–∞—Ä—å–µ—Ä–µ2": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–π—Å–æ–≤ –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª": {
      "main": [
        [
          {
            "node": "Code3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code3": {
      "main": [
        [
          {
            "node": "Merge7",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "Merge7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code6": {
      "main": [
        [
          {
            "node": "Telegram8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow Trigger": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing": {
      "main": [
        [
          {
            "node": "–ü–æ–ª—É—á–∞–µ–º —Ä–µ–π—Å—ã",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç –≤ –∫–∞—Ä—å–µ—Ä–µ2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge7": {
      "main": [
        [
          {
            "node": "Code6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-10-01T17:34:02.123Z",
  "id": "F2N7DdR7nAVdTFUJ",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "test stat",
  "nodes": [
    {
      "parameters": {
        "resource": "custom",
        "customResource": "=transportation.round",
        "operation": "getAll",
        "returnAll": true,
        "options": {
          "fieldsList": [
            "id",
            "time_of_start",
            "driver_rate",
            "driver_with_trailer"
          ]
        },
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            },
            {
              "fieldName": "status",
              "value": "–ó–∞–≤–µ—Ä—à–µ–Ω"
            }
          ]
        }
      },
      "id": "83efae95-e9d6-4eb9-a16d-3804bbee0e40",
      "name": "–ü–æ–ª—É—á–∞–µ–º —Ä–µ–π—Å—ã",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        40,
        480
      ],
      "alwaysOutputData": false,
      "credentials": {
        "odooApi": {
          "id": "ITgOrhO4Hf2QcDtf",
          "name": "odoo dev"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "=quarry.work",
        "operation": "getAll",
        "returnAll": true,
        "options": {
          "fieldsList": [
            "id",
            "quarry_hours",
            "price_for_driver",
            "create_date",
            "start_time"
          ]
        },
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver",
              "value": "={{ $json.odoo_id }}"
            },
            {
              "fieldName": "status",
              "value": "–ó–∞–≤–µ—Ä—à–µ–Ω—ã"
            }
          ]
        }
      },
      "id": "418312a4-8291-46f1-85be-ac7c61ced82b",
      "name": "–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç –≤ –∫–∞—Ä—å–µ—Ä–µ2",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        60,
        680
      ],
      "alwaysOutputData": false,
      "credentials": {
        "odooApi": {
          "id": "ITgOrhO4Hf2QcDtf",
          "name": "odoo dev"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "49774021-7850-4bcb-9fba-8ab261f35354",
      "name": "–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–π—Å–æ–≤ –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        380,
        460
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫—É–±–∏–∫–∞\nconst inputData = items.map(item => item.json);\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è 10 —á–∞—Å–æ–≤ –∫–æ –≤—Ä–µ–º–µ–Ω–∏\nfunction addHoursToTime(timeStr, hours) {\n    const dateObj = new Date(timeStr.replace(\" \", \"T\")); // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –≤—Ä–µ–º–µ–Ω–∏ –≤ –æ–±—ä–µ–∫—Ç Date\n    dateObj.setHours(dateObj.getHours() + hours); // –î–æ–±–∞–≤–ª—è–µ–º 10 —á–∞—Å–æ–≤\n    return dateObj.toISOString().replace(\"T\", \" \").split(\".\")[0]; // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å—Ç—Ä–æ–∫—É –∏ —É–±–∏—Ä–∞–µ–º –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–π—Å–æ–≤ –ø–æ –¥–∞—Ç–∞–º\nfunction calculateTotalsByDate(data) {\n    const totalsByDate = {};\n\n    data.forEach(entry => {\n        entry.data.forEach(round => {\n            const { driver_rate, driver_with_trailer, time_of_start } = round;\n\n            // –î–æ–±–∞–≤–ª—è–µ–º 10 —á–∞—Å–æ–≤ –∫–æ –≤—Ä–µ–º–µ–Ω–∏\n            const adjustedTime = addHoursToTime(time_of_start, 5);\n\n            // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –¥–∞—Ç—É –∏–∑ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏\n            const date = adjustedTime.split(\" \")[0];\n\n            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ–π –¥–∞—Ç—ã\n            if (!totalsByDate[date]) {\n                totalsByDate[date] = {\n                    total_count: 0,  // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–π—Å–æ–≤\n                    total_earnings: 0  // –û–±—â–∏–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫\n                };\n            }\n\n            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–π—Å–æ–≤\n            totalsByDate[date].total_count++;\n\n            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—É–º–º—É –∑–∞—Ä–∞–±–æ—Ç–∫–∞\n            totalsByDate[date].total_earnings += driver_rate;\n        });\n    });\n\n    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ–±—ä–µ–∫—Ç –≤ –º–∞—Å—Å–∏–≤ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏\n    return Object.keys(totalsByDate).map(date => ({\n        date: date,\n        total_count: totalsByDate[date].total_count,\n        total_earnings: totalsByDate[date].total_earnings\n    }));\n}\n\n// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ\nconst processedData = calculateTotalsByDate(inputData);\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫—É–±–∏–∫–∞\nreturn processedData.map(entry => ({ json: entry }));\n"
      },
      "id": "10f45fbf-449f-4598-a383-aea247cda2f7",
      "name": "Code3",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        680,
        460
      ]
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫—É–±–∏–∫–∞\nconst inputData = items.map(item => item.json);\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö\nfunction calculateTotals(data) {\n    return data.map(entry => {\n        const { id, quarry_hours, price_for_driver, date, start_time } = entry;\n\n        // –ï—Å–ª–∏ price_for_driver —Ä–∞–≤–µ–Ω 0 –∏–ª–∏ false, –∑–∞—Ä–∞–±–æ—Ç–æ–∫ —Ä–∞–≤–µ–Ω 0\n        if (!price_for_driver) {\n            // –î–æ–±–∞–≤–ª—è–µ–º 10 —á–∞—Å–æ–≤ –∫ –¥–∞—Ç–µ\n            const adjustedDate = new Date(start_time);\n            adjustedDate.setHours(adjustedDate.getHours() + 5); // –ü—Ä–∏–±–∞–≤–ª—è–µ–º 10 —á–∞—Å–æ–≤\n\n            return {\n                id: id,\n                quarry_hours: quarry_hours,  // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—å–µ—Ä–Ω—ã—Ö —á–∞—Å–æ–≤\n                total: 0,  // –ó–∞—Ä–∞–±–æ—Ç–æ–∫ = 0\n                date: adjustedDate.toISOString(),  // –î–ª—è –≤—ã–≤–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–∞—Ç—É\n                original_date: date  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –¥–∞—Ç—É\n            };\n        }\n\n        // –¶–µ–Ω–∞ –≤–æ–¥–∏—Ç–µ–ª—è —É–∂–µ –∏—Ç–æ–≥–æ–≤–∞—è, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–µ–º –µ—ë –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç\n        const total = parseFloat(price_for_driver);\n\n        // –î–æ–±–∞–≤–ª—è–µ–º 10 —á–∞—Å–æ–≤ –∫ –¥–∞—Ç–µ\n        const adjustedDate = new Date(start_time);\n        adjustedDate.setHours(adjustedDate.getHours() + 5); // –ü—Ä–∏–±–∞–≤–ª—è–µ–º 10 —á–∞—Å–æ–≤\n\n        return {\n            id: id,\n            quarry_hours: quarry_hours,  // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—å–µ—Ä–Ω—ã—Ö —á–∞—Å–æ–≤\n            total: total,  // –û–±—â–∏–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫ = price_for_driver\n            date: adjustedDate.toISOString(),  // –î–ª—è –≤—ã–≤–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–∞—Ç—É\n            original_date: date  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –¥–∞—Ç—É\n        };\n    });\n}\n\n// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\nconst processedData = calculateTotals(inputData);\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫—É–±–∏–∫–∞\nreturn processedData.map(entry => ({ json: entry }));\n"
      },
      "id": "573d5cb0-707b-4dbb-ae3d-b2e477ccf9f9",
      "name": "Code2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        860,
        700
      ]
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ items\nconst inputData = items.map(item => item.json);\n\n// –ó–∞–¥–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\nconst today = new Date('2024-09-23T00:00:00');\ntoday.setMinutes(today.getMinutes() + today.getTimezoneOffset() + (5 * 60));\n\n// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏)\nconst startOfWeek = new Date(today);\nstartOfWeek.setDate(today.getDate() - today.getDay() + 1); // –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏\n\n// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü –ø—Ä–æ—à–ª—ã—Ö –Ω–µ–¥–µ–ª—å (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ - –Ω–∞—á–∞–ª–æ, –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ - –∫–æ–Ω–µ—Ü)\nconst previousWeekStart = new Date(startOfWeek);\npreviousWeekStart.setDate(previousWeekStart.getDate() - 7);\nconst previousWeekEnd = new Date(previousWeekStart);\npreviousWeekEnd.setDate(previousWeekEnd.getDate() + 6);\n\nconst twoWeeksAgoStart = new Date(previousWeekStart);\ntwoWeeksAgoStart.setDate(twoWeeksAgoStart.getDate() - 7);\nconst twoWeeksAgoEnd = new Date(twoWeeksAgoStart);\ntwoWeeksAgoEnd.setDate(twoWeeksAgoEnd.getDate() + 6);\n\nconst threeWeeksAgoStart = new Date(twoWeeksAgoStart);\nthreeWeeksAgoStart.setDate(threeWeeksAgoStart.getDate() - 7);\nconst threeWeeksAgoEnd = new Date(threeWeeksAgoStart);\nthreeWeeksAgoEnd.setDate(threeWeeksAgoEnd.getDate() + 6);\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω—É–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤ –¥–∞—Ç–µ\nfunction resetTime(date) {\n    const newDate = new Date(date);\n    newDate.setHours(0, 0, 0, 0); // –£–±–∏—Ä–∞–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤—Ä–µ–º–µ–Ω–∏\n    return newDate;\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ –¥–Ω—è–º\nfunction getDailyReport(date) {\n    let totalCount = 0;      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–π—Å–æ–≤\n    let totalQuarryHours = 0; // –ö–∞—Ä—å–µ—Ä–Ω—ã–µ —á–∞—Å—ã\n    let totalEarnings = 0;    // –û–±—â–∏–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫ –∑–∞ –¥–µ–Ω—å\n\n    const resetDate = resetTime(date);\n\n    inputData.forEach(entry => {\n        const entryDate = resetTime(new Date(entry.date));\n\n        // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –¥–∞—Ç—ã –±–µ–∑ —É—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏\n        if (entryDate.toISOString().split('T')[0] === resetDate.toISOString().split('T')[0]) {\n            if (entry.total_count !== undefined && entry.total_earnings !== undefined) {\n                totalCount += entry.total_count;  // –°—É–º–º–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–π—Å–æ–≤\n                totalEarnings += entry.total_earnings; // –°—É–º–º–∏—Ä—É–µ–º –∑–∞—Ä–∞–±–æ—Ç–æ–∫\n            } else if (entry.quarry_hours !== undefined && entry.total !== undefined) {\n                totalQuarryHours += entry.quarry_hours; // –°—É–º–º–∏—Ä—É–µ–º –∫–∞—Ä—å–µ—Ä–Ω—ã–µ —á–∞—Å—ã\n                totalEarnings += entry.total; // –°—É–º–º–∏—Ä—É–µ–º –∑–∞—Ä–∞–±–æ—Ç–æ–∫ –∑–∞ —Ä–∞–±–æ—Ç—ã –≤ –∫–∞—Ä—å–µ—Ä–µ\n            }\n        }\n    });\n\n    return {\n        count: totalCount,\n        quarry_hours: totalQuarryHours,\n        total: totalEarnings\n    };\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞ –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏\nfunction getCurrentWeekReport() {\n    let textMessage = 'üìä <b>–û—Ç—á–µ—Ç –∑–∞ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é</b>\\n\\n';\n\n    let currentDate = new Date(today);\n    while (currentDate >= startOfWeek) {\n        const dayReport = getDailyReport(currentDate);\n        const dayOfWeek = currentDate.toLocaleDateString('ru-RU', { weekday: 'long' });\n        const dateStr = currentDate.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' });\n\n        textMessage += `üìÖ <b>${dayOfWeek} (${dateStr}):</b>\\n`;\n        if (dayReport.count === 0 && dayReport.quarry_hours === 0) {\n            textMessage += '–ù–µ –±—ã–ª–æ –ø–µ—Ä–µ–≤–æ–∑–æ–∫\\n\\n';\n        } else {\n            textMessage += `üöö –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–π—Å–æ–≤: ${dayReport.count}\\n`;\n            textMessage += `üïë –ö–∞—Ä—å–µ—Ä–Ω—ã–µ —á–∞—Å—ã: ${dayReport.quarry_hours} —á\\n`;\n            textMessage += `üíµ –ó–∞—Ä–∞–±–æ—Ç–æ–∫: ${dayReport.total} —Ä—É–±.\\n\\n`;\n        }\n\n        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –¥–Ω—é\n        currentDate.setDate(currentDate.getDate() - 1);\n    }\n\n    return textMessage;\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞ –∑–∞ –Ω–µ–¥–µ–ª—é\nfunction getWeeklyReport(startDate, endDate) {\n    let totalCount = 0;\n    let totalQuarryHours = 0;\n    let totalEarnings = 0;\n\n    // –û–±–Ω—É–ª—è–µ–º –≤—Ä–µ–º—è –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞ –Ω–µ–¥–µ–ª–∏\n    const start = resetTime(startDate);\n    const end = resetTime(endDate);\n\n    inputData.forEach(entry => {\n        const entryDate = resetTime(new Date(entry.date));\n\n        // –í–∫–ª—é—á–∞–µ–º –≤ —Ä–∞—Å—á–µ—Ç –∫–∞–∫ –Ω–∞—á–∞–ª–æ, —Ç–∞–∫ –∏ –∫–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏\n        if (entryDate >= start && entryDate <= end) {\n            if (entry.total_count !== undefined && entry.total_earnings !== undefined) {\n                totalCount += entry.total_count;\n                totalEarnings += entry.total_earnings;\n            } else if (entry.quarry_hours !== undefined && entry.total !== undefined) {\n                totalQuarryHours += entry.quarry_hours; // –°—á–∏—Ç–∞–µ–º –∫–∞—Ä—å–µ—Ä–Ω—ã–µ —á–∞—Å—ã\n                totalEarnings += entry.total; // –°—É–º–º–∏—Ä—É–µ–º –∑–∞—Ä–∞–±–æ—Ç–æ–∫ –∑–∞ —Ä–∞–±–æ—Ç—ã –≤ –∫–∞—Ä—å–µ—Ä–µ\n            }\n        }\n    });\n\n    return {\n        count: totalCount,\n        quarry_hours: totalQuarryHours,\n        total: totalEarnings\n    };\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –ª–∏ –Ω–µ–¥–µ–ª—è –∫ –ø—Ä–æ—à–ª–æ–º—É –º–µ—Å—è—Ü—É\nfunction isFullWeekInPreviousMonth(startDate, endDate) {\n    const startMonth = startDate.getMonth();\n    const endMonth = endDate.getMonth();\n    return startMonth < today.getMonth() && endMonth < today.getMonth();\n}\n\n// –ü–æ–ª—É—á–∞–µ–º –æ—Ç—á–µ—Ç—ã –∑–∞ –ø—Ä–æ—à–ª—ã–µ –Ω–µ–¥–µ–ª–∏\nconst previousWeekReport = getWeeklyReport(previousWeekStart, previousWeekEnd);\nconst twoWeeksAgoReport = getWeeklyReport(twoWeeksAgoStart, twoWeeksAgoEnd);\nconst threeWeeksAgoReport = getWeeklyReport(threeWeeksAgoStart, threeWeeksAgoEnd);\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –æ—Ç—á–µ—Ç–∞ –¥–ª—è Telegram\nlet textMessage = getCurrentWeekReport();  // –û—Ç—á–µ—Ç –∑–∞ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é\n\nlet pastWeeksText = ''; // –¢–µ–∫—Å—Ç –¥–ª—è –ø—Ä–æ—à–ª—ã—Ö –Ω–µ–¥–µ–ª—å\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ—à–ª—ã–µ –Ω–µ–¥–µ–ª–∏\nif (!isFullWeekInPreviousMonth(previousWeekStart, previousWeekEnd)) {\n    pastWeeksText += `üìÖ <b>–ù–µ–¥–µ–ª—è —Å ${previousWeekStart.toLocaleDateString('ru-RU')} –ø–æ ${previousWeekEnd.toLocaleDateString('ru-RU')}:</b>\\n`;\n    pastWeeksText += `üöö –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–π—Å–æ–≤: ${previousWeekReport.count}\\n`;\n    pastWeeksText += `üïë –ö–∞—Ä—å–µ—Ä–Ω—ã–µ —á–∞—Å—ã: ${previousWeekReport.quarry_hours} —á\\n`;\n    pastWeeksText += `üíµ –ó–∞—Ä–∞–±–æ—Ç–æ–∫: ${previousWeekReport.total} —Ä—É–±.\\n\\n`;\n}\n\nif (!isFullWeekInPreviousMonth(twoWeeksAgoStart, twoWeeksAgoEnd)) {\n    pastWeeksText += `üìÖ <b>–ù–µ–¥–µ–ª—è —Å ${twoWeeksAgoStart.toLocaleDateString('ru-RU')} –ø–æ ${twoWeeksAgoEnd.toLocaleDateString('ru-RU')}:</b>\\n`;\n    pastWeeksText += `üöö –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–π—Å–æ–≤: ${twoWeeksAgoReport.count}\\n`;\n    pastWeeksText += `üïë –ö–∞—Ä—å–µ—Ä–Ω—ã–µ —á–∞—Å—ã: ${twoWeeksAgoReport.quarry_hours} —á\\n`;\n    pastWeeksText += `üíµ –ó–∞—Ä–∞–±–æ—Ç–æ–∫: ${twoWeeksAgoReport.total} —Ä—É–±.\\n\\n`;\n}\n\nif (!isFullWeekInPreviousMonth(threeWeeksAgoStart, threeWeeksAgoEnd)) {\n    pastWeeksText += `üìÖ <b>–ù–µ–¥–µ–ª—è —Å ${threeWeeksAgoStart.toLocaleDateString('ru-RU')} –ø–æ ${threeWeeksAgoEnd.toLocaleDateString('ru-RU')}:</b>\\n`;\n    pastWeeksText += `üöö –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–π—Å–æ–≤: ${threeWeeksAgoReport.count}\\n`;\n    pastWeeksText += `üïë –ö–∞—Ä—å–µ—Ä–Ω—ã–µ —á–∞—Å—ã: ${threeWeeksAgoReport.quarry_hours} —á\\n`;\n    pastWeeksText += `üíµ –ó–∞—Ä–∞–±–æ—Ç–æ–∫: ${threeWeeksAgoReport.total} —Ä—É–±.\\n\\n`;\n}\n\n// –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –ø—Ä–æ—à–ª—ã–º –Ω–µ–¥–µ–ª—è–º, –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫\nif (pastWeeksText) {\n    textMessage += 'üìä <b>–û—Ç—á–µ—Ç –∑–∞ –ø—Ä–æ—à–ª—ã–µ –Ω–µ–¥–µ–ª–∏ –º–µ—Å—è—Ü–∞</b>\\n\\n';\n    textMessage += pastWeeksText; // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –ø—Ä–æ—à–ª—ã—Ö –Ω–µ–¥–µ–ª—å\n}\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON\nreturn [\n    {\n        json: {\n            message: textMessage\n        }\n    }\n];\n"
      },
      "id": "4d258409-0935-4663-a5da-94b69e884dde",
      "name": "Code6",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1280,
        500
      ]
    },
    {
      "parameters": {
        "chatId": "467549384",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "id": "c46330e9-32f3-4f3d-b184-73571b83e354",
      "name": "Telegram8",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1460,
        500
      ],
      "credentials": {
        "telegramApi": {
          "id": "uEAhGHyixvUTbCGm",
          "name": "tg serg"
        }
      }
    },
    {
      "parameters": {},
      "id": "a87c2b17-48a4-45a6-99c6-6629d2a89709",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        -460,
        580
      ]
    },
    {
      "parameters": {},
      "id": "4ce4621a-66bd-4826-b28a-055a3e88b8d2",
      "name": "No Operation, do nothing",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -180,
        560
      ]
    },
    {
      "parameters": {},
      "id": "ed8d8546-a96a-4f87-be11-ab98670359dd",
      "name": "Merge7",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        1140,
        500
      ]
    }
  ],
  "pinData": {
    "Execute Workflow Trigger": [
      {
        "json": {
          "update_id": 100629693,
          "message": {
            "message_id": 21959,
            "from": {
              "id": 7094417017,
              "is_bot": false,
              "first_name": "–°–µ—Ä–≥–µ–π",
              "last_name": "–ö–æ—Å–æ–ª–∞–ø–æ–≤",
              "username": "sergio_kf",
              "language_code": "ru"
            },
            "chat": {
              "id": 7094417017,
              "first_name": "–°–µ—Ä–≥–µ–π",
              "last_name": "–ö–æ—Å–æ–ª–∞–ø–æ–≤",
              "username": "sergio_kf",
              "type": "private"
            },
            "date": 1727879116,
            "text": "–ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
          },
          "tg_id": "7094417017",
          "odoo_id": 4,
          "status": "authorized",
          "only_mech": false,
          "mech_photo": false,
          "end_request_id": 407,
          "materials_photo": false,
          "end_request_hours": null,
          "car_id_while_inputing": 19,
          "fuel_liters": null,
          "weight_measure": "5 –º3 ",
          "logist_alert_text": null,
          "logist_recipient_name": null,
          "transportation_for_certificate": null,
          "count_weight_photo": null,
          "count_weight_photo_sent": null,
          "current_quarry_hours": null,
          "end_round_message_id": null,
          "last_message_text": null,
          "logist_notifications": false,
          "cookie": "session_id=6d538dcd38dc1fcb5754db73af461fe9b3c211fb; Expires=Thu, 02 Oct 2025 14:25:17 GMT; Max-Age=604800; HttpOnly; Path=/",
          "seconds": 1.656
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2024-10-03T05:01:01.086Z",
  "versionId": "001c21f1-0f20-4a76-b139-ed2fa26b5591"
}