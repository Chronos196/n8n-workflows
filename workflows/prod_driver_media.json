{
  "active": false,
  "connections": {
    "Extract from File": {
      "main": [
        [
          {
            "node": "получение id карточки на тех.обслуживание",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit": {
      "main": [
        [
          {
            "node": "загрузка фото неисправности",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получение id карточки на тех.обслуживание": {
      "main": [
        [
          {
            "node": "Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получение фото из тг": {
      "main": [
        [
          {
            "node": "Extract from File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "проверка фото механику/логисту": {
      "main": [
        [
          {
            "node": "получение фото из тг",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Проверка: является ли фото грузом",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "возвращение статуса фото для ТО": {
      "main": [
        [
          {
            "node": "Фото доставлено1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск логистов1": {
      "main": [
        [
          {
            "node": "поиск тг айди логистов1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск тг айди логистов1": {
      "main": [
        [
          {
            "node": "Отправка фото логисту",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "преобразуем в 1 переменную2": {
      "main": [
        [
          {
            "node": "Фото доставлено",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Фото доставлено1": {
      "main": [
        [
          {
            "node": "удаление \"отправляйте фото\"",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Фото доставлено": {
      "main": [
        [
          {
            "node": "удаление \"отправляйте фото\"",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Отправка фото логисту": {
      "main": [
        [
          {
            "node": "преобразуем в 1 переменную2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "если не отправилось",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "если не отправилось": {
      "main": [
        [
          {
            "node": "удаление \"отправляйте фото\"",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File1": {
      "main": [
        [
          {
            "node": "загрузка фото исправления",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получение фото из тг1": {
      "main": [
        [
          {
            "node": "Extract from File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Фото доставлено2": {
      "main": [
        [
          {
            "node": "меняем статус на обычный",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "меняем статус на обычный": {
      "main": [
        [
          {
            "node": "поиск механиков3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Проверка: является ли фото грузом": {
      "main": [
        [
          {
            "node": "Получение информации о водителе",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "поиск логистов1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск логистов2": {
      "main": [
        [
          {
            "node": "поиск тг айди логистов2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск тг айди логистов2": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Получение информации о водителе": {
      "main": [
        [
          {
            "node": "поиск логистов2",
            "type": "main",
            "index": 0
          },
          {
            "node": "находим машину по odoo id6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Уведомление логиста": {
      "main": [
        [
          {
            "node": "Отправка фото1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Отправка фото1": {
      "main": [
        [
          {
            "node": "преобразуем в 1 переменную",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Уведомление водителя о том, что фото доставлено": {
      "main": [
        [
          {
            "node": "Удаление прошлого сообщения",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Удаление прошлого сообщения": {
      "main": [
        [
          {
            "node": "Обновление статуса отправки фото логисту2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим машину по odoo id6": {
      "main": [
        [
          {
            "node": "находим рейсы по машине1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим рейсы по машине1": {
      "main": [
        [
          {
            "node": "Limit2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit2": {
      "main": [
        [
          {
            "node": "находим перевозки по рейсам1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим перевозки по рейсам1": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Уведомление логиста",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск механиков3": {
      "main": [
        [
          {
            "node": "поиск тг айди механиков3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск тг айди механиков3": {
      "main": [
        [
          {
            "node": "проверка наличия механиков3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "проверка наличия механиков3": {
      "main": [
        [
          {
            "node": "данные водителя2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "данные водителя2": {
      "main": [
        [
          {
            "node": "данные авто1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "данные авто1": {
      "main": [
        [
          {
            "node": "текст заявки1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "текст заявки1": {
      "main": [
        [
          {
            "node": "Отправка проблемы механикам3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "убираем кнопку \"назад\" у прикрепления фото": {
      "main": [
        [
          {
            "node": "получение фото из тг1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получение фото из тг2": {
      "main": [
        [
          {
            "node": "Extract from File2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File2": {
      "main": [
        [
          {
            "node": "находим машину по odoo id1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "загрузка весовой в рейс": {
      "main": [
        [
          {
            "node": "меняем статус на дефолтный3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "находим машину по odoo id1": {
      "main": [
        [
          {
            "node": "загрузка весовой в рейс",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "меняем статус на дефолтный3": {
      "main": [
        [
          {
            "node": "возврат к завершению заказа",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "преобразуем в 1 переменную": {
      "main": [
        [
          {
            "node": "Уведомление водителя о том, что фото доставлено",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "убираем кнопку \"назад\" у прикрепления фото1": {
      "main": [
        [
          {
            "node": "получение фото из тг2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File3": {
      "main": [
        [
          {
            "node": "получаем номер машины для эндпоинта",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "меняем статус на дефолтный5": {
      "main": [
        [
          {
            "node": "возврат к меню загрузки документов",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получаем номер машины для эндпоинта": {
      "main": [
        [
          {
            "node": "загрузка ттн",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "загрузка ттн": {
      "main": [
        [
          {
            "node": "меняем статус на дефолтный5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получение фото из тг4": {
      "main": [
        [
          {
            "node": "Extract from File4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File4": {
      "main": [
        [
          {
            "node": "загрузка весовой в рейс1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "загрузка весовой в рейс1": {
      "main": [
        [],
        [
          {
            "node": "отправлено больше весовых, чем надо",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "номер авто5": {
      "main": [
        [
          {
            "node": "добавляем кнопку Готово, если загружены весовые",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "добавляем кнопку Готово, если загружены весовые": {
      "main": [
        [
          {
            "node": "получение фото из тг4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "айди для отправки сообщения1": {
      "main": [
        [
          {
            "node": "отправка аудио",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "преобразуем в 1 переменную6": {
      "main": [
        [
          {
            "node": "сообщение отправлено2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "данные сотрудника1": {
      "main": [
        [
          {
            "node": "номер авто1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "номер авто1": {
      "main": [
        [
          {
            "node": "возвращаем статус1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "айди для отправки сообщения2": {
      "main": [
        [
          {
            "node": "отправка кружка",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск механиков1": {
      "main": [
        [
          {
            "node": "поиск тг айди механиков1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск тг айди механиков1": {
      "main": [
        [
          {
            "node": "отправка видео",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "можно создать заявку?": {
      "main": [
        [
          {
            "node": "создание заявки",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "механики и логисты3 диспетчер",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "преобразуем в 1 переменную5": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields6": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Summarize": {
      "main": [
        [
          {
            "node": "Сообщение отправлено",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Summarize",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка кружка": {
      "main": [
        [
          {
            "node": "отправка сообщения4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "айди для отправки сообщения3": {
      "main": [
        [
          {
            "node": "отправка видео2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "преобразуем в 1 переменную8": {
      "main": [
        [
          {
            "node": "сообщение отправлено3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка видео2": {
      "main": [
        [
          {
            "node": "преобразуем в 1 переменную8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "айди для отправки сообщения4": {
      "main": [
        [
          {
            "node": "отправка фото",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "преобразуем в 1 переменную9": {
      "main": [
        [
          {
            "node": "сообщение отправлено4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск механиков": {
      "main": [
        [
          {
            "node": "поиск тг айди механиков",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск тг айди механиков": {
      "main": [
        [
          {
            "node": "отправка фото1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "преобразуем в 1 переменную10": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Edit Fields7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields7": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Summarize1": {
      "main": [
        [
          {
            "node": "Сообщение отправлено1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge2": {
      "main": [
        [
          {
            "node": "Summarize1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получение фото из тг5": {
      "main": [
        [
          {
            "node": "Extract from File5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File5": {
      "main": [
        [
          {
            "node": "загрузка фото неисправности1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "возвращаем статус1": {
      "main": [
        [
          {
            "node": "с чем проблема",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "рейсы": {
      "main": [
        [
          {
            "node": "актуальный рейс",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "актуальный рейс": {
      "main": [
        [
          {
            "node": "получим перевозку",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получим перевозку": {
      "main": [
        [
          {
            "node": "поиск логистов5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "айди логистов": {
      "main": [
        [
          {
            "node": "в один текст",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "в один текст": {
      "main": [
        [
          {
            "node": "диспетчер4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка в чат": {
      "main": [
        [
          {
            "node": "убираем кнопку назад1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "убираем кнопку назад1": {
      "main": [
        [
          {
            "node": "Сообщение отправлено2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка кружка1": {
      "main": [
        [
          {
            "node": "отправка сообщения",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка сообщения": {
      "main": [
        [
          {
            "node": "убираем кнопку назад1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка видео3": {
      "main": [
        [
          {
            "node": "убираем кнопку назад1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка фото2": {
      "main": [
        [
          {
            "node": "убираем кнопку назад1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "маршрут?": {
      "main": [
        [
          {
            "node": "айди логистов",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "тип медиа2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate2": {
      "main": [
        [
          {
            "node": "убираем кнопку назад2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка кружка2": {
      "main": [
        [
          {
            "node": "отправка сообщения1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "убираем кнопку назад2": {
      "main": [
        [
          {
            "node": "Сообщение отправлено3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "загрузка фото исправления": {
      "main": [
        [
          {
            "node": "Фото доставлено2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "загрузка фото неисправности": {
      "main": [
        [
          {
            "node": "возвращение статуса фото для ТО",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск тг айди логистов+диспетчер": {
      "main": [
        [
          {
            "node": "отправка видео1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "механики и логисты3 диспетчер": {
      "main": [
        [
          {
            "node": "айди для отправки сообщения3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "механики и логисты1": {
      "main": [
        [
          {
            "node": "айди для отправки сообщения1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск логистов": {
      "main": [
        [
          {
            "node": "поиск тг айди логистов+диспетчер",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка аудио": {
      "main": [
        [
          {
            "node": "преобразуем в 1 переменную6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка сообщения4": {
      "main": [
        [
          {
            "node": "преобразуем в 1 переменную7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "преобразуем в 1 переменную7": {
      "main": [
        [
          {
            "node": "сообщение отправлено",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка фото": {
      "main": [
        [
          {
            "node": "преобразуем в 1 переменную9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск логистов4": {
      "main": [
        [
          {
            "node": "поиск тг айди логистов4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск тг айди логистов4": {
      "main": [
        [
          {
            "node": "отправка фото3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск логистов5": {
      "main": [
        [
          {
            "node": "поиск тг айди логистов",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "поиск тг айди логистов": {
      "main": [
        [
          {
            "node": "маршрут?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "айди диспетчера": {
      "main": [
        [
          {
            "node": "в один текст1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "диспетчер4": {
      "main": [
        [
          {
            "node": "айди для отправки сообщения8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "айди для отправки сообщения8": {
      "main": [
        [
          {
            "node": "айди диспетчера",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "в один текст1": {
      "main": [
        [
          {
            "node": "тип медиа1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Сообщение отправлено3": {
      "main": [
        [
          {
            "node": "диспетчер5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "диспетчер5": {
      "main": [
        [
          {
            "node": "айди для отправки сообщения9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "айди для отправки сообщения9": {
      "main": [
        [
          {
            "node": "тип медиа3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "с чем проблема": {
      "main": [
        [
          {
            "node": "убираем кнопку назад3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "рейсы",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "тип медиа": {
      "main": [
        [
          {
            "node": "механики и логисты1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "механики и логисты диспетчер",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "можно создать заявку?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "можно создать заявку?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "убираем кнопку назад3": {
      "main": [
        [
          {
            "node": "тип медиа",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "тип медиа1": {
      "main": [
        [
          {
            "node": "отправка в чат",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "отправка кружка1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "отправка видео3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "отправка фото2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка фото4": {
      "main": [
        [
          {
            "node": "Aggregate2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка видео4": {
      "main": [
        [
          {
            "node": "Aggregate2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка сообщения1": {
      "main": [
        [
          {
            "node": "Aggregate2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка в чат1": {
      "main": [
        [
          {
            "node": "Aggregate2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "проверка статуса": {
      "main": [
        [
          {
            "node": "убираем кнопку \"назад\" у прикрепления фото",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "авто",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "убираем кнопку \"назад\" у прикрепления фото1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "убираем кнопку \"назад\" у прикрепления фото2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "номер авто5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "данные сотрудника1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "данные сотрудника",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "проверка фото механику/логисту",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "диспетчер6": {
      "main": [
        [
          {
            "node": "айди для отправки сообщения10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "айди для отправки сообщения10": {
      "main": [
        [
          {
            "node": "тип медиа4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "скачать файл9": {
      "main": [
        [
          {
            "node": "отправка кружка5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка кружка5": {
      "main": [
        [
          {
            "node": "текст9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "скачать файл10": {
      "main": [
        [
          {
            "node": "отправка видео7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка видео7": {
      "main": [
        [
          {
            "node": "текст10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "тип медиа4": {
      "main": [
        [
          {
            "node": "скачать файл8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "скачать файл9",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "скачать файл10",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "скачать файл11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "скачать файл11": {
      "main": [
        [
          {
            "node": "отправка фото7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка фото7": {
      "main": [
        [
          {
            "node": "текст11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "данные сотрудника": {
      "main": [
        [
          {
            "node": "номер авто",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "номер авто": {
      "main": [
        [
          {
            "node": "диспетчер6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "преобразуем в 1 переменную11": {
      "main": [
        [
          {
            "node": "сообщение отправлено5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "текст9": {
      "main": [
        [
          {
            "node": "преобразуем в 1 переменную11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "текст10": {
      "main": [
        [
          {
            "node": "преобразуем в 1 переменную11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "текст11": {
      "main": [
        [
          {
            "node": "преобразуем в 1 переменную11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "сообщение отправлено5": {
      "main": [
        [
          {
            "node": "убираем кнопку назад4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "убираем кнопку назад4": {
      "main": [
        [
          {
            "node": "возвращаем статус",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "форматированная дата": {
      "main": [
        [
          {
            "node": "получение фото из тг6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправялем запрос": {
      "main": [
        [
          {
            "node": "данные занесенны",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "авто": {
      "main": [
        [
          {
            "node": "время екатеринбург",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "время екатеринбург": {
      "main": [
        [
          {
            "node": "форматированная дата",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "данные занесенны": {
      "main": [
        [
          {
            "node": "меняем статус на обычный2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получение фото из тг6": {
      "main": [
        [
          {
            "node": "Extract from File6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File6": {
      "main": [
        [
          {
            "node": "отправялем запрос",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "меняем статус на обычный2": {
      "main": [
        [
          {
            "node": "убираем кнопку назад",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "механики и логисты диспетчер": {
      "main": [
        [
          {
            "node": "айди для отправки сообщения2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "механики и логисты диспетчер1": {
      "main": [
        [
          {
            "node": "айди для отправки сообщения4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "тип медиа2": {
      "main": [
        [
          {
            "node": "отправка в чат1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "отправка кружка2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "отправка видео4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "отправка фото4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка кружка4": {
      "main": [
        [
          {
            "node": "отправка сообщения2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "тип медиа3": {
      "main": [
        [
          {
            "node": "отправка в чат2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "отправка кружка4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "отправка видео6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "отправка фото6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "скачать файл8": {
      "main": [
        [
          {
            "node": "отправка аудио6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка аудио6": {
      "main": [
        [
          {
            "node": "текст8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "текст8": {
      "main": [
        [
          {
            "node": "преобразуем в 1 переменную11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "создание заявки": {
      "main": [
        [
          {
            "node": "поиск механиков1",
            "type": "main",
            "index": 0
          },
          {
            "node": "поиск логистов",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "загрузка фото неисправности1": {
      "main": [
        [
          {
            "node": "поиск механиков",
            "type": "main",
            "index": 0
          },
          {
            "node": "поиск логистов4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка фото3": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "создание заявки1": {
      "main": [
        [
          {
            "node": "получение фото из тг5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка видео1": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка фото1": {
      "main": [
        [
          {
            "node": "преобразуем в 1 переменную10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка видео": {
      "main": [
        [
          {
            "node": "преобразуем в 1 переменную5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow Trigger": {
      "main": [
        [
          {
            "node": "Stop and Error",
            "type": "main",
            "index": 0
          },
          {
            "node": "проверка статуса",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "можно создать заявку?1": {
      "main": [
        [
          {
            "node": "создание заявки1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "механики и логисты диспетчер1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "убираем кнопку \"назад\" у прикрепления фото2": {
      "main": [
        [
          {
            "node": "получение фото из тг3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "получение фото из тг3": {
      "main": [
        [
          {
            "node": "Extract from File3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-10-06T17:04:53.806Z",
  "id": "vUZCMupYZrufjoAp",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "prod_driver_media",
  "nodes": [
    {
      "parameters": {
        "operation": "binaryToPropery",
        "options": {}
      },
      "id": "f2653e8a-867c-4d46-b020-c444a6cbfabf",
      "name": "Extract from File",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -180,
        4840
      ]
    },
    {
      "parameters": {
        "keep": "lastItems"
      },
      "id": "b1ba655a-1d66-4da3-92d8-1c02dd8c2916",
      "name": "Limit",
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        300,
        4840
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "technical.maintenance",
        "operation": "getAll",
        "options": {
          "fieldsList": [
            "id"
          ]
        },
        "filterRequest": {
          "filter": [
            {
              "fieldName": "created_by",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id}}"
            }
          ]
        }
      },
      "id": "1c702024-5307-4960-b7a5-99ad4263463a",
      "name": "получение id карточки на тех.обслуживание",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        80,
        4840
      ],
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Execute Workflow Trigger').item.json.message.photo.reduce((largest, current) => current.file_size > largest.file_size ? current : largest).file_id; }}"
      },
      "id": "e098882a-e66e-41a4-9d23-8b18a42b4c54",
      "name": "получение фото из тг",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        -420,
        4840
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "069241e8-a706-4d88-98a4-39e00ff7a911",
              "leftValue": "={{ $json.mech_photo }}",
              "rightValue": "true",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "774dc0fb-f2fd-4e62-a5b2-ee4fea5ef44a",
      "name": "проверка фото механику/логисту",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -820,
        4600
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "mech_photo": false,
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "dc2960ba-93b8-424c-b07f-8383a854c2d0",
      "name": "возвращение статуса фото для ТО",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        720,
        4840
      ],
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Добавление фото к карточке тех.обслуживания",
        "height": 227.62478042711086,
        "width": 1608.6685143378268
      },
      "id": "dbe4a735-9894-4fe4-b94f-9ab9b709d7c8",
      "name": "Sticky Note19",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -500,
        4780
      ]
    },
    {
      "parameters": {
        "content": "## Отправка фото логисту",
        "height": 230.9235502040431,
        "width": 1117.3696268263427
      },
      "id": "5a484c79-4d0d-4da7-9412-7fe76dc8d0a7",
      "name": "Sticky Note23",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -500,
        5080
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_title",
              "value": "Логист"
            }
          ]
        }
      },
      "id": "81b05143-c046-4fcb-a391-25b1bb80d4fb",
      "name": "поиск логистов1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -460,
        5140
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "ec40eaca-bbc6-4aa8-b062-44e2b35b947f",
      "name": "поиск тг айди логистов1",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        -240,
        5140
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "db152290-3962-489b-a9a6-c16b2ee8a5e9",
      "name": "преобразуем в 1 переменную2",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        220,
        5140
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "Фото доставлено",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Приступить к работе",
                    "additionalFields": {
                      "callback_data": "menu_ok"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "d786f57f-1308-4885-8cfc-2838522fa53f",
      "name": "Фото доставлено1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        920,
        4840
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "Фото доставлено",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Продолжить",
                    "additionalFields": {
                      "callback_data": "final"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "2f58a3d8-a782-4018-ba3a-8c7a06ca3a43",
      "name": "Фото доставлено",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        440,
        5140
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.message.message_id-1 }}"
      },
      "id": "3d45bf40-dffe-4de3-a0d2-d8f766fb1639",
      "name": "удаление \"отправляйте фото\"",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        780,
        5140
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.photo.reduce((largest, current) => current.file_size > largest.file_size ? current : largest).file_id; }}",
        "additionalFields": {}
      },
      "id": "2857673e-a7e4-4823-89fa-7b153496a2c0",
      "name": "Отправка фото логисту",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        0,
        5140
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "Не удалось отправить фото, логист не найден",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Продолжить",
                    "additionalFields": {
                      "callback_data": "final"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "82ee0dbe-7988-47ae-a39f-cec3b9944078",
      "name": "если не отправилось",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        300,
        5280
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "binaryToPropery",
        "options": {}
      },
      "id": "3ca14865-687c-467d-acb0-4dcc77938d6e",
      "name": "Extract from File1",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1035,
        540
      ]
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Execute Workflow Trigger').item.json.message.photo.reduce((largest, current) => current.file_size > largest.file_size ? current : largest).file_id; }}"
      },
      "id": "ba145597-1575-4703-810b-f50045a0cd5a",
      "name": "получение фото из тг1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        795,
        540
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "Когда механик проверит заявку, вам придёт уведомление",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "c1b34c5d-c2c8-4c53-ab53-9e66087bb470",
      "name": "Фото доставлено2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1520,
        540
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
            "status": "authorized",
            "end_request_hours": "={{ null }}",
            "end_request_id": "={{ null }}"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {}
      },
      "id": "a0864c37-c062-4b79-a5c2-f816e5fd7107",
      "name": "меняем статус на обычный",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        1735,
        540
      ],
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Отправка фото завершения заявки",
        "height": 304.0187080264881,
        "width": 1480.2413619003405,
        "color": 6
      },
      "id": "4023d744-1cda-4efa-bfd1-8d5f9cdd2b15",
      "name": "Sticky Note15",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        460,
        460
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "f1712e67-90f4-49cd-8453-48a737c30574",
              "leftValue": "={{ $json.materials_photo }}",
              "rightValue": "true",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "4fe8dcff-61d9-4c80-bd04-c126bc877112",
      "name": "Проверка: является ли фото грузом",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -840,
        5080
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_title",
              "value": "Логист"
            }
          ]
        }
      },
      "id": "3368d6ca-834c-41be-ac0c-1eac8e00f479",
      "name": "поиск логистов2",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -220,
        5560
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "cdc8b3e7-f557-46c2-823c-e2eabe4f8fc1",
      "name": "поиск тг айди логистов2",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        0,
        5560
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "materials_photo": false,
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "c37b5f2a-ed32-41f5-8867-58b4ff41a142",
      "name": "Обновление статуса отправки фото логисту2",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        1580,
        5560
      ],
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {
          "fieldsList": [
            "display_name",
            "mobile_phone"
          ]
        },
        "filterRequest": {
          "filter": [
            {
              "fieldName": "id",
              "value": "={{ $json.odoo_id }}"
            }
          ]
        }
      },
      "id": "14c3dc9f-3901-46ad-8664-a54445e8716f",
      "name": "Получение информации о водителе",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -440,
        5560
      ],
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.tg_id }}",
        "text": "=<b>{{ $('находим машину по odoo id6').item.json.number_car }}</b>, <b>{{ $json.place_from[1] }} - {{ $json.place_to[1] }}</b>, <b>{{ $json.material[1] }}</b>.",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "id": "dd18334f-2196-43ca-b5f0-0749cf68cbf6",
      "name": "Уведомление логиста",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        600,
        5560
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "={{ $('поиск тг айди логистов2').item.json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.photo.reduce((largest, current) => current.file_size > largest.file_size ? current : largest).file_id; }}",
        "additionalFields": {}
      },
      "id": "15480f2c-998e-45c4-b41d-0d0efe7ffe2f",
      "name": "Отправка фото1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        780,
        5560
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "Ваше фото будет доставлено логисту",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Вернуться к рейсам",
                    "additionalFields": {
                      "callback_data": "accept"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "be738d5a-4efb-46ba-8811-24108197cd68",
      "name": "Уведомление водителя о том, что фото доставлено",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1160,
        5560
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $json.result.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.message.message_id -1}}"
      },
      "id": "cdf95d01-ab11-4ae3-a0d9-98526aad4a5a",
      "name": "Удаление прошлого сообщения",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1380,
        5560
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $json.id }}"
            }
          ]
        }
      },
      "id": "ab393ec5-280f-4050-87ca-90183ecce60f",
      "name": "находим машину по odoo id6",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -440,
        5720
      ],
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.round",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "car",
              "value": "={{ $json.id }}"
            },
            {
              "fieldName": "status",
              "value": "Назначен"
            }
          ]
        }
      },
      "id": "8de88b1b-5d2e-41a0-8cdc-9ed7dfddd27c",
      "name": "находим рейсы по машине1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -280,
        5720
      ],
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {},
      "id": "435cee74-d660-4e05-8fbd-3df0dc2d9745",
      "name": "Limit2",
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        -120,
        5720
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.transportation",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "id",
              "value": "={{ $json.transportation[0] }}"
            }
          ]
        }
      },
      "id": "a2641134-4d51-426a-93e9-c22ef908fc87",
      "name": "находим перевозки по рейсам1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        60,
        5720
      ],
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Отправка фото с материалом логисту",
        "height": 414.5819171409328,
        "width": 2388.3105904636163,
        "color": 4
      },
      "id": "8f0a6495-a716-4f6b-8638-0475004c7043",
      "name": "Sticky Note36",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -480,
        5480
      ]
    },
    {
      "parameters": {
        "mode": "combine",
        "combinationMode": "multiplex",
        "options": {}
      },
      "id": "49a4d3f0-df9c-4b42-ae58-aabc813a999d",
      "name": "Merge1",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [
        420,
        5560
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_title",
              "value": "Механик"
            }
          ]
        }
      },
      "id": "8ed4f8f9-25f2-4a04-8e50-536b5a1c5373",
      "name": "поиск механиков3",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        2040,
        560
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "0eb75a2c-10e7-42e1-8307-3eb4252f06a0",
      "name": "поиск тг айди механиков3",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        2235,
        561
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "40eca1c8-25ce-4538-9aec-0b10b421179f",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "ab2b98de-3d21-4c65-bad5-083413acd509",
      "name": "проверка наличия механиков3",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        2460,
        560
      ]
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "={{ $('поиск тг айди механиков3').item.json.tg_id }}",
        "file": "={{ $('получение фото из тг1').item.json.result.file_id }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "=Принять заявку✅",
                    "additionalFields": {
                      "callback_data": "={{\"accept_TO_\" + $('Execute Workflow Trigger').item.json.end_request_id }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "Отклонить заявку❌",
                    "additionalFields": {
                      "callback_data": "={{\"reject_TO_\" + $('Execute Workflow Trigger').item.json.end_request_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "caption": "={{ $('данные авто1').item.json[\"number_car\"] }} - {{ $('Execute Workflow Trigger').item.json.end_request_hours }} ч. - {{ $('данные водителя2').item.json[\"display_name\"] }} - {{ $json.description_of_maintenance }}\n\n<b>Требуется проверить корректность выставленных часов</b> <a href=\"https://everest.lamart.site/web#id={{ $('Execute Workflow Trigger').item.json.end_request_id }}&model=technical.maintenance&view_type=form\">Ссылка на заявку в Odoo</a>",
          "parse_mode": "HTML"
        }
      },
      "id": "23d23fdf-4fb4-4b09-9392-3f908205cf1a",
      "name": "Отправка проблемы механикам3",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        3340,
        540
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "e44befdf-b4b3-44c0-a795-645cade5e55c",
      "name": "данные водителя2",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        2680,
        540
      ],
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Механик получает уведомление, когда водитель завершает заявку",
        "height": 250.48240620104332,
        "width": 1545.548756095632,
        "color": 6
      },
      "id": "b60d5d02-f8d0-47ea-9b02-6a2e6c1c78ce",
      "name": "Sticky Note42",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1980,
        480
      ],
      "disabled": true
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $json.id }}"
            }
          ]
        }
      },
      "id": "96f100e3-d158-4e5c-8ad6-49217f86bd17",
      "name": "данные авто1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        2900,
        540
      ],
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "technical.maintenance",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "id",
              "value": "={{ $('Execute Workflow Trigger').item.json.end_request_id }}"
            }
          ]
        }
      },
      "id": "58771587-2e62-4c5f-8098-17ceb4049b1a",
      "name": "текст заявки1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        3120,
        540
      ],
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.message.message_id - 1}}",
        "replyMarkup": "inlineKeyboard",
        "text": "=Прикрепите фото исправления:",
        "additionalFields": {}
      },
      "id": "3becf13b-c187-4826-b057-4ff587b6a1ac",
      "name": "убираем кнопку \"назад\" у прикрепления фото",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        540,
        540
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Execute Workflow Trigger').item.json.message.photo.reduce((largest, current) => current.file_size > largest.file_size ? current : largest).file_id; }}"
      },
      "id": "d2fd3dbc-46fd-4a80-be52-95a14fbfecde",
      "name": "получение фото из тг2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        820,
        1380
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "binaryToPropery",
        "options": {}
      },
      "id": "8d69fefa-6777-47d7-9244-e5e28d004ca7",
      "name": "Extract from File2",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1020,
        1380
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://everest.lamart.site/upload_weight_certificates",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number_car\":  {{'\"'+ $json.number_car +'\"'}},\n  \"transportation_id\":  {{ $json.current_transportation[0] }},\n  \"files\": {{'\"'+ $('Extract from File2').item.json.data +'\"'}}\n}",
        "options": {}
      },
      "id": "33b547cd-c4ab-405e-bfd4-0a494f2261c7",
      "name": "загрузка весовой в рейс",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1360,
        1380
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "88543ed7-0798-44aa-9b7d-d893712ef11d",
      "name": "находим машину по odoo id1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        1180,
        1380
      ],
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.message.chat.id}}",
            "status": "authorized"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "7903ab9d-fcb9-4160-99d7-48f276fd670a",
      "name": "меняем статус на дефолтный3",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        1620,
        1380
      ],
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Загрузка весовой в рейс",
        "height": 325.36388985291813,
        "width": 1581.9914497029301,
        "color": 4
      },
      "id": "a58eb23b-d479-4ec0-88c2-20ac35064757",
      "name": "Sticky Note63",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        460,
        1300
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "Фото прикреплено",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Продолжить",
                    "additionalFields": {
                      "callback_data": "final"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "0d0b8af2-bb99-4dd1-872f-8874c1957b0c",
      "name": "возврат к завершению заказа",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1840,
        1380
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "errorMessage": "444"
      },
      "id": "0e56dc50-7f35-409d-8574-3d4ccb9303b7",
      "name": "Stop and Error",
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -1000,
        3860
      ],
      "disabled": true
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "d9a59631-b219-4327-aa5d-3b787c0ff475",
      "name": "преобразуем в 1 переменную",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        960,
        5560
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.message.message_id - 1}}",
        "replyMarkup": "inlineKeyboard",
        "text": "=Отлично, отправляйте фото",
        "additionalFields": {}
      },
      "id": "b5b8eaa0-a070-41bc-a25e-9b177d57e8f2",
      "name": "убираем кнопку \"назад\" у прикрепления фото1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        560,
        1380
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.message.message_id - 1}}",
        "text": "Отправьте фотографию чека с заправки:",
        "additionalFields": {}
      },
      "id": "03ee6690-b722-45a5-9742-ea60f3e34814",
      "name": "убираем кнопку назад",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        2100,
        993
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Загрузка ТТН",
        "height": 256.77194452893985,
        "width": 1568.0405153439622,
        "color": 4
      },
      "id": "eac3f0a2-6e14-408a-b16c-63cc48e23f31",
      "name": "Sticky Note18",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        460,
        1700
      ]
    },
    {
      "parameters": {
        "operation": "binaryToPropery",
        "options": {}
      },
      "id": "cb0e3eff-38b0-4b03-9b02-e3ce13d0b4b8",
      "name": "Extract from File3",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        860,
        1740
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.message.chat.id}}",
            "status": "authorized"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "0f5425e9-ba80-4458-87f4-06ad0197a020",
      "name": "меняем статус на дефолтный5",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        1560,
        1740
      ],
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "a18ea95c-ecc9-4fbe-9a80-4944f8b949e8",
      "name": "получаем номер машины для эндпоинта",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        1080,
        1740
      ],
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://everest.lamart.site/upload_ttn",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number_car\":  {{'\"'+ $json.number_car +'\"'}},\n  \"transportation_id\":  {{ $('Execute Workflow Trigger').item.json.transportation_for_certificate }},\n  \"files\":{{'\"'+ $('Extract from File3').item.json.data +'\"'}}\n} ",
        "options": {}
      },
      "id": "b8dc776c-09b0-4dc9-9ca0-c7424f5e2a61",
      "name": "загрузка ттн",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1340,
        1740
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "Фото прикреплено",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Продолжить",
                    "additionalFields": {
                      "callback_data": "={{ `TS_${$('Execute Workflow Trigger').item.json.transportation_for_certificate}`}}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "75847451-fffa-4133-a467-6d6c8780a3d3",
      "name": "возврат к меню загрузки документов",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1760,
        1740
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Execute Workflow Trigger').item.json.message.photo.reduce((largest, current) => current.file_size > largest.file_size ? current : largest).file_id; }}"
      },
      "id": "317f8dab-e1be-41ca-8843-0136c5cc8ae2",
      "name": "получение фото из тг4",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        980,
        2080
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "binaryToPropery",
        "options": {}
      },
      "id": "6d2ec5a9-634b-4ba3-a490-42f4448d8329",
      "name": "Extract from File4",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1240,
        2080
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "=Вы отправили больше фото, чем необходимо\nБыло загружено <b>{{ $('Execute Workflow Trigger').item.json.count_weight_photo }}</b> фото",
        "replyMarkup": "inlineKeyboard",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "id": "43ecd3ab-f3f2-4e5a-9729-28e0649b8f64",
      "name": "отправлено больше весовых, чем надо",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1700,
        2080
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://everest.lamart.site/upload_weight_certificates",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number_car\":  {{'\"'+ $('номер авто5').item.json.number_car +'\"'}},\n  \"transportation_id\":  {{ $('Execute Workflow Trigger').item.json.transportation_for_certificate }},\n  \"files\":{{'\"'+ $('Extract from File4').item.json.data +'\"'}}\n}",
        "options": {}
      },
      "id": "650d21c2-8cf5-4ccd-8a1d-3ab3988ac525",
      "name": "загрузка весовой в рейс1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1440,
        2080
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "content": "## Загрузка весовых в конце смены",
        "height": 268.17049395605403,
        "width": 1448.2684080005397
      },
      "id": "7b6c5bf6-5567-4a3d-9648-3eb15677bce6",
      "name": "Sticky Note65",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        460,
        2000
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "95397d0b-84c4-42aa-a1d3-19e2ac41e95e",
      "name": "номер авто5",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        520,
        2080
      ],
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.message.message_id - 1}}",
        "replyMarkup": "inlineKeyboard",
        "text": "=❗Загружены не все весовые справки по данной перевозке.\nОтправьте <b>{{ $('Execute Workflow Trigger').item.json.count_weight_photo }}</b> фото для загрузки\nНажмите кнопку \"Готово✅\", как отправите фото",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Готово✅",
                    "additionalFields": {
                      "callback_data": "={{ `NTS_${$('Execute Workflow Trigger').item.json.transportation_for_certificate}`}}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "659bcb21-f35b-4f75-86f4-b75671b6394c",
      "name": "добавляем кнопку Готово, если загружены весовые",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        740,
        2080
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "a4eaf43c-d5bb-48ad-a5dc-3e6c033e24fe",
      "name": "айди для отправки сообщения1",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        3175,
        1371
      ],
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "7a50f562-135d-4feb-9062-4c112ed61eaf",
      "name": "преобразуем в 1 переменную6",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        3600,
        1369
      ]
    },
    {
      "parameters": {
        "content": "## Голосовые (срочно: автомобиль)",
        "height": 231.9851317234963,
        "width": 1025.966221174398,
        "color": 6
      },
      "id": "62742348-25bb-4f75-8726-a718c9afcdd5",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2940,
        1320
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
            "status": "authorized"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "80aade35-12e1-4632-8a39-3e29eb28f663",
      "name": "возвращаем статус1",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        660,
        3340
      ],
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "get",
        "customResourceId": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}",
        "options": {}
      },
      "id": "ca93dcb0-1736-453c-8f52-015ab0515735",
      "name": "данные сотрудника1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        280,
        3340
      ],
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "db6163ce-d2ab-4fae-9fdb-2be7d5527cdc",
      "name": "номер авто1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        480,
        3340
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "b08c030d-5d84-4aa0-9aa3-5c0323bf9046",
      "name": "айди для отправки сообщения2",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        3215,
        1731
      ],
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "=Кружок отправлен механикам и логистам/диспетчеру\n{{ $('номер авто1').item.json[\"number_car\"] ? \"\" : \"Авто не указан!\" }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "3f00e882-592d-42a3-a2ad-930ea014c9d7",
      "name": "сообщение отправлено",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        4000,
        1720
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Кружок (срочно: автомобиль)",
        "height": 252.5302443990458,
        "width": 1255.9125918497343,
        "color": 6
      },
      "id": "ed57e21b-1c53-4f06-af1f-e515741ad0af",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2940,
        1680
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "da433d96-0ef2-4e18-8d50-ffefc46ec0a5",
              "leftValue": "={{ $('номер авто1').item.json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            },
            {
              "id": "0a09ff61-b374-48d1-9bac-914503d449e5",
              "leftValue": "={{ $('Execute Workflow Trigger').item.json.message.caption }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "b9da6c71-412b-4ea7-9ca2-8f874460c5e5",
      "name": "можно создать заявку?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        2680,
        2700
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_title",
              "value": "Механик"
            }
          ]
        }
      },
      "id": "43521864-0204-4ad6-9f24-b4363d803aa4",
      "name": "поиск механиков1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        3220,
        2391
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "0b0669cf-be8e-4deb-b510-e7c9da444832",
      "name": "поиск тг айди механиков1",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        3420,
        2391
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "95eed840-236a-4a59-b0a7-f4f1d5ef74f5",
      "name": "преобразуем в 1 переменную5",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        3820,
        2391
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "16caf824-7a00-4284-b25b-bc72aa5905eb",
              "name": "message",
              "value": "={{ \"Создана заявка на тех. обслуживание\\nВидео отправлено механику\" }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "8d74d72a-4a80-4130-b65a-c439275cac08",
      "name": "Edit Fields5",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        4000,
        2391
      ]
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {}
          ]
        },
        "options": {}
      },
      "id": "72130a1d-d74d-4d2d-a4b5-6635804745bb",
      "name": "Aggregate1",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        3820,
        2611
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9bb0655d-024f-47a7-a880-8644ced9b94a",
              "name": "message",
              "value": "={{ \"Видео отправлено логисту/диспетчеру\" }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "4d978103-6630-4a3d-85ca-76c62a564ec9",
      "name": "Edit Fields6",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        4000,
        2611
      ]
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "concatenate",
              "field": "message",
              "separateBy": "\n"
            }
          ]
        },
        "options": {}
      },
      "id": "09a808f2-4a29-4dd8-bbc5-b41475648dcb",
      "name": "Summarize",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        4420,
        2511
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.concatenated_message }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "904683e2-4d1a-43e0-9c9e-56950ee46678",
      "name": "Сообщение отправлено",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        4600,
        2511
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {},
      "id": "d4ebf09b-d5fd-40e8-87f7-c166d2d58e64",
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [
        4240,
        2511
      ]
    },
    {
      "parameters": {
        "operation": "sendVideo",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.video_note.file_id }}",
        "additionalFields": {}
      },
      "id": "3c5e9735-79a7-4d2f-94b5-cb986f9e7612",
      "name": "отправка кружка",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        3420,
        1729
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('айди для отправки сообщения2').item.json.tg_id }}",
        "text": "=У водителя <b>{{ $('данные сотрудника1').item.json[\"display_name\"] }}</b> <a href=\"tel:{{ $('данные сотрудника1').item.json.mobile_phone }}\">{{ $('данные сотрудника1').item.json.mobile_phone }}</a> проблема с авто <b>{{ $('номер авто1').item.json[\"number_car\"] ? $('номер авто1').item.json[\"number_car\"] : \"(авто не указан)\" }}</b>",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Перейти к диалогу",
                    "additionalFields": {
                      "url": "=tg://user?id={{ $('Execute Workflow Trigger').item.json.tg_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML",
          "reply_to_message_id": "={{ $json.result.message_id }}"
        }
      },
      "id": "7f7223c2-c6c3-4a8b-ad07-96d26d5f2d9e",
      "name": "отправка сообщения4",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        3620,
        1729
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "fe41195f-aa20-4e1d-83a2-0b7f8d345733",
      "name": "айди для отправки сообщения3",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        3220,
        2920
      ],
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Видео (срочно: автомобиль) + заявка",
        "height": 466.4432085709194,
        "width": 1832.364232323528,
        "color": 6
      },
      "id": "b90cce85-96e3-46bb-93c8-82659c5427f4",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2960,
        2300
      ]
    },
    {
      "parameters": {
        "operation": "sendVideo",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.video.file_id }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Перейти к диалогу",
                    "additionalFields": {
                      "url": "=tg://user?id={{ $('Execute Workflow Trigger').item.json.tg_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "caption": "=У водителя <b>{{ $('данные сотрудника1').item.json[\"display_name\"] }}</b> <a href=\"tel:{{ $('данные сотрудника1').item.json.mobile_phone }}\">{{ $('данные сотрудника1').item.json.mobile_phone }}</a> проблема с авто <b>{{ $('номер авто1').item.json[\"number_car\"] ? $('номер авто1').item.json[\"number_car\"] : \"(авто не указан)\" }}</b>: \n\n<i>{{ $('Execute Workflow Trigger').item.json.message.caption}}</i>",
          "parse_mode": "HTML"
        }
      },
      "id": "cf0d6f97-00f6-41e0-a41d-598123c28b8a",
      "name": "отправка видео2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        3440,
        2920
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "b65d25ea-b74c-4beb-9bc5-60b690bb7f2b",
      "name": "преобразуем в 1 переменную8",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        3660,
        2920
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "=Видео отправлено механикам и логистам/диспетчеру\n{{ $('номер авто1').item.json[\"number_car\"] ? \"\" : \"Авто не указан!\" }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "941db7b5-4a54-4e6e-935b-4175c8f1fb80",
      "name": "сообщение отправлено3",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        3860,
        2920
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Видео (автомобиль: срочно) нет заявки",
        "height": 234.22231998097533,
        "width": 1132.793870769613,
        "color": 6
      },
      "id": "d0cc9f15-2ccc-4fdd-bd96-8194f2bbf300",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2960,
        2860
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "1877abc1-a06b-4e71-8bfc-0b60b4e4b921",
      "name": "айди для отправки сообщения4",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        3160,
        3840
      ],
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "d7fbcf3a-d46a-4869-8445-23747787e072",
      "name": "преобразуем в 1 переменную9",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        3480,
        3840
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "=Фото отправлено механикам и логистам/диспетчеру\n{{ $('номер авто1').item.json[\"number_car\"] ? \"\" : \"Авто не указан!\" }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "8008df04-d9a4-48b3-a6c1-0026c3d83878",
      "name": "сообщение отправлено4",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        3660,
        3840
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Фото (срочно: автомобиль) без заявки",
        "height": 244.81939069912534,
        "width": 854.7851037481637,
        "color": 6
      },
      "id": "f3082de8-92b7-4ab4-8f6e-d5be97a3a862",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2980,
        3800
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_title",
              "value": "Механик"
            }
          ]
        }
      },
      "id": "c5d352b4-a61d-4c1e-8ac5-ff8540953c7a",
      "name": "поиск механиков",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        3880,
        3300
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "f9bb282f-f285-4bf0-9bae-8b03184b6faf",
      "name": "поиск тг айди механиков",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        4080,
        3300
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "a3abd59e-71f0-4e87-9873-a8b8a2c27f85",
      "name": "преобразуем в 1 переменную10",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4480,
        3300
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "16caf824-7a00-4284-b25b-bc72aa5905eb",
              "name": "message",
              "value": "={{ \"Создана заявка на тех. обслуживание\\nФото отправлено механику\" }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "b8889753-674d-43df-b159-5346b50cfa0e",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        4660,
        3300
      ]
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {}
          ]
        },
        "options": {}
      },
      "id": "d5433799-2050-44de-a26a-4264c7b3586d",
      "name": "Aggregate",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4480,
        3520
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9bb0655d-024f-47a7-a880-8644ced9b94a",
              "name": "message",
              "value": "={{ \"Фото отправлено логисту/диспетчеру\" }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "2587ff2d-b209-4303-b2a1-18d47ed47539",
      "name": "Edit Fields7",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        4660,
        3520
      ]
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "concatenate",
              "field": "message",
              "separateBy": "\n"
            }
          ]
        },
        "options": {}
      },
      "id": "0829da8a-61cd-4aa5-9b62-c707507be6b5",
      "name": "Summarize1",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        5080,
        3420
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.concatenated_message }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "0310b8d3-f96e-44a8-b020-688f46f1104c",
      "name": "Сообщение отправлено1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        5260,
        3420
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {},
      "id": "c7df2f1c-521d-42b1-997a-b77e9c5d7a12",
      "name": "Merge2",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [
        4900,
        3420
      ]
    },
    {
      "parameters": {
        "content": "## Фото (срочно: автомобиль) + заявка",
        "height": 466.4432085709194,
        "width": 2431.2405363506864,
        "color": 6
      },
      "id": "5fc41040-ab60-4ef9-823a-707973e40592",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2960,
        3260
      ]
    },
    {
      "parameters": {
        "operation": "binaryToPropery",
        "options": {}
      },
      "id": "bea97576-c764-49ea-8ee5-9c0a04d313e6",
      "name": "Extract from File5",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        3420,
        3440
      ]
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Execute Workflow Trigger').item.json.message.photo.reduce((largest, current) => current.file_size > largest.file_size ? current : largest).file_id; }}"
      },
      "id": "728c10a5-1f47-499d-81be-7ae352a92983",
      "name": "получение фото из тг5",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        3200,
        3440
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.round",
        "operation": "getAll",
        "options": {
          "fieldsList": [
            "transportation"
          ]
        },
        "filterRequest": {
          "filter": [
            {
              "fieldName": "car",
              "value": "={{ $('номер авто1').all()[0].json.id }}"
            },
            {
              "fieldName": "status",
              "value": "Выполняется"
            }
          ]
        }
      },
      "id": "5d07b24a-7017-4b89-8e81-1f4d01db8f1b",
      "name": "рейсы",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        2360,
        4460
      ],
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "keep": "lastItems"
      },
      "id": "2983f8d1-7cb6-4193-a282-d9351c7852a6",
      "name": "актуальный рейс",
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        2580,
        4460
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "transportation.transportation",
        "operation": "get",
        "customResourceId": "={{ $json.transportation[0] }}",
        "options": {
          "fieldsList": []
        }
      },
      "id": "a21b0048-ae55-4484-9eda-f646e3c4ae52",
      "name": "получим перевозку",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        2800,
        4460
      ],
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "06957abc-1855-46f6-ba1a-7207cb6c3a81",
              "name": "logists",
              "value": "=@<a href=\"tg://user?id={{ $json.tg_id }}\">Логист</a>",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "27048b6f-6c2c-4ebe-9d7b-123e751b7fb5",
      "name": "айди логистов",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        4029,
        4225
      ]
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "concatenate",
              "field": "logists",
              "separateBy": "\n"
            }
          ]
        },
        "options": {}
      },
      "id": "ff5c3519-0fdc-47ad-9d84-cdfcb0a30bec",
      "name": "в один текст",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        4260,
        4220
      ]
    },
    {
      "parameters": {
        "operation": "sendAudio",
        "chatId": "-1002392592613",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.voice.file_id }}",
        "additionalFields": {
          "caption": "=У водителя <a href=\"tg://user?id={{ $('Execute Workflow Trigger').all()[0].json.message.chat.id }}\">{{ $('данные сотрудника1').all()[0].json.name }}</a>(авто {{ $('номер авто1').all()[0].json.number_car }}) проблема на маршруте <b>{{ $('получим перевозку').all()[0].json.display_name.substring(11) }}</b> \n{{ $('в один текст').item.json.concatenated_logists != `@<a href=\"tg://user?id=\">Логист</a>` ? $('в один текст').item.json.concatenated_logists : \"\"}}\n{{ $('в один текст1').item.json.concatenated_dispatchers != `@<a href=\"tg://user?id=\">Диспетчер</a>` ?  $('в один текст1').item.json.concatenated_dispatchers : \"\"}}",
          "parse_mode": "HTML"
        }
      },
      "id": "c1da1359-e99e-4ec8-b281-da5cce58f7bc",
      "name": "отправка в чат",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        5720,
        4000
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.message.message_id -1}}",
        "text": "Проблема с маршрутом\nОтправьте сообщение, фото, видео, запись диктофона или кружок:",
        "additionalFields": {}
      },
      "id": "b9f79509-26a0-4a61-a791-167a93a2e46d",
      "name": "убираем кнопку назад1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        5980,
        4260
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "Вы отправили информацию о маршруте логистам/диспетчеру",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "93a5017c-cbec-490a-a7f3-afcd3a79c57c",
      "name": "Сообщение отправлено2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        6160,
        4260
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendVideo",
        "chatId": "=-1002392592613",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.video_note.file_id }}",
        "additionalFields": {}
      },
      "id": "c270dd1a-1660-42c3-9ee4-33868fe2db00",
      "name": "отправка кружка1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        5560,
        4160
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "=-1002392592613",
        "text": "=У водителя <a href=\"tg://user?id={{ $('Execute Workflow Trigger').all()[0].json.message.chat.id }}\">{{ $('данные сотрудника1').all()[0].json.name }}</a>(авто {{ $('номер авто1').all()[0].json.number_car }}) проблема на маршруте <b>{{ $('получим перевозку').all()[0].json.display_name.substring(11)}}</b> \n{{ $('в один текст').item.json.concatenated_logists != `@<a href=\"tg://user?id=\">Логист</a>` ? $('в один текст').item.json.concatenated_logists : \"\"}}\n{{ $('в один текст1').item.json.concatenated_dispatchers != `@<a href=\"tg://user?id=\">Диспетчер</a>` ?  $('в один текст1').item.json.concatenated_dispatchers : \"\"}}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML",
          "reply_to_message_id": "={{ $json.result.message_id }}"
        }
      },
      "id": "3fc3be2b-1079-4608-b06f-c4c1f9a58cab",
      "name": "отправка сообщения",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        5720,
        4160
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendVideo",
        "chatId": "=-1002392592613",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.video.file_id }}",
        "additionalFields": {
          "caption": "=У водителя <a href=\"tg://user?id={{ $('Execute Workflow Trigger').all()[0].json.message.chat.id }}\">{{ $('данные сотрудника1').all()[0].json.name }}</a>(авто {{ $('номер авто1').all()[0].json.number_car }}) проблема на маршруте <b>{{ $('получим перевозку').all()[0].json.display_name.substring(11) }}</b>: <i>{{ $('Execute Workflow Trigger').item.json.message.caption }}</i>\n\n{{ $('в один текст').item.json.concatenated_logists != `@<a href=\"tg://user?id=\">Логист</a>` ? $('в один текст').item.json.concatenated_logists : \"\"}}\n{{ $('в один текст1').item.json.concatenated_dispatchers != `@<a href=\"tg://user?id=\">Диспетчер</a>` ?  $('в один текст1').item.json.concatenated_dispatchers : \"\"}}",
          "parse_mode": "HTML"
        }
      },
      "id": "bd299e5f-0413-4380-97fa-419e0d42b954",
      "name": "отправка видео3",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        5720,
        4320
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "=-1002392592613",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.photo.reduce((largest, current) => current.file_size > largest.file_size ? current : largest).file_id; }}",
        "additionalFields": {
          "caption": "=У водителя <a href=\"tg://user?id={{ $('Execute Workflow Trigger').all()[0].json.message.chat.id }}\">{{ $('данные сотрудника1').all()[0].json.name }}</a>(авто {{ $('номер авто1').all()[0].json.number_car }}) проблема на маршруте <b>{{ $('получим перевозку').all()[0].json.display_name.substring(11) }}</b>: <i>{{ $('Execute Workflow Trigger').item.json.message.caption }}</i>\n\n{{ $('в один текст').item.json.concatenated_logists != `@<a href=\"tg://user?id=\">Логист</a>` ? $('в один текст').item.json.concatenated_logists : \"\"}}\n{{ $('в один текст1').item.json.concatenated_dispatchers != `@<a href=\"tg://user?id=\">Диспетчер</a>` ?  $('в один текст1').item.json.concatenated_dispatchers : \"\"}}",
          "parse_mode": "HTML"
        }
      },
      "id": "6962c81f-0f94-45d8-a969-505d222df733",
      "name": "отправка фото2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        5720,
        4480
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Срочно маршруты",
        "height": 669.7051122841553,
        "width": 2275.2909968159115,
        "color": 6
      },
      "id": "9c58ef15-cfed-4417-b04f-6e48a3055a51",
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        4000,
        3960
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.status.substring(22) }}",
                    "rightValue": "route",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "e8828708-754c-46ca-a414-71299841fb5e",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.status.substring(22) }}",
                    "rightValue": "document",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "c9d8ff8b-e14e-4d87-8c9c-7fe6b8f0cbdb",
      "name": "маршрут?",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        3600,
        4460
      ]
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {}
          ]
        },
        "options": {}
      },
      "id": "f5ef0100-58c2-4885-9989-f32713ea9ae7",
      "name": "Aggregate2",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4940,
        4920
      ]
    },
    {
      "parameters": {
        "operation": "sendVideo",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.video_note.file_id }}",
        "additionalFields": {}
      },
      "id": "71a78d3e-21ad-441b-8842-efc9194655f5",
      "name": "отправка кружка2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        4400,
        4920
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.message.message_id -1}}",
        "text": "Проблема с документами\nОтправьте сообщение, фото, видео, запись диктофона или кружок:",
        "additionalFields": {}
      },
      "id": "3f734c2d-1b41-462c-8017-24a748ee6d4a",
      "name": "убираем кнопку назад2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        5140,
        4920
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "Вы отправили информацию о документах логистам/диспетчеру",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "3f0d6352-40e3-4f54-89da-fcfd2b3ae0bc",
      "name": "Сообщение отправлено3",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        5320,
        4920
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://everest.lamart.site/add_repaired_photo",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"maintenance_id\": {{ $('Execute Workflow Trigger').item.json.end_request_id }},\n    \"image\":  {{'\"'+ $('Extract from File1').item.json.data + '\"'}}\n}",
        "options": {}
      },
      "id": "bb964ff2-bb30-41e0-9b22-59e09aeada43",
      "name": "загрузка фото исправления",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1280,
        540
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://everest.lamart.site/add_breakage_photo",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"maintenance_id\": {{ $json.id }},\n    \"image\":  {{'\"'+ $('Extract from File').item.json.data + '\"'}}\n}",
        "options": {}
      },
      "id": "ee4b69b8-de0e-4a3c-bb06-828f17bc3d10",
      "name": "загрузка фото неисправности",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        520,
        4840
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "515b67c4-2b70-4441-abd3-3dd6d0490d95",
      "name": "поиск тг айди логистов+диспетчер",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        3400,
        2611
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_id",
              "operator": "in",
              "value": "={{ [\"Механик\", \"Логист\", \"Диспетчер\"] }}"
            }
          ]
        }
      },
      "id": "9cff9fcf-93f3-4f47-81b6-73698433fff6",
      "name": "механики и логисты3 диспетчер",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        3000,
        2920
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_id",
              "operator": "in",
              "value": "={{ [\"Механик\", \"Логист\", \"Диспетчер\"] }}"
            }
          ]
        }
      },
      "id": "3a6e40e6-e75f-483a-b90c-652f3b3f197e",
      "name": "механики и логисты1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        2955,
        1371
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_title",
              "operator": "in",
              "value": "={{ [\"Логист\", \"Диспетчер\"] }}"
            }
          ]
        }
      },
      "id": "875f11f9-6856-4bbd-94ac-f086417f2fd2",
      "name": "поиск логистов",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        3220,
        2611
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendAudio",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.voice.file_id }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Перейти к диалогу",
                    "additionalFields": {
                      "url": "=tg://user?id={{ $('Execute Workflow Trigger').item.json.tg_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "caption": "=У водителя <b>{{ $('данные сотрудника1').item.json[\"display_name\"] }}</b> <a href=\"tel:{{ $('данные сотрудника1').item.json.mobile_phone }}\">{{ $('данные сотрудника1').item.json.mobile_phone }}</a> проблема с авто <b>{{ $('номер авто1').item.json[\"number_car\"] ? $('номер авто1').item.json[\"number_car\"] : \"(авто не указан)\" }}</b>",
          "parse_mode": "HTML"
        }
      },
      "id": "77a9a165-3c3f-433a-828e-0244842505cc",
      "name": "отправка аудио",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        3395,
        1371
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "=Голосовое сообщение отправлено механикам и логистам/диспетчеру\n{{ $('номер авто1').item.json[\"number_car\"] ? \"\" : \"Авто не указан!\" }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "fe007e50-db44-4206-8133-2cc42c88bf35",
      "name": "сообщение отправлено2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        3780,
        1369
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "3164f282-97ae-44de-af9c-c605c7a04de2",
      "name": "преобразуем в 1 переменную7",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        3820,
        1720
      ],
      "executeOnce": false
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.photo.reduce((largest, current) => current.file_size > largest.file_size ? current : largest).file_id; }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Перейти к диалогу",
                    "additionalFields": {
                      "url": "=tg://user?id={{ $('Execute Workflow Trigger').item.json.tg_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "caption": "=У водителя <b>{{ $('данные сотрудника1').item.json[\"display_name\"] }}</b> <a href=\"tel:{{ $('данные сотрудника1').item.json.mobile_phone }}\">{{ $('данные сотрудника1').item.json.mobile_phone }}</a> проблема с авто <b>{{ $('номер авто1').item.json[\"number_car\"] ? $('номер авто1').item.json[\"number_car\"] : \"(авто не указан)\" }}</b>",
          "parse_mode": "HTML"
        }
      },
      "id": "fc371713-dd81-43ce-a12a-f6e4b5f75fb8",
      "name": "отправка фото",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        3320,
        3840
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_title",
              "operator": "in",
              "value": "={{ [\"Логист\", \"Диспетчер\"] }}"
            }
          ]
        }
      },
      "id": "cf17a47d-3241-4496-a293-b417ee2afd8e",
      "name": "поиск логистов4",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        3880,
        3520
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "643f10ac-de8b-478d-9b9c-3f2e0b63547a",
      "name": "поиск тг айди логистов4",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        4063,
        3529
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {
          "fieldsList": [
            "id"
          ]
        },
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_title",
              "operator": "in",
              "value": "={{ [\"Логист\"] }}"
            }
          ]
        }
      },
      "id": "54b20b25-a797-44a3-901b-a6e910f6c1b2",
      "name": "поиск логистов5",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        3040,
        4460
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "7dcd7cb4-8698-4233-adba-b045bd57a5fe",
      "name": "поиск тг айди логистов",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        3260,
        4460
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "06957abc-1855-46f6-ba1a-7207cb6c3a81",
              "name": "dispatchers",
              "value": "=@<a href=\"tg://user?id={{ $json.tg_id }}\">Диспетчер</a>",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "00f3d946-2154-44d1-91a7-43eb19616a8c",
      "name": "айди диспетчера",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        4880,
        4220
      ]
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "concatenate",
              "field": "dispatchers",
              "separateBy": "\n"
            }
          ]
        },
        "options": {}
      },
      "id": "e02a0fbf-1f5e-4395-9188-96ba652f8ae5",
      "name": "в один текст1",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        5100,
        4220
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_title",
              "value": "Диспетчер"
            }
          ]
        }
      },
      "id": "37e412cb-e154-483e-96fd-b09ea6631a24",
      "name": "диспетчер4",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        4500,
        4220
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "503e3c9d-cda3-40ed-9571-92c5372e89d4",
      "name": "айди для отправки сообщения8",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        4680,
        4220
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Срочно документы",
        "height": 669.7051122841553,
        "width": 2781.8110403917585,
        "color": 6
      },
      "id": "ff3a83de-3192-46b8-896f-6cd0ca58ead3",
      "name": "Sticky Note11",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        4000,
        4720
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_id",
              "operator": "in",
              "value": "={{ [\"Диспетчер\"] }}"
            }
          ]
        }
      },
      "id": "dfff6297-14ab-4b8e-94ef-68bbf80c4754",
      "name": "диспетчер5",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        5660,
        4920
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "fa17be90-70b0-4012-b0d8-011c8e0d64d8",
      "name": "айди для отправки сообщения9",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        5820,
        4920
      ],
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.status.substring(22) }}",
                    "rightValue": "={{ \"\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "c604997d-5f90-4861-8b48-3c4813bef027",
      "name": "с чем проблема",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        880,
        3340
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.message.voice.file_unique_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "f16d54dc-9e6d-497d-92ea-65ce2b873fb8",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.message.video_note.file_unique_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "918ef68c-695d-48d5-ae61-9930bd25afd5",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.message.video.file_unique_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "2924d906-6db9-4e6b-9cc2-9dceb98f71fb",
      "name": "тип медиа",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        1560,
        3280
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.message.message_id -1}}",
        "text": "Проблема с автомобилем\nОтправьте сообщение, фото, видео, запись диктофона или кружок:",
        "additionalFields": {}
      },
      "id": "725954e6-ef5a-4759-8905-d45a265ed345",
      "name": "убираем кнопку назад3",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1220,
        3320
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.message.voice.file_unique_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "f16d54dc-9e6d-497d-92ea-65ce2b873fb8",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.message.video_note.file_unique_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "918ef68c-695d-48d5-ae61-9930bd25afd5",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.message.video.file_unique_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "aeb3c3b4-9165-4a62-ad36-5827d5d5d2a5",
      "name": "тип медиа1",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        5311,
        4215
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.message.voice.file_unique_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "f16d54dc-9e6d-497d-92ea-65ce2b873fb8",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.message.video_note.file_unique_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "918ef68c-695d-48d5-ae61-9930bd25afd5",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.message.video.file_unique_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "a1473d64-c365-47cc-9472-eb3cea2b71e2",
      "name": "тип медиа3",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        6020,
        4940
      ]
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.photo.reduce((largest, current) => current.file_size > largest.file_size ? current : largest).file_id; }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Перейти к диалогу",
                    "additionalFields": {
                      "url": "=tg://user?id={{ $('Execute Workflow Trigger').item.json.tg_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "caption": "=Проблема с <b>документами</b> у водителя {{ $('данные сотрудника1').item.json[\"display_name\"] }} <a href=\"tel:{{ $('данные сотрудника1').item.json.mobile_phone }}\">{{ $('данные сотрудника1').item.json.mobile_phone }}</a>(авто {{ $('номер авто1').item.json[\"number_car\"] }}) на маршруте {{ $('получим перевозку').all()[0].json.display_name.substring(11) }}: <i>{{ $('Execute Workflow Trigger').item.json.message.caption }}</i>",
          "parse_mode": "HTML"
        }
      },
      "id": "df95a618-8bf5-4fd6-960e-b30f9f0ee54d",
      "name": "отправка фото4",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        4600,
        5240
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "sendVideo",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.video.file_id }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Перейти к диалогу",
                    "additionalFields": {
                      "url": "=tg://user?id={{ $('Execute Workflow Trigger').item.json.tg_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "caption": "=Проблема с <b>документами</b> у водителя {{ $('данные сотрудника1').item.json[\"display_name\"] }} <a href=\"tel:{{ $('данные сотрудника1').item.json.mobile_phone }}\">{{ $('данные сотрудника1').item.json.mobile_phone }}</a>(авто {{ $('номер авто1').item.json[\"number_car\"] }}) на маршруте {{ $('получим перевозку').all()[0].json.display_name.substring(11) }}: <i>{{ $('Execute Workflow Trigger').item.json.message.caption }}</i>",
          "parse_mode": "HTML"
        }
      },
      "id": "14d93832-f05d-4b2f-8ae3-7045d7c100c7",
      "name": "отправка видео4",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        4600,
        5080
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "chatId": "={{ $json.result.chat.id }}",
        "text": "=Проблема с <b>документами</b> у водителя {{ $('данные сотрудника1').item.json[\"display_name\"] }} <a href=\"tel:{{ $('данные сотрудника1').item.json.mobile_phone }}\">{{ $('данные сотрудника1').item.json.mobile_phone }}</a>(авто {{ $('номер авто1').item.json[\"number_car\"] }}) на маршруте {{ $('получим перевозку').all()[0].json.display_name.substring(11) }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Перейти к диалогу",
                    "additionalFields": {
                      "url": "=tg://user?id={{ $('Execute Workflow Trigger').item.json.tg_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML",
          "reply_to_message_id": "={{ $json.result.message_id }}"
        }
      },
      "id": "585d75e9-ab78-40b5-bceb-6136d9847fd9",
      "name": "отправка сообщения1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        4600,
        4920
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "sendAudio",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.voice.file_id }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Перейти к диалогу",
                    "additionalFields": {
                      "url": "=tg://user?id={{ $('Execute Workflow Trigger').item.json.tg_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "caption": "=Проблема с <b>документами</b> у водителя {{ $('данные сотрудника1').item.json[\"display_name\"] }} <a href=\"tel:{{ $('данные сотрудника1').item.json.mobile_phone }}\">{{ $('данные сотрудника1').item.json.mobile_phone }}</a>(авто {{ $('номер авто1').item.json[\"number_car\"] }}) на маршруте {{ $('получим перевозку').all()[0].json.display_name.substring(11) }}",
          "parse_mode": "HTML"
        }
      },
      "id": "94de8255-ea52-46c9-89c5-4317a4db44c5",
      "name": "отправка в чат1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        4600,
        4740
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.status }}",
                    "rightValue": "adding_end_request_photo",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "a36fdeef-c179-48b5-8014-915761e4f22c",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.status }}",
                    "rightValue": "photo_fuel_receipt",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "a621526f-3c31-40d0-bbd3-725ca1a082a9",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.status }}",
                    "rightValue": "weight_photo",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "5440c7a7-885e-4d3b-9a59-f5244fdf1106",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.status }}",
                    "rightValue": "TTN_photo",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "1a177d26-5797-4b27-a670-da1bafa21438",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.status }}",
                    "rightValue": "many_weight_photo",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "6c768da1-fc17-4d25-b91e-6ebaddcee89c",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.status }}",
                    "rightValue": "inputing_warn_message",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "0364af62-9f10-4eca-adea-acf03d8923a5",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.status }}",
                    "rightValue": "inputing_to_dispatcher",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "3e9ae588-d66c-4ff6-83ca-e343efb64725",
      "name": "проверка статуса",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -500,
        3260
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_id",
              "operator": "in",
              "value": "={{ [\"Диспетчер\"] }}"
            }
          ]
        }
      },
      "id": "3e29cb10-c3e1-4957-9e3f-0152bfdee23d",
      "name": "диспетчер6",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        100,
        3980
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "odoo_id",
              "value": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "ddf7156c-3456-43c4-a8bb-25c92f945a1f",
      "name": "айди для отправки сообщения10",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        260,
        3980
      ],
      "alwaysOutputData": false,
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Execute Workflow Trigger').item.json.message.video_note.file_id }}"
      },
      "id": "942e8fab-96ea-4031-95c6-b5d149bf2ad8",
      "name": "скачать файл9",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        720,
        3920
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendVideo",
        "chatId": "={{ $('айди для отправки сообщения10').all()[0].json.tg_id }}",
        "binaryData": true,
        "additionalFields": {}
      },
      "id": "62eda3ed-60a5-4d63-ac98-9f0d0ed48425",
      "name": "отправка кружка5",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        900,
        3920
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('айди для отправки сообщения10').all()[0].json.tg_id }}",
        "text": "=Сообщение от водителя автомобиля {{ $('номер авто').item.json.number_car }}, {{ $('данные сотрудника').item.json.name }}, <a href=\"tel:{{ $('данные сотрудника').item.json.mobile_phone }}\">{{ $('данные сотрудника').item.json.mobile_phone }}</a>",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Ответить на сообщение",
                    "additionalFields": {
                      "callback_data": "=answer_to_not_urgent_{{ $('Execute Workflow Trigger').item.json.message.chat.id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML",
          "reply_to_message_id": "={{ $json.result.message_id }}"
        }
      },
      "id": "614d2f93-e1e4-441b-a882-2dd58d00937f",
      "name": "текст9",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1040,
        3920
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Execute Workflow Trigger').item.json.message.video.file_id }}"
      },
      "id": "97fcbcad-8975-4abd-8344-ff441cd45387",
      "name": "скачать файл10",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        720,
        4060
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendVideo",
        "chatId": "={{ $('айди для отправки сообщения10').all()[0].json.tg_id }}",
        "binaryData": true,
        "additionalFields": {}
      },
      "id": "ce0bb9d4-c6ca-4f0b-a9e1-be9ddb79eae4",
      "name": "отправка видео7",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        880,
        4060
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('айди для отправки сообщения10').all()[0].json.tg_id }}",
        "text": "=Сообщение от водителя автомобиля {{ $('номер авто').item.json.number_car }}, {{ $('данные сотрудника').item.json.name }}, <a href=\"tel:{{ $('данные сотрудника').item.json.mobile_phone }}\">{{ $('данные сотрудника').item.json.mobile_phone }}</a>:\n<i>{{ $('Execute Workflow Trigger').item.json.message.caption }}</i>",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Ответить на сообщение",
                    "additionalFields": {
                      "callback_data": "=answer_to_not_urgent_{{ $('Execute Workflow Trigger').item.json.message.chat.id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML",
          "reply_to_message_id": "={{ $json.result.message_id }}"
        }
      },
      "id": "78d03bda-ed47-4d53-a45d-94e051a518df",
      "name": "текст10",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1040,
        4060
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.message.voice.file_unique_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "f16d54dc-9e6d-497d-92ea-65ce2b873fb8",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.message.video_note.file_unique_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "918ef68c-695d-48d5-ae61-9930bd25afd5",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.message.video.file_unique_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "25786403-d520-4958-a5ad-e926d5678b3d",
      "name": "тип медиа4",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        460,
        4000
      ]
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Execute Workflow Trigger').item.json.message.photo.reduce((largest, current) => current.file_size > largest.file_size ? current : largest).file_id; }}"
      },
      "id": "c97b67fd-f915-4b77-90da-6721c6606b14",
      "name": "скачать файл11",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        720,
        4220
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "={{ $('айди для отправки сообщения10').all()[0].json.tg_id }}",
        "binaryData": true,
        "additionalFields": {}
      },
      "id": "7381071d-2dd3-4d37-a845-45c854fff551",
      "name": "отправка фото7",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        900,
        4220
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('айди для отправки сообщения10').all()[0].json.tg_id }}",
        "text": "=Сообщение от водителя автомобиля {{ $('номер авто').item.json.number_car }}, {{ $('данные сотрудника').item.json.name }}, <a href=\"tel:{{ $('данные сотрудника').item.json.mobile_phone }}\">{{ $('данные сотрудника').item.json.mobile_phone }}</a>:\n<i>{{ $('Execute Workflow Trigger').item.json.message.caption }}</i>",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Ответить на сообщение",
                    "additionalFields": {
                      "callback_data": "=answer_to_not_urgent_{{ $('Execute Workflow Trigger').item.json.message.chat.id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML",
          "reply_to_message_id": "={{ $json.result.message_id }}"
        }
      },
      "id": "ced561cc-84b7-47c4-b948-896ba935c7f1",
      "name": "текст11",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1040,
        4220
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "get",
        "customResourceId": "={{ $json.odoo_id }}",
        "options": {}
      },
      "id": "ccc7d603-5801-4651-8b84-8fd88d67bf5d",
      "name": "данные сотрудника",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -260,
        3980
      ],
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "cars.cars",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $('Execute Workflow Trigger').item.json.odoo_id }}"
            }
          ]
        }
      },
      "id": "e66f2ed5-d21e-4811-88b7-9b8e6d008668",
      "name": "номер авто",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        -80,
        3980
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "efb64b5a-1142-4c95-958d-54b77272de72",
      "name": "преобразуем в 1 переменную11",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1280,
        3980
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "text": "=Сообщение отправлено диспетчеру",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "92799717-4521-4c28-a23a-3bf89c4edaac",
      "name": "сообщение отправлено5",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1460,
        3980
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Не срочное диспетчеру",
        "height": 643.2134985283512,
        "width": 2309.0790761453336,
        "color": 6
      },
      "id": "67ce11c7-135a-4464-b143-314b0e7f083b",
      "name": "Sticky Note12",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -281.4465885937989,
        3756.786501471649
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.message.message_id -1}}",
        "text": "Введите ваше сообщение диспетчеру",
        "additionalFields": {}
      },
      "id": "e578cc04-3dbd-4d57-a1bf-8b192f94dd92",
      "name": "убираем кнопку назад4",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1640,
        3980
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.message.chat.id }}",
            "status": "authorized"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "510eb756-a8ce-4925-8137-b2ba53e34586",
      "name": "возвращаем статус",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        1840,
        3980
      ],
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "formatDate",
        "date": "={{ $json.currentDate }}",
        "format": "custom",
        "customFormat": "dd.MM.yyyy HH:mm:ss",
        "options": {}
      },
      "id": "4f120a5e-0ee1-48ed-ba14-83ff6ec74c5c",
      "name": "форматированная дата",
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        940,
        993
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://everest.lamart.site/create_refill_by_car",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"date\": \"{{ $('форматированная дата').item.json.formattedDate }}\",\n  \"car_number\": \"{{ $('авто').item.json.number_car }}\",\n  \"number_of_liters\": {{ $('Execute Workflow Trigger').item.json.fuel_liters }},\n  \"driver_id\": {{ $('Execute Workflow Trigger').item.json.odoo_id }},\n\"check_scan\": \"{{ $json.data }}\"\n} ",
        "options": {}
      },
      "id": "99d70236-f946-4b9a-8382-f995f5375492",
      "name": "отправялем запрос",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1520,
        993
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "=cars.cars",
        "operation": "getAll",
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "driver_id",
              "value": "={{ $json.odoo_id }}"
            }
          ]
        }
      },
      "id": "5161d50d-2c83-456c-8d30-155564ea2998",
      "name": "авто",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        500,
        993
      ],
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "timezone": "Asia/Yekaterinburg"
        }
      },
      "id": "f7e6f63f-c845-41f7-b7cc-3d1815403fd9",
      "name": "время екатеринбург",
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        720,
        993
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "tg_users",
          "mode": "list",
          "cachedResultName": "tg_users"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "tg_id": "={{ $('Execute Workflow Trigger').item.json.tg_id }}",
            "status": "authorized"
          },
          "matchingColumns": [
            "tg_id"
          ],
          "schema": [
            {
              "id": "tg_id",
              "displayName": "tg_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "odoo_id",
              "displayName": "odoo_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "only_mech",
              "displayName": "only_mech",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mech_photo",
              "displayName": "mech_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_id",
              "displayName": "end_request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "materials_photo",
              "displayName": "materials_photo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "end_request_hours",
              "displayName": "end_request_hours",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "480217c5-9e5d-43bf-b0af-5b4b0f9edd9d",
      "name": "меняем статус на обычный2",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.3,
      "position": [
        1900,
        993
      ],
      "credentials": {
        "postgres": {
          "id": "cMlKL7XYShZtUnqo",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Execute Workflow Trigger').item.json.tg_id }}",
        "text": "Информация о заправке передана в систему. Спасибо!",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Продолжить",
                    "additionalFields": {
                      "callback_data": "check_career"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "id": "8043c08b-e27d-479b-ac60-7d3e969bd5ed",
      "name": "данные занесенны",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1700,
        993
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "content": "## Ввод литров с чеком",
        "height": 227.34078408756727,
        "width": 1746.421657047815,
        "color": 6
      },
      "id": "8249219a-481f-4a4e-84a2-fd7e082fca2f",
      "name": "Sticky Note13",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        480,
        920
      ]
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Execute Workflow Trigger').item.json.message.photo.reduce((largest, current) => current.file_size > largest.file_size ? current : largest).file_id; }}"
      },
      "id": "8c7755d4-015e-4f60-8cd4-3aa8e64376c9",
      "name": "получение фото из тг6",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1120,
        993
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "binaryToPropery",
        "options": {}
      },
      "id": "d651f75f-8eed-4825-82b6-6b51903ebd71",
      "name": "Extract from File6",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1300,
        993
      ]
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_id",
              "operator": "in",
              "value": "={{ [\"Механик\", \"Логист\", \"Диспетчер\"] }}"
            }
          ]
        }
      },
      "id": "9022c3fd-cbc2-4781-9bbb-4753aec4973a",
      "name": "механики и логисты диспетчер",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        2995,
        1731
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "resource": "custom",
        "customResource": "hr.employee",
        "operation": "getAll",
        "returnAll": true,
        "options": {},
        "filterRequest": {
          "filter": [
            {
              "fieldName": "job_id",
              "operator": "in",
              "value": "={{ [\"Механик\", \"Логист\", \"Диспетчер\"] }}"
            }
          ]
        }
      },
      "id": "3938fdae-9053-44ac-a97a-9d6e14480eca",
      "name": "механики и логисты диспетчер1",
      "type": "n8n-nodes-base.odoo",
      "typeVersion": 1,
      "position": [
        3000,
        3840
      ],
      "alwaysOutputData": true,
      "credentials": {
        "odooApi": {
          "id": "8fI2woAI3HZ7dHDv",
          "name": "Odoo production"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.message.voice.file_unique_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "f16d54dc-9e6d-497d-92ea-65ce2b873fb8",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.message.video_note.file_unique_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "918ef68c-695d-48d5-ae61-9930bd25afd5",
                    "leftValue": "={{ $('Execute Workflow Trigger').item.json.message.video.file_unique_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "78e5db35-8b37-4250-9c6b-adbf384fff64",
      "name": "тип медиа2",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        4040,
        4920
      ]
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.photo.reduce((largest, current) => current.file_size > largest.file_size ? current : largest).file_id; }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Перейти к диалогу",
                    "additionalFields": {
                      "url": "=tg://user?id={{ $('Execute Workflow Trigger').item.json.tg_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "caption": "=Проблема с <b>документами</b> у водителя {{ $('данные сотрудника1').item.json[\"display_name\"] }} <a href=\"tel:{{ $('данные сотрудника1').item.json.mobile_phone }}\">{{ $('данные сотрудника1').item.json.mobile_phone }}</a>(авто {{ $('номер авто1').item.json[\"number_car\"] }}) на маршруте {{ $('получим перевозку').all()[0].json.display_name.substring(11) }}: <i>{{ $('Execute Workflow Trigger').item.json.message.caption }}</i>",
          "parse_mode": "HTML"
        }
      },
      "id": "74250be5-93e6-4845-bb1e-7d4531e3a571",
      "name": "отправка фото6",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        6480,
        5240
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "sendVideo",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.video.file_id }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Перейти к диалогу",
                    "additionalFields": {
                      "url": "=tg://user?id={{ $('Execute Workflow Trigger').item.json.tg_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "caption": "=Проблема с <b>документами</b> у водителя {{ $('данные сотрудника1').item.json[\"display_name\"] }} <a href=\"tel:{{ $('данные сотрудника1').item.json.mobile_phone }}\">{{ $('данные сотрудника1').item.json.mobile_phone }}</a>(авто {{ $('номер авто1').item.json[\"number_car\"] }}) на маршруте {{ $('получим перевозку').all()[0].json.display_name.substring(11) }}: <i>{{ $('Execute Workflow Trigger').item.json.message.caption }}</i>",
          "parse_mode": "HTML"
        }
      },
      "id": "d18e3b27-ea58-4b98-b2f6-b5f20fc8ef50",
      "name": "отправка видео6",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        6480,
        5080
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "chatId": "={{ $json.result.chat.id }}",
        "text": "=Проблема с <b>документами</b> у водителя {{ $('данные сотрудника1').item.json[\"display_name\"] }} <a href=\"tel:{{ $('данные сотрудника1').item.json.mobile_phone }}\">{{ $('данные сотрудника1').item.json.mobile_phone }}</a>(авто {{ $('номер авто1').item.json[\"number_car\"] }}) на маршруте {{ $('получим перевозку').all()[0].json.display_name.substring(11) }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Перейти к диалогу",
                    "additionalFields": {
                      "url": "=tg://user?id={{ $('Execute Workflow Trigger').item.json.tg_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML",
          "reply_to_message_id": "={{ $json.result.message_id }}"
        }
      },
      "id": "31e4e321-e5eb-4292-9e48-2647ab013eaf",
      "name": "отправка сообщения2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        6480,
        4920
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "sendAudio",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.voice.file_id }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Перейти к диалогу",
                    "additionalFields": {
                      "url": "=tg://user?id={{ $('Execute Workflow Trigger').item.json.tg_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "caption": "=Проблема с <b>документами</b> у водителя {{ $('данные сотрудника1').item.json[\"display_name\"] }} <a href=\"tel:{{ $('данные сотрудника1').item.json.mobile_phone }}\">{{ $('данные сотрудника1').item.json.mobile_phone }}</a>(авто {{ $('номер авто1').item.json[\"number_car\"] }}) на маршруте {{ $('получим перевозку').all()[0].json.display_name.substring(11) }}",
          "parse_mode": "HTML"
        }
      },
      "id": "0684bac2-382e-4198-9cba-80ed3cbbf1c0",
      "name": "отправка в чат2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        6480,
        4740
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "sendVideo",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.video_note.file_id }}",
        "additionalFields": {}
      },
      "id": "f1a93347-880a-4564-8f19-c52b230869e4",
      "name": "отправка кружка4",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        6280,
        4920
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Execute Workflow Trigger').item.json.message.voice.file_id }}"
      },
      "id": "ff12b270-afee-4b13-ac07-d96042ffaf64",
      "name": "скачать файл8",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        720,
        3760
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendAudio",
        "chatId": "={{ $('айди для отправки сообщения10').all()[0].json.tg_id }}",
        "binaryData": true,
        "additionalFields": {}
      },
      "id": "cd36caa6-c0e0-47f8-82f4-d35eb2ad2ed1",
      "name": "отправка аудио6",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        880,
        3760
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('айди для отправки сообщения10').all()[0].json.tg_id }}",
        "text": "=Сообщение от водителя автомобиля {{ $('номер авто').item.json.number_car }}, {{ $('данные сотрудника').item.json.name }}, <a href=\"tel:{{ $('данные сотрудника').item.json.mobile_phone }}\">{{ $('данные сотрудника').item.json.mobile_phone }}</a>",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Ответить на сообщение",
                    "additionalFields": {
                      "callback_data": "=answer_to_not_urgent_{{ $('Execute Workflow Trigger').item.json.message.chat.id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML",
          "reply_to_message_id": "={{ $json.result.message_id }}"
        }
      },
      "id": "1642120a-d16e-4001-97fc-e25ddfc54e03",
      "name": "текст8",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1040,
        3760
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://everest.lamart.site/create_maintenance",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"car_id\": {{ $('номер авто1').item.json.id }},\n    \"description\": {{  $('Execute Workflow Trigger').item.json.message.caption }},\n    \"hours\": {{ 1 }},\n    \"tech_maintenance\": {{ false }},\n    \"cost\": {{ 1 }},\n    \"employee_id\": {{ $('Execute Workflow Trigger').item.json.odoo_id }}\n}   ",
        "options": {}
      },
      "id": "de243ce7-120a-4b6c-9e1f-e4db822e8312",
      "name": "создание заявки",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        3000,
        2480
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://everest.lamart.site/add_breakage_photo",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"maintenance_id\": {{ $('создание заявки1').item.json.id }},\n    \"image\":  {{'\"'+ $json.data + '\"'}}\n}",
        "options": {}
      },
      "id": "2f6e1821-124e-4858-b708-10bde0657d26",
      "name": "загрузка фото неисправности1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        3660,
        3440
      ]
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.photo.reduce((largest, current) => current.file_size > largest.file_size ? current : largest).file_id; }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Перейти к диалогу",
                    "additionalFields": {
                      "url": "=tg://user?id={{ $('Execute Workflow Trigger').item.json.tg_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "caption": "=У водителя <b>{{ $('данные сотрудника1').item.json[\"display_name\"] }}</b> <a href=\"tel:{{ $('данные сотрудника1').item.json.mobile_phone }}\">{{ $('данные сотрудника1').item.json.mobile_phone }}</a> проблема с авто <b>{{ $('номер авто1').item.json[\"number_car\"] }}</b>:\n\n<i>{{ $('Execute Workflow Trigger').item.json[\"message\"][\"caption\"] }}</i>",
          "parse_mode": "HTML"
        }
      },
      "id": "b5b5803d-b06b-4f2d-ac1f-e1b4c54d21b7",
      "name": "отправка фото3",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        4283,
        3529
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://everest.lamart.site/create_maintenance",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "cookie",
              "value": "={{ $('Execute Workflow Trigger').item.json.cookie }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"car_id\": {{ $('номер авто1').item.json.id }},\n    \"description\": {{  $('Execute Workflow Trigger').item.json.message.caption ? '\"' + $('Execute Workflow Trigger').item.json.message.caption + '\"' : '\"Нет описания\"'}},\n    \"hours\": {{ 1 }},\n    \"tech_maintenance\": {{ false }},\n    \"cost\": {{ 1 }},\n    \"employee_id\": {{ $('Execute Workflow Trigger').item.json.odoo_id }}\n}   ",
        "options": {}
      },
      "id": "c63abb1d-b174-47fb-8825-a34b81f6b206",
      "name": "создание заявки1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        2980,
        3440
      ]
    },
    {
      "parameters": {
        "operation": "sendVideo",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.video.file_id }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Перейти к диалогу",
                    "additionalFields": {
                      "url": "=tg://user?id={{ $('Execute Workflow Trigger').item.json.tg_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "caption": "=У водителя <b>{{ $('данные сотрудника1').item.json[\"display_name\"] }}</b> <a href=\"tel:{{ $('данные сотрудника1').item.json.mobile_phone }}\">{{ $('данные сотрудника1').item.json.mobile_phone }}</a> проблема с авто <b>{{ $('номер авто1').item.json[\"number_car\"] }}</b>: \n\n<i>{{ $('Execute Workflow Trigger').item.json.message.caption}}</i>",
          "parse_mode": "HTML"
        }
      },
      "id": "79679c76-c44d-42dd-b168-7bef5bdfb39b",
      "name": "отправка видео1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        3620,
        2611
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.photo.reduce((largest, current) => current.file_size > largest.file_size ? current : largest).file_id; }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Перейти к диалогу",
                    "additionalFields": {
                      "url": "=tg://user?id={{ $('Execute Workflow Trigger').item.json.tg_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "caption": "=У водителя <b>{{ $('данные сотрудника1').item.json[\"display_name\"] }}</b> <a href=\"tel:{{ $('данные сотрудника1').item.json.mobile_phone }}\">{{ $('данные сотрудника1').item.json.mobile_phone }}</a> проблема с авто <b>{{ $('номер авто1').item.json[\"number_car\"] }}</b>:\n\n<i>{{ $('Execute Workflow Trigger').item.json[\"message\"][\"caption\"] }}</i>  \n\n<a href=\"https://everest.lamart.site/web#id={{ $('создание заявки1').item.json.id }}&model=technical.maintenance&view_type=form\">Ссылка на заявку в Odoo</a>",
          "parse_mode": "HTML"
        }
      },
      "id": "275541da-b3cc-4ae3-8878-fae27d53da83",
      "name": "отправка фото1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        4280,
        3300
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "sendVideo",
        "chatId": "={{ $json.tg_id }}",
        "file": "={{ $('Execute Workflow Trigger').item.json.message.video.file_id }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Перейти к диалогу",
                    "additionalFields": {
                      "url": "=tg://user?id={{ $('Execute Workflow Trigger').item.json.tg_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "caption": "=У водителя <b>{{ $('данные сотрудника1').item.json[\"display_name\"] }}</b> <a href=\"tel:{{ $('данные сотрудника1').item.json.mobile_phone }}\">{{ $('данные сотрудника1').item.json.mobile_phone }}</a> проблема с авто <b>{{ $('номер авто1').item.json[\"number_car\"] }}</b>:\n\n<i>{{ $('Execute Workflow Trigger').item.json[\"message\"][\"caption\"] }}</i>\n\n<a href=\"https://everest.lamart.site/web#id={{ $('создание заявки').item.json.id }}&model=technical.maintenance&view_type=form\">Ссылка на заявку в Odoo</a>",
          "parse_mode": "HTML"
        }
      },
      "id": "6d6c0bd3-a425-44c7-9776-7859fe32dc5d",
      "name": "отправка видео",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        3620,
        2391
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {},
      "id": "ea9fbfbe-a1dc-4e53-af68-013d722fba3a",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        -1200,
        3460
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "da433d96-0ef2-4e18-8d50-ffefc46ec0a5",
              "leftValue": "={{ $('номер авто1').item.json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "a14d66b8-a17d-4f25-912f-f0e05ec036e0",
      "name": "можно создать заявку?1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        2700,
        3620
      ]
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Execute Workflow Trigger').item.json.message.from.id }}",
        "messageId": "={{ $('Execute Workflow Trigger').item.json.message.message_id - 1}}",
        "replyMarkup": "inlineKeyboard",
        "text": "❗Вы не загружали ТТН по данной перевозке.\nОтправьте фото для загрузки",
        "additionalFields": {}
      },
      "id": "ad8aad24-174b-4924-b7ef-6c8946a415aa",
      "name": "убираем кнопку \"назад\" у прикрепления фото2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        500,
        1740
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Execute Workflow Trigger').item.json.message.photo.reduce((largest, current) => current.file_size > largest.file_size ? current : largest).file_id; }}"
      },
      "id": "07f7b15b-5161-4d91-bce0-910f58e8be98",
      "name": "получение фото из тг3",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        680,
        1740
      ],
      "credentials": {
        "telegramApi": {
          "id": "s2yURwRj0JIo9urH",
          "name": "Everest production"
        }
      }
    }
  ],
  "pinData": {
    "Execute Workflow Trigger": [
      {
        "json": {
          "update_id": 100627871,
          "message": {
            "message_id": 19968,
            "from": {
              "id": 700956969,
              "is_bot": false,
              "first_name": "Алексей",
              "username": "Chronos196",
              "language_code": "ru"
            },
            "chat": {
              "id": 700956969,
              "first_name": "Алексей",
              "username": "Chronos196",
              "type": "private"
            },
            "date": 1726488957,
            "photo": [
              {
                "file_id": "AgACAgIAAxkBAAJN8GboHrY6lfpS0MRZwQ87dpIo5Uk9AAIv6zEbOghAS4oX6OeRIYDFAQADAgADcwADNgQ",
                "file_unique_id": "AQADL-sxGzoIQEt4",
                "file_size": 738,
                "width": 90,
                "height": 47
              },
              {
                "file_id": "AgACAgIAAxkBAAJN8GboHrY6lfpS0MRZwQ87dpIo5Uk9AAIv6zEbOghAS4oX6OeRIYDFAQADAgADbQADNgQ",
                "file_unique_id": "AQADL-sxGzoIQEty",
                "file_size": 10087,
                "width": 320,
                "height": 166
              },
              {
                "file_id": "AgACAgIAAxkBAAJN8GboHrY6lfpS0MRZwQ87dpIo5Uk9AAIv6zEbOghAS4oX6OeRIYDFAQADAgADeAADNgQ",
                "file_unique_id": "AQADL-sxGzoIQEt9",
                "file_size": 39926,
                "width": 800,
                "height": 414
              },
              {
                "file_id": "AgACAgIAAxkBAAJN8GboHrY6lfpS0MRZwQ87dpIo5Uk9AAIv6zEbOghAS4oX6OeRIYDFAQADAgADeQADNgQ",
                "file_unique_id": "AQADL-sxGzoIQEt-",
                "file_size": 71941,
                "width": 1280,
                "height": 662
              }
            ]
          },
          "tg_id": "700956969",
          "odoo_id": 2,
          "status": "inputing_warn_message",
          "only_mech": false,
          "mech_photo": false,
          "end_request_id": null,
          "materials_photo": false,
          "end_request_hours": null,
          "car_id_while_inputing": 18,
          "fuel_liters": 10,
          "weight_measure": "1000 м3 ",
          "logist_alert_text": null,
          "logist_recipient_name": null,
          "transportation_for_certificate": null,
          "count_weight_photo": 1,
          "count_weight_photo_sent": 0,
          "current_quarry_hours": 10,
          "end_round_message_id": 19905,
          "cookie": "session_id=1286d9b722349a8ee94113078b45b826d8444bdd; Expires=Tue, 16 Sep 2025 12:15:58 GMT; Max-Age=604800; HttpOnly; Path=/"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2024-08-26T14:50:05.418Z",
      "updatedAt": "2024-08-26T14:50:05.418Z",
      "id": "6aWMzdObOVIXsJ6y",
      "name": "production"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2024-10-06T17:04:57.993Z",
  "versionId": "a58a7d30-09f8-483b-92dd-95fda95eb4e9"
}